import { Component, Input, Optional } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../notification/notifications.service";
import * as i2 from "../notification/notification-drawer/notification-drawer.service";
import * as i3 from "@angular/common";
import * as i4 from "../button/button.component";
import * as i5 from "../icon/icon.component";
import * as i6 from "../badge/badge.component";
import * as i7 from "../person-avatar/person-avatar.component";
import * as i8 from "../menu/menu-trigger";
import * as i9 from "../tooltip/tooltip.directive";
export class EsnAppBar {
    constructor(notifService, notifDrawerService) {
        this.notifService = notifService;
        this.notifDrawerService = notifDrawerService;
        this.nbNotViewed = 0;
        this.nbNotRead = 0;
        this.notificationShaking = false;
    }
    ngOnInit() {
        if (!!this.notifService) {
            this._initiateNotificationsSubscriptions();
        }
    }
    onNotificationsClick() {
        this.notifDrawerService.toggleDrawer();
    }
    _initiateNotificationsSubscriptions() {
        this.notifService.getNotViewed().subscribe((nbNotViewed) => {
            this.nbNotViewed = nbNotViewed;
            if (!!nbNotViewed && !this.interval) {
                this.interval = setInterval(() => {
                    this.notificationShaking = true;
                    setTimeout(() => (this.notificationShaking = false), 2000);
                }, 30000);
            }
            else if (!!this.interval) {
                clearInterval(this.interval);
                this.interval = null;
            }
        });
        this.notifService.getUnread().subscribe((nbNotRead) => this.nbNotRead = nbNotRead);
        this.notifService.refreshUnreadAndNotViewed();
    }
    ngOnDestroy() {
        if (!!this.interval) {
            clearInterval(this.interval);
        }
    }
}
EsnAppBar.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnAppBar, deps: [{ token: i1.EsnNotificationsService, optional: true }, { token: i2.EsnNotificationDrawerService, optional: true }], target: i0.ɵɵFactoryTarget.Component });
EsnAppBar.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: EsnAppBar, selector: "esn-app-bar", inputs: { user: "user", userMenu: "userMenu", avatarTooltip: "avatarTooltip" }, host: { classAttribute: "esn-app-bar" }, ngImport: i0, template: "<div\r\n  *ngIf=\"!!notifService\"\r\n  class=\"esn-app-bar-notifications\"\r\n  [ngClass]=\"{ 'esn-app-bar-notification-shaking': notificationShaking }\"\r\n>\r\n  <esn-button\r\n    [iconOnly]=\"true\"\r\n    type=\"basic\"\r\n    color=\"neutral\"\r\n    (click)=\"onNotificationsClick()\"\r\n  >\r\n    <esn-icon *ngIf=\"!!nbNotRead\" name=\"bell-ringing\"></esn-icon>\r\n    <esn-icon *ngIf=\"!nbNotRead\" name=\"bell\"></esn-icon>\r\n    <esn-badge\r\n      *ngIf=\"!!nbNotViewed\"\r\n      class=\"esn-app-bar-notification-badge\"\r\n      type=\"flat\"\r\n      color=\"error\"\r\n      shade=\"lighter\"\r\n      size=\"sm\"\r\n      >{{ nbNotViewed > 99 ? \"99+\" : nbNotViewed }}</esn-badge\r\n    >\r\n  </esn-button>\r\n</div>\r\n\r\n<esn-person-avatar\r\n  *ngIf=\"!!user && !!userMenu\"\r\n  [user]=\"user\"\r\n  size=\"lg\"\r\n  [esnMenuTriggerFor]=\"userMenu\"\r\n  [esnTooltip]=\"avatarTooltip\"\r\n></esn-person-avatar>\r\n<esn-person-avatar\r\n  *ngIf=\"!!user && !userMenu\"\r\n  [user]=\"user\"\r\n  size=\"lg\"\r\n  [esnTooltip]=\"avatarTooltip\"\r\n></esn-person-avatar>\r\n", styles: [":host{width:100%;display:flex;justify-content:flex-end;align-items:center;height:72px}:host .esn-app-bar-notifications{margin-right:2rem}:host .esn-app-bar-notifications.esn-app-bar-notification-shaking esn-icon{animation:tilt-shaking .5s linear infinite}:host>*{margin-right:1rem}:host esn-person-avatar{cursor:pointer}::ng-deep .esn-app-bar-notification-badge{position:absolute;top:-7px;left:12px}@keyframes tilt-shaking{0%{transform:rotate(0)}25%{transform:rotate(5deg)}50%{transform:rotate(0)}75%{transform:rotate(-5deg)}to{transform:rotate(0)}}\n"], dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.EsnButton, selector: "esn-button", inputs: ["type", "size", "disabled", "round", "iconOnly", "color"], outputs: ["click"] }, { kind: "component", type: i5.EsnIcon, selector: "esn-icon", inputs: ["name", "boxed", "size"] }, { kind: "component", type: i6.EsnBadge, selector: "esn-badge", inputs: ["size", "type", "color", "shade", "round", "disabled", "bicolor"] }, { kind: "component", type: i7.EsnPersonAvatar, selector: "esn-person-avatar", inputs: ["user", "size"] }, { kind: "directive", type: i8.EsnMenuTrigger, selector: "[esn-menu-trigger-for], [esnMenuTriggerFor]", exportAs: ["esnMenuTrigger"] }, { kind: "directive", type: i9.TooltipDirective, selector: "[esnTooltip]", inputs: ["esnTooltip"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnAppBar, decorators: [{
            type: Component,
            args: [{ selector: 'esn-app-bar', host: {
                        class: 'esn-app-bar',
                    }, template: "<div\r\n  *ngIf=\"!!notifService\"\r\n  class=\"esn-app-bar-notifications\"\r\n  [ngClass]=\"{ 'esn-app-bar-notification-shaking': notificationShaking }\"\r\n>\r\n  <esn-button\r\n    [iconOnly]=\"true\"\r\n    type=\"basic\"\r\n    color=\"neutral\"\r\n    (click)=\"onNotificationsClick()\"\r\n  >\r\n    <esn-icon *ngIf=\"!!nbNotRead\" name=\"bell-ringing\"></esn-icon>\r\n    <esn-icon *ngIf=\"!nbNotRead\" name=\"bell\"></esn-icon>\r\n    <esn-badge\r\n      *ngIf=\"!!nbNotViewed\"\r\n      class=\"esn-app-bar-notification-badge\"\r\n      type=\"flat\"\r\n      color=\"error\"\r\n      shade=\"lighter\"\r\n      size=\"sm\"\r\n      >{{ nbNotViewed > 99 ? \"99+\" : nbNotViewed }}</esn-badge\r\n    >\r\n  </esn-button>\r\n</div>\r\n\r\n<esn-person-avatar\r\n  *ngIf=\"!!user && !!userMenu\"\r\n  [user]=\"user\"\r\n  size=\"lg\"\r\n  [esnMenuTriggerFor]=\"userMenu\"\r\n  [esnTooltip]=\"avatarTooltip\"\r\n></esn-person-avatar>\r\n<esn-person-avatar\r\n  *ngIf=\"!!user && !userMenu\"\r\n  [user]=\"user\"\r\n  size=\"lg\"\r\n  [esnTooltip]=\"avatarTooltip\"\r\n></esn-person-avatar>\r\n", styles: [":host{width:100%;display:flex;justify-content:flex-end;align-items:center;height:72px}:host .esn-app-bar-notifications{margin-right:2rem}:host .esn-app-bar-notifications.esn-app-bar-notification-shaking esn-icon{animation:tilt-shaking .5s linear infinite}:host>*{margin-right:1rem}:host esn-person-avatar{cursor:pointer}::ng-deep .esn-app-bar-notification-badge{position:absolute;top:-7px;left:12px}@keyframes tilt-shaking{0%{transform:rotate(0)}25%{transform:rotate(5deg)}50%{transform:rotate(0)}75%{transform:rotate(-5deg)}to{transform:rotate(0)}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.EsnNotificationsService, decorators: [{
                    type: Optional
                }] }, { type: i2.EsnNotificationDrawerService, decorators: [{
                    type: Optional
                }] }]; }, propDecorators: { user: [{
                type: Input
            }], userMenu: [{
                type: Input
            }], avatarTooltip: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcm9tLWRvbWFpbi1pcG5uLWM5MC1kZXNpZ24tbGliL3NyYy9saWIvY29tcG9uZW50cy9hcHAtYmFyL2FwcC1iYXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJvbS1kb21haW4taXBubi1jOTAtZGVzaWduLWxpYi9zcmMvbGliL2NvbXBvbmVudHMvYXBwLWJhci9hcHAtYmFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7Ozs7O0FBYzlFLE1BQU0sT0FBTyxTQUFTO0lBUXBCLFlBQ3FCLFlBQXFDLEVBQ3JDLGtCQUFnRDtRQURoRCxpQkFBWSxHQUFaLFlBQVksQ0FBeUI7UUFDckMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUE4QjtRQU45RCxnQkFBVyxHQUFXLENBQUMsQ0FBQztRQUN4QixjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBQ3RCLHdCQUFtQixHQUFZLEtBQUssQ0FBQztJQUt6QyxDQUFDO0lBRUosUUFBUTtRQUNOLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdkIsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLENBQUM7U0FDNUM7SUFDSCxDQUFDO0lBRU0sb0JBQW9CO1FBQ3pCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN6QyxDQUFDO0lBRUQsbUNBQW1DO1FBQ2pDLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDekQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7WUFFL0IsSUFBSSxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDbkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFO29CQUMvQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO29CQUNoQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQzdELENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNYO2lCQUFNLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQzFCLGFBQWEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO2FBQ3RCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsWUFBWSxDQUFDLHlCQUF5QixFQUFFLENBQUM7SUFDaEQsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ25CLGFBQWEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDOUI7SUFDSCxDQUFDOzt1R0E3Q1UsU0FBUzsyRkFBVCxTQUFTLDRLQ2R0Qiw0a0NBc0NBOzRGRHhCYSxTQUFTO2tCQVJyQixTQUFTOytCQUNFLGFBQWEsUUFHakI7d0JBQ0osS0FBSyxFQUFFLGFBQWE7cUJBQ3JCOzswQkFXRSxRQUFROzswQkFDUixRQUFROzRDQVRGLElBQUk7c0JBQVosS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRWRmQXBwbGljYXRpb25Vc2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvcHVibGljLWFwaSc7XHJcbmltcG9ydCB7IEVzbk1lbnUgfSBmcm9tICcuLi9tZW51L21lbnUnO1xyXG5pbXBvcnQgeyBFc25Ob3RpZmljYXRpb25zU2VydmljZSB9IGZyb20gJy4uL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb25zLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBFc25Ob3RpZmljYXRpb25EcmF3ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1kcmF3ZXIvbm90aWZpY2F0aW9uLWRyYXdlci5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnZXNuLWFwcC1iYXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hcHAtYmFyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9hcHAtYmFyLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgaG9zdDoge1xyXG4gICAgY2xhc3M6ICdlc24tYXBwLWJhcicsXHJcbiAgfSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEVzbkFwcEJhciBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICBASW5wdXQoKSB1c2VyOiBFZGZBcHBsaWNhdGlvblVzZXI7XHJcbiAgQElucHV0KCkgdXNlck1lbnU/OiBFc25NZW51O1xyXG4gIEBJbnB1dCgpIGF2YXRhclRvb2x0aXA6IHN0cmluZztcclxuICBwdWJsaWMgbmJOb3RWaWV3ZWQ6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIG5iTm90UmVhZDogbnVtYmVyID0gMDtcclxuICBwdWJsaWMgbm90aWZpY2F0aW9uU2hha2luZzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBpbnRlcnZhbDogYW55O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIG5vdGlmU2VydmljZTogRXNuTm90aWZpY2F0aW9uc1NlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbm90aWZEcmF3ZXJTZXJ2aWNlOiBFc25Ob3RpZmljYXRpb25EcmF3ZXJTZXJ2aWNlXHJcbiAgKSB7fVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIGlmICghIXRoaXMubm90aWZTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMuX2luaXRpYXRlTm90aWZpY2F0aW9uc1N1YnNjcmlwdGlvbnMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbk5vdGlmaWNhdGlvbnNDbGljaygpIHtcclxuICAgIHRoaXMubm90aWZEcmF3ZXJTZXJ2aWNlLnRvZ2dsZURyYXdlcigpO1xyXG4gIH1cclxuXHJcbiAgX2luaXRpYXRlTm90aWZpY2F0aW9uc1N1YnNjcmlwdGlvbnMoKSB7XHJcbiAgICB0aGlzLm5vdGlmU2VydmljZS5nZXROb3RWaWV3ZWQoKS5zdWJzY3JpYmUoKG5iTm90Vmlld2VkKSA9PiB7XHJcbiAgICAgIHRoaXMubmJOb3RWaWV3ZWQgPSBuYk5vdFZpZXdlZDtcclxuXHJcbiAgICAgIGlmICghIW5iTm90Vmlld2VkICYmICF0aGlzLmludGVydmFsKSB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9uU2hha2luZyA9IHRydWU7XHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICh0aGlzLm5vdGlmaWNhdGlvblNoYWtpbmcgPSBmYWxzZSksIDIwMDApO1xyXG4gICAgICAgIH0sIDMwMDAwKTtcclxuICAgICAgfSBlbHNlIGlmICghIXRoaXMuaW50ZXJ2YWwpIHtcclxuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xyXG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMubm90aWZTZXJ2aWNlLmdldFVucmVhZCgpLnN1YnNjcmliZSgobmJOb3RSZWFkKSA9PiB0aGlzLm5iTm90UmVhZCA9IG5iTm90UmVhZCk7XHJcbiAgICB0aGlzLm5vdGlmU2VydmljZS5yZWZyZXNoVW5yZWFkQW5kTm90Vmlld2VkKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpe1xyXG4gICAgaWYgKCEhdGhpcy5pbnRlcnZhbCkge1xyXG4gICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCI8ZGl2XHJcbiAgKm5nSWY9XCIhIW5vdGlmU2VydmljZVwiXHJcbiAgY2xhc3M9XCJlc24tYXBwLWJhci1ub3RpZmljYXRpb25zXCJcclxuICBbbmdDbGFzc109XCJ7ICdlc24tYXBwLWJhci1ub3RpZmljYXRpb24tc2hha2luZyc6IG5vdGlmaWNhdGlvblNoYWtpbmcgfVwiXHJcbj5cclxuICA8ZXNuLWJ1dHRvblxyXG4gICAgW2ljb25Pbmx5XT1cInRydWVcIlxyXG4gICAgdHlwZT1cImJhc2ljXCJcclxuICAgIGNvbG9yPVwibmV1dHJhbFwiXHJcbiAgICAoY2xpY2spPVwib25Ob3RpZmljYXRpb25zQ2xpY2soKVwiXHJcbiAgPlxyXG4gICAgPGVzbi1pY29uICpuZ0lmPVwiISFuYk5vdFJlYWRcIiBuYW1lPVwiYmVsbC1yaW5naW5nXCI+PC9lc24taWNvbj5cclxuICAgIDxlc24taWNvbiAqbmdJZj1cIiFuYk5vdFJlYWRcIiBuYW1lPVwiYmVsbFwiPjwvZXNuLWljb24+XHJcbiAgICA8ZXNuLWJhZGdlXHJcbiAgICAgICpuZ0lmPVwiISFuYk5vdFZpZXdlZFwiXHJcbiAgICAgIGNsYXNzPVwiZXNuLWFwcC1iYXItbm90aWZpY2F0aW9uLWJhZGdlXCJcclxuICAgICAgdHlwZT1cImZsYXRcIlxyXG4gICAgICBjb2xvcj1cImVycm9yXCJcclxuICAgICAgc2hhZGU9XCJsaWdodGVyXCJcclxuICAgICAgc2l6ZT1cInNtXCJcclxuICAgICAgPnt7IG5iTm90Vmlld2VkID4gOTkgPyBcIjk5K1wiIDogbmJOb3RWaWV3ZWQgfX08L2Vzbi1iYWRnZVxyXG4gICAgPlxyXG4gIDwvZXNuLWJ1dHRvbj5cclxuPC9kaXY+XHJcblxyXG48ZXNuLXBlcnNvbi1hdmF0YXJcclxuICAqbmdJZj1cIiEhdXNlciAmJiAhIXVzZXJNZW51XCJcclxuICBbdXNlcl09XCJ1c2VyXCJcclxuICBzaXplPVwibGdcIlxyXG4gIFtlc25NZW51VHJpZ2dlckZvcl09XCJ1c2VyTWVudVwiXHJcbiAgW2VzblRvb2x0aXBdPVwiYXZhdGFyVG9vbHRpcFwiXHJcbj48L2Vzbi1wZXJzb24tYXZhdGFyPlxyXG48ZXNuLXBlcnNvbi1hdmF0YXJcclxuICAqbmdJZj1cIiEhdXNlciAmJiAhdXNlck1lbnVcIlxyXG4gIFt1c2VyXT1cInVzZXJcIlxyXG4gIHNpemU9XCJsZ1wiXHJcbiAgW2VzblRvb2x0aXBdPVwiYXZhdGFyVG9vbHRpcFwiXHJcbj48L2Vzbi1wZXJzb24tYXZhdGFyPlxyXG4iXX0=