import { Component, Input, } from '@angular/core';
import { animate, state, style, transition, trigger, } from '@angular/animations';
import { BehaviorSubject } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "./notification-drawer.service";
import * as i2 from "../notifications.service";
import * as i3 from "../notification-processing.service";
import * as i4 from "@angular/common";
import * as i5 from "../../button/button.component";
import * as i6 from "../../icon/icon.component";
import * as i7 from "../../tabs/tab-group/tab-group";
import * as i8 from "../../tabs/tab-group/tab";
import * as i9 from "../../tabs/tab-group/tab-label";
import * as i10 from "../../badge/badge.component";
import * as i11 from "../notification-list/notification-list.component";
export class EsnNotificationDrawer {
    constructor(drawerService, notificationsService, processingService, elementRef) {
        this.drawerService = drawerService;
        this.notificationsService = notificationsService;
        this.processingService = processingService;
        this.elementRef = elementRef;
        this.totalUnread = 0;
        this.totalNbNotifs = 0;
        this.displayed = 'not-displayed';
        this.refreshAll$ = new BehaviorSubject(false);
        this.refreshUnread$ = new BehaviorSubject(false);
        this.markAllAsRead$ = new BehaviorSubject(false);
        this.activeIndex = 0;
    }
    ngOnInit() {
        this.drawerService.isOpen$.subscribe(async (open) => {
            this.displayed = open ? 'displayed' : 'not-displayed';
            if (open) {
                this.refreshActiveTab();
            }
        });
        this.notificationsService
            .getUnread()
            .subscribe((unread) => (this.totalUnread = unread));
        this.notificationsService
            .getTotal()
            .subscribe((total) => {
            const prevTotal = this.totalNbNotifs;
            this.totalNbNotifs = total;
            if (!prevTotal && !!total) {
                this.updateScrollElms();
            }
        });
    }
    ngAfterViewInit() {
        this.updateScrollElms();
    }
    updateScrollElms() {
        setTimeout(() => {
            const tabBodies = this.elementRef.nativeElement.getElementsByClassName('mat-mdc-tab-body-content');
            this.scrollElementAll = tabBodies[0];
            this.scrollElementUnread = tabBodies[1];
        });
    }
    closeDrawer() {
        this.drawerService.closeDrawer();
    }
    tabChanged(e) {
        this.activeIndex = e.index;
        this.refreshActiveTab();
    }
    refreshActiveTab() {
        if (this.activeIndex == 0) {
            this.refreshAll$.next(true);
        }
        else {
            this.refreshUnread$.next(true);
        }
    }
    goToNotificationPage() {
        this.processingService.goToNotificationPage();
        this.closeDrawer();
    }
    markAllAsRead() {
        this.notificationsService.markAllAsRead();
        this.markAllAsRead$.next(true);
    }
}
EsnNotificationDrawer.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnNotificationDrawer, deps: [{ token: i1.EsnNotificationDrawerService }, { token: i2.EsnNotificationsService }, { token: i3.EsnNotificationProcessingService }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
EsnNotificationDrawer.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: EsnNotificationDrawer, selector: "esn-notification-drawer", inputs: { totalUnread: "totalUnread" }, host: { classAttribute: "esn-notification-drawer" }, ngImport: i0, template: "<div\r\n  class=\"esn-notification-drawer-inner\"\r\n  [@enteringAnimation]=\"displayed\"\r\n  [ngClass]=\"displayed\"\r\n>\r\n  <div class=\"esn-notification-drawer-header\">\r\n    <div class=\"esn-notification-drawer-title\">Notifications</div>\r\n    <esn-button\r\n      [iconOnly]=\"true\"\r\n      type=\"basic\"\r\n      color=\"neutral\"\r\n      (click)=\"closeDrawer()\"\r\n    >\r\n      <esn-icon name=\"close\"></esn-icon>\r\n    </esn-button>\r\n  </div>\r\n  <div\r\n    class=\"esn-notification-drawer-body\"\r\n    [ngClass]=\"{ 'esn-notification-drawer-body-has-unread': totalUnread }\"\r\n  >\r\n    <esn-button\r\n      *ngIf=\"!!totalNbNotifs\"\r\n      class=\"esn-notification-drawer-see-all-btn\"\r\n      type=\"basic\"\r\n      color=\"primary\"\r\n      size=\"sm\"\r\n      (click)=\"goToNotificationPage()\"\r\n      >Tout voir</esn-button\r\n    >\r\n    <div\r\n      *ngIf=\"!!totalUnread\"\r\n      class=\"esn-notification-drawer-mark-all-as-read-container\"\r\n    >\r\n      <esn-button\r\n        class=\"esn-notification-drawer-mark-all-as-read-btn\"\r\n        type=\"basic\"\r\n        color=\"primary\"\r\n        size=\"sm\"\r\n        (click)=\"markAllAsRead()\"\r\n        >Tout marquer comme lu</esn-button\r\n      >\r\n    </div>\r\n    <esn-tab-group (selectedTabChange)=\"tabChanged($event)\">\r\n      <esn-tab label=\"Toutes\">\r\n        <esn-notification-list\r\n          [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n          [refreshSubject$]=\"refreshAll$\"\r\n          [scrollElement]=\"scrollElementAll\"\r\n        ></esn-notification-list>\r\n      </esn-tab>\r\n\r\n      <esn-tab *ngIf=\"!!totalNbNotifs\">\r\n        <ng-template esn-tab-label>\r\n          <span>Non lues</span>&nbsp;<esn-badge\r\n            *ngIf=\"!!totalUnread\"\r\n            type=\"light\"\r\n            color=\"neutral\"\r\n            [bicolor]=\"true\"\r\n            >{{ totalUnread }}</esn-badge\r\n          >\r\n        </ng-template>\r\n        <esn-notification-list\r\n          [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n          [unread]=\"true\"\r\n          [refreshSubject$]=\"refreshUnread$\"\r\n          [scrollElement]=\"scrollElementUnread\"\r\n        ></esn-notification-list>\r\n      </esn-tab>\r\n    </esn-tab-group>\r\n  </div>\r\n</div>\r\n", styles: [":host{position:fixed;z-index:10}:host .esn-notification-drawer-inner{display:flex;flex-direction:column;width:375px;height:100vh;max-height:100vh;position:fixed;right:-375px;top:0}:host .esn-notification-drawer-inner .esn-notification-drawer-header{flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 1.5rem}:host .esn-notification-drawer-inner .esn-notification-drawer-header .esn-notification-drawer-title{margin:1rem 0;font-size:18px;font-weight:700}:host .esn-notification-drawer-inner .esn-notification-drawer-body{position:relative;flex:1 1 auto;overflow-y:auto}:host .esn-notification-drawer-inner .esn-notification-drawer-body .esn-notification-drawer-see-all-btn{position:absolute;right:.5rem;top:.25rem;z-index:2}:host .esn-notification-drawer-inner .esn-notification-drawer-body .esn-notification-drawer-mark-all-as-read-container{position:absolute;z-index:1;top:47px;left:0;right:0;height:50px;display:flex;justify-content:flex-end;padding-right:.5rem}:host .hidden{visibility:hidden}::ng-deep .esn-notification-drawer-body esn-tab-group{position:absolute;inset:0;display:flex;flex-direction:column}::ng-deep .esn-notification-drawer-body.esn-notification-drawer-body-has-unread .mat-mdc-tab-body-wrapper{margin-top:50px}::ng-deep .esn-notification-drawer-body .esn-divider{border-top-width:2px}::ng-deep .cdk-overlay-backdrop.cdk-overlay-backdrop-showing.dark-backdrop{height:100%;width:100%;background-color:#00000057;transition-property:background-color;transition-duration:.2s}::ng-deep .cdk-overlay-backdrop.cdk-overlay-backdrop-showing.dark-backdrop.dark-backdrop-fading{background-color:#0000}::ng-deep esn-async-content-wrapper .esn-empty-state,::ng-deep esn-async-content-wrapper .error-state,::ng-deep esn-async-content-wrapper .esn-loader{margin-top:1rem}\n"], dependencies: [{ kind: "directive", type: i4.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i5.EsnButton, selector: "esn-button", inputs: ["type", "size", "disabled", "round", "iconOnly", "color"], outputs: ["click"] }, { kind: "component", type: i6.EsnIcon, selector: "esn-icon", inputs: ["name", "boxed", "size"] }, { kind: "component", type: i7.EsnTabGroup, selector: "esn-tab-group", inputs: ["color", "disableRipple", "fitInkBarToContent", "mat-stretch-tabs"], exportAs: ["esnTabGroup"] }, { kind: "component", type: i8.EsnTab, selector: "esn-tab", inputs: ["disabled", "label", "aria-label", "aria-labelledby", "labelClass", "bodyClass"], exportAs: ["matTab"] }, { kind: "directive", type: i9.EsnTabLabel, selector: "[esn-tab-label], [esnTabLabel]" }, { kind: "component", type: i10.EsnBadge, selector: "esn-badge", inputs: ["size", "type", "color", "shade", "round", "disabled", "bicolor"] }, { kind: "component", type: i11.EsnNotificationList, selector: "esn-notification-list", inputs: ["refreshSubject$", "scrollElement", "markAllAsReadSubject$", "unread", "dateBefore", "dateAfter", "criticality"] }], animations: [
        trigger('enteringAnimation', [
            state('displayed', style({
                transform: 'translateX(-100%)',
            })),
            state('not-displayed', style({
                transform: 'translateX(0)',
            })),
            transition('* => *', [animate('0.2s')]),
        ]),
    ] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnNotificationDrawer, decorators: [{
            type: Component,
            args: [{ selector: 'esn-notification-drawer', animations: [
                        trigger('enteringAnimation', [
                            state('displayed', style({
                                transform: 'translateX(-100%)',
                            })),
                            state('not-displayed', style({
                                transform: 'translateX(0)',
                            })),
                            transition('* => *', [animate('0.2s')]),
                        ]),
                    ], host: {
                        class: 'esn-notification-drawer',
                    }, template: "<div\r\n  class=\"esn-notification-drawer-inner\"\r\n  [@enteringAnimation]=\"displayed\"\r\n  [ngClass]=\"displayed\"\r\n>\r\n  <div class=\"esn-notification-drawer-header\">\r\n    <div class=\"esn-notification-drawer-title\">Notifications</div>\r\n    <esn-button\r\n      [iconOnly]=\"true\"\r\n      type=\"basic\"\r\n      color=\"neutral\"\r\n      (click)=\"closeDrawer()\"\r\n    >\r\n      <esn-icon name=\"close\"></esn-icon>\r\n    </esn-button>\r\n  </div>\r\n  <div\r\n    class=\"esn-notification-drawer-body\"\r\n    [ngClass]=\"{ 'esn-notification-drawer-body-has-unread': totalUnread }\"\r\n  >\r\n    <esn-button\r\n      *ngIf=\"!!totalNbNotifs\"\r\n      class=\"esn-notification-drawer-see-all-btn\"\r\n      type=\"basic\"\r\n      color=\"primary\"\r\n      size=\"sm\"\r\n      (click)=\"goToNotificationPage()\"\r\n      >Tout voir</esn-button\r\n    >\r\n    <div\r\n      *ngIf=\"!!totalUnread\"\r\n      class=\"esn-notification-drawer-mark-all-as-read-container\"\r\n    >\r\n      <esn-button\r\n        class=\"esn-notification-drawer-mark-all-as-read-btn\"\r\n        type=\"basic\"\r\n        color=\"primary\"\r\n        size=\"sm\"\r\n        (click)=\"markAllAsRead()\"\r\n        >Tout marquer comme lu</esn-button\r\n      >\r\n    </div>\r\n    <esn-tab-group (selectedTabChange)=\"tabChanged($event)\">\r\n      <esn-tab label=\"Toutes\">\r\n        <esn-notification-list\r\n          [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n          [refreshSubject$]=\"refreshAll$\"\r\n          [scrollElement]=\"scrollElementAll\"\r\n        ></esn-notification-list>\r\n      </esn-tab>\r\n\r\n      <esn-tab *ngIf=\"!!totalNbNotifs\">\r\n        <ng-template esn-tab-label>\r\n          <span>Non lues</span>&nbsp;<esn-badge\r\n            *ngIf=\"!!totalUnread\"\r\n            type=\"light\"\r\n            color=\"neutral\"\r\n            [bicolor]=\"true\"\r\n            >{{ totalUnread }}</esn-badge\r\n          >\r\n        </ng-template>\r\n        <esn-notification-list\r\n          [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n          [unread]=\"true\"\r\n          [refreshSubject$]=\"refreshUnread$\"\r\n          [scrollElement]=\"scrollElementUnread\"\r\n        ></esn-notification-list>\r\n      </esn-tab>\r\n    </esn-tab-group>\r\n  </div>\r\n</div>\r\n", styles: [":host{position:fixed;z-index:10}:host .esn-notification-drawer-inner{display:flex;flex-direction:column;width:375px;height:100vh;max-height:100vh;position:fixed;right:-375px;top:0}:host .esn-notification-drawer-inner .esn-notification-drawer-header{flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 1.5rem}:host .esn-notification-drawer-inner .esn-notification-drawer-header .esn-notification-drawer-title{margin:1rem 0;font-size:18px;font-weight:700}:host .esn-notification-drawer-inner .esn-notification-drawer-body{position:relative;flex:1 1 auto;overflow-y:auto}:host .esn-notification-drawer-inner .esn-notification-drawer-body .esn-notification-drawer-see-all-btn{position:absolute;right:.5rem;top:.25rem;z-index:2}:host .esn-notification-drawer-inner .esn-notification-drawer-body .esn-notification-drawer-mark-all-as-read-container{position:absolute;z-index:1;top:47px;left:0;right:0;height:50px;display:flex;justify-content:flex-end;padding-right:.5rem}:host .hidden{visibility:hidden}::ng-deep .esn-notification-drawer-body esn-tab-group{position:absolute;inset:0;display:flex;flex-direction:column}::ng-deep .esn-notification-drawer-body.esn-notification-drawer-body-has-unread .mat-mdc-tab-body-wrapper{margin-top:50px}::ng-deep .esn-notification-drawer-body .esn-divider{border-top-width:2px}::ng-deep .cdk-overlay-backdrop.cdk-overlay-backdrop-showing.dark-backdrop{height:100%;width:100%;background-color:#00000057;transition-property:background-color;transition-duration:.2s}::ng-deep .cdk-overlay-backdrop.cdk-overlay-backdrop-showing.dark-backdrop.dark-backdrop-fading{background-color:#0000}::ng-deep esn-async-content-wrapper .esn-empty-state,::ng-deep esn-async-content-wrapper .error-state,::ng-deep esn-async-content-wrapper .esn-loader{margin-top:1rem}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.EsnNotificationDrawerService }, { type: i2.EsnNotificationsService }, { type: i3.EsnNotificationProcessingService }, { type: i0.ElementRef }]; }, propDecorators: { totalUnread: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWRyYXdlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcm9tLWRvbWFpbi1pcG5uLWM5MC1kZXNpZ24tbGliL3NyYy9saWIvY29tcG9uZW50cy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLWRyYXdlci9ub3RpZmljYXRpb24tZHJhd2VyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Fyb20tZG9tYWluLWlwbm4tYzkwLWRlc2lnbi1saWIvc3JjL2xpYi9jb21wb25lbnRzL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24tZHJhd2VyL25vdGlmaWNhdGlvbi1kcmF3ZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFHVCxLQUFLLEdBQ04sTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLE9BQU8sRUFDUCxLQUFLLEVBQ0wsS0FBSyxFQUNMLFVBQVUsRUFDVixPQUFPLEdBQ1IsTUFBTSxxQkFBcUIsQ0FBQztBQUU3QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7Ozs7Ozs7Ozs7O0FBNEJ2QyxNQUFNLE9BQU8scUJBQXFCO0lBaUJoQyxZQUNTLGFBQTJDLEVBQzNDLG9CQUE2QyxFQUM3QyxpQkFBbUQsRUFDbkQsVUFBc0I7UUFIdEIsa0JBQWEsR0FBYixhQUFhLENBQThCO1FBQzNDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBeUI7UUFDN0Msc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFrQztRQUNuRCxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBcEJ0QixnQkFBVyxHQUFXLENBQUMsQ0FBQztRQUMxQixrQkFBYSxHQUFXLENBQUMsQ0FBQztRQUMxQixjQUFTLEdBQWtDLGVBQWUsQ0FBQztRQUMzRCxnQkFBVyxHQUE2QixJQUFJLGVBQWUs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QixDQUFDLENBQ0g7WUFDRCxLQUFLLENBQ0gsZUFBZSxFQUNmLEtBQUssQ0FBQztnQkFDSixTQUFTLEVBQUUsZUFBZTthQUMzQixDQUFDLENBQ0g7WUFDRCxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7U0FDeEMsQ0FBQztLQUNIOzRGQUtVLHFCQUFxQjtrQkF6QmpDLFNBQVM7K0JBQ0UseUJBQXlCLGNBR3ZCO3dCQUNWLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRTs0QkFDM0IsS0FBSyxDQUNILFdBQVcsRUFDWCxLQUFLLENBQUM7Z0NBQ0osU0FBUyxFQUFFLG1CQUFtQjs2QkFDL0IsQ0FBQyxDQUNIOzRCQUNELEtBQUssQ0FDSCxlQUFlLEVBQ2YsS0FBSyxDQUFDO2dDQUNKLFNBQVMsRUFBRSxlQUFlOzZCQUMzQixDQUFDLENBQ0g7NEJBQ0QsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO3lCQUN4QyxDQUFDO3FCQUNILFFBQ0s7d0JBQ0osS0FBSyxFQUFFLHlCQUF5QjtxQkFDakM7aU9BR1EsV0FBVztzQkFBbkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCxcclxuICBDb21wb25lbnQsXHJcbiAgT25Jbml0LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgSW5wdXQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEVzbk5vdGlmaWNhdGlvbkRyYXdlclNlcnZpY2UgfSBmcm9tICcuL25vdGlmaWNhdGlvbi1kcmF3ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7XHJcbiAgYW5pbWF0ZSxcclxuICBzdGF0ZSxcclxuICBzdHlsZSxcclxuICB0cmFuc2l0aW9uLFxyXG4gIHRyaWdnZXIsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XHJcbmltcG9ydCB7IEVzbk5vdGlmaWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9ucy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEVzbk5vdGlmaWNhdGlvblByb2Nlc3NpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXByb2Nlc3Npbmcuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2Vzbi1ub3RpZmljYXRpb24tZHJhd2VyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpY2F0aW9uLWRyYXdlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vbm90aWZpY2F0aW9uLWRyYXdlci5jb21wb25lbnQuc2NzcyddLFxyXG4gIGFuaW1hdGlvbnM6IFtcclxuICAgIHRyaWdnZXIoJ2VudGVyaW5nQW5pbWF0aW9uJywgW1xyXG4gICAgICBzdGF0ZShcclxuICAgICAgICAnZGlzcGxheWVkJyxcclxuICAgICAgICBzdHlsZSh7XHJcbiAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC0xMDAlKScsXHJcbiAgICAgICAgfSlcclxuICAgICAgKSxcclxuICAgICAgc3RhdGUoXHJcbiAgICAgICAgJ25vdC1kaXNwbGF5ZWQnLFxyXG4gICAgICAgIHN0eWxlKHtcclxuICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMCknLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICksXHJcbiAgICAgIHRyYW5zaXRpb24oJyogPT4gKicsIFthbmltYXRlKCcwLjJzJyldKSxcclxuICAgIF0pLFxyXG4gIF0sXHJcbiAgaG9zdDoge1xyXG4gICAgY2xhc3M6ICdlc24tbm90aWZpY2F0aW9uLWRyYXdlcicsXHJcbiAgfSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEVzbk5vdGlmaWNhdGlvbkRyYXdlciBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQElucHV0KCkgdG90YWxVbnJlYWQ6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIHRvdGFsTmJOb3RpZnM6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIGRpc3BsYXllZDogJ2Rpc3BsYXllZCcgfCAnbm90LWRpc3BsYXllZCcgPSAnbm90LWRpc3BsYXllZCc7XHJcbiAgcHVibGljIHJlZnJlc2hBbGwkOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KFxyXG4gICAgZmFsc2VcclxuICApO1xyXG4gIHB1YmxpYyByZWZyZXNoVW5yZWFkJDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID1cclxuICAgIG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xyXG5cclxuICBwdWJsaWMgbWFya0FsbEFzUmVhZCQ6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oXHJcbiAgICBmYWxzZVxyXG4gICk7XHJcbiAgcHVibGljIHNjcm9sbEVsZW1lbnRBbGw6IEhUTUxFbGVtZW50O1xyXG4gIHB1YmxpYyBzY3JvbGxFbGVtZW50VW5yZWFkOiBIVE1MRWxlbWVudDtcclxuICBwdWJsaWMgYWN0aXZlSW5kZXg6IG51bWJlciA9IDA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIGRyYXdlclNlcnZpY2U6IEVzbk5vdGlmaWNhdGlvbkRyYXdlclNlcnZpY2UsXHJcbiAgICBwdWJsaWMgbm90aWZpY2F0aW9uc1NlcnZpY2U6IEVzbk5vdGlmaWNhdGlvbnNTZXJ2aWNlLFxyXG4gICAgcHVibGljIHByb2Nlc3NpbmdTZXJ2aWNlOiBFc25Ob3RpZmljYXRpb25Qcm9jZXNzaW5nU2VydmljZSxcclxuICAgIHB1YmxpYyBlbGVtZW50UmVmOiBFbGVtZW50UmVmXHJcbiAgKSB7fVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZHJhd2VyU2VydmljZS5pc09wZW4kLnN1YnNjcmliZShhc3luYyAob3BlbikgPT4ge1xyXG4gICAgICB0aGlzLmRpc3BsYXllZCA9IG9wZW4gPyAnZGlzcGxheWVkJyA6ICdub3QtZGlzcGxheWVkJztcclxuICAgICAgaWYgKG9wZW4pIHtcclxuICAgICAgICB0aGlzLnJlZnJlc2hBY3RpdmVUYWIoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZVxyXG4gICAgICAuZ2V0VW5yZWFkKClcclxuICAgICAgLnN1YnNjcmliZSgodW5yZWFkKSA9PiAodGhpcy50b3RhbFVucmVhZCA9IHVucmVhZCkpO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZVxyXG4gICAgICAuZ2V0VG90YWwoKVxyXG4gICAgICAuc3Vic2NyaWJlKCh0b3RhbCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByZXZUb3RhbCA9IHRoaXMudG90YWxOYk5vdGlmcztcclxuICAgICAgICB0aGlzLnRvdGFsTmJOb3RpZnMgPSB0b3RhbDtcclxuICAgICAgICBpZighcHJldlRvdGFsICYmICEhdG90YWwpe1xyXG4gICAgICAgICAgdGhpcy51cGRhdGVTY3JvbGxFbG1zKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGVTY3JvbGxFbG1zKClcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVTY3JvbGxFbG1zKCl7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgY29uc3QgdGFiQm9kaWVzID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcclxuICAgICAgICAnbWF0LW1kYy10YWItYm9keS1jb250ZW50J1xyXG4gICAgICApO1xyXG4gICAgICB0aGlzLnNjcm9sbEVsZW1lbnRBbGwgPSB0YWJCb2RpZXNbMF0gYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuc2Nyb2xsRWxlbWVudFVucmVhZCA9IHRhYkJvZGllc1sxXSBhcyBIVE1MRWxlbWVudDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsb3NlRHJhd2VyKCkge1xyXG4gICAgdGhpcy5kcmF3ZXJTZXJ2aWNlLmNsb3NlRHJhd2VyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdGFiQ2hhbmdlZChlOiBhbnkpIHtcclxuICAgIHRoaXMuYWN0aXZlSW5kZXggPSBlLmluZGV4O1xyXG4gICAgdGhpcy5yZWZyZXNoQWN0aXZlVGFiKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVmcmVzaEFjdGl2ZVRhYigpIHtcclxuICAgIGlmICh0aGlzLmFjdGl2ZUluZGV4ID09IDApIHtcclxuICAgICAgdGhpcy5yZWZyZXNoQWxsJC5uZXh0KHRydWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZWZyZXNoVW5yZWFkJC5uZXh0KHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdvVG9Ob3RpZmljYXRpb25QYWdlKCkge1xyXG4gICAgdGhpcy5wcm9jZXNzaW5nU2VydmljZS5nb1RvTm90aWZpY2F0aW9uUGFnZSgpO1xyXG4gICAgdGhpcy5jbG9zZURyYXdlcigpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1hcmtBbGxBc1JlYWQoKSB7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLm1hcmtBbGxBc1JlYWQoKTtcclxuICAgIHRoaXMubWFya0FsbEFzUmVhZCQubmV4dCh0cnVlKTtcclxuICB9XHJcbn1cclxuIiwiPGRpdlxyXG4gIGNsYXNzPVwiZXNuLW5vdGlmaWNhdGlvbi1kcmF3ZXItaW5uZXJcIlxyXG4gIFtAZW50ZXJpbmdBbmltYXRpb25dPVwiZGlzcGxheWVkXCJcclxuICBbbmdDbGFzc109XCJkaXNwbGF5ZWRcIlxyXG4+XHJcbiAgPGRpdiBjbGFzcz1cImVzbi1ub3RpZmljYXRpb24tZHJhd2VyLWhlYWRlclwiPlxyXG4gICAgPGRpdiBjbGFzcz1cImVzbi1ub3RpZmljYXRpb24tZHJhd2VyLXRpdGxlXCI+Tm90aWZpY2F0aW9uczwvZGl2PlxyXG4gICAgPGVzbi1idXR0b25cclxuICAgICAgW2ljb25Pbmx5XT1cInRydWVcIlxyXG4gICAgICB0eXBlPVwiYmFzaWNcIlxyXG4gICAgICBjb2xvcj1cIm5ldXRyYWxcIlxyXG4gICAgICAoY2xpY2spPVwiY2xvc2VEcmF3ZXIoKVwiXHJcbiAgICA+XHJcbiAgICAgIDxlc24taWNvbiBuYW1lPVwiY2xvc2VcIj48L2Vzbi1pY29uPlxyXG4gICAgPC9lc24tYnV0dG9uPlxyXG4gIDwvZGl2PlxyXG4gIDxkaXZcclxuICAgIGNsYXNzPVwiZXNuLW5vdGlmaWNhdGlvbi1kcmF3ZXItYm9keVwiXHJcbiAgICBbbmdDbGFzc109XCJ7ICdlc24tbm90aWZpY2F0aW9uLWRyYXdlci1ib2R5LWhhcy11bnJlYWQnOiB0b3RhbFVucmVhZCB9XCJcclxuICA+XHJcbiAgICA8ZXNuLWJ1dHRvblxyXG4gICAgICAqbmdJZj1cIiEhdG90YWxOYk5vdGlmc1wiXHJcbiAgICAgIGNsYXNzPVwiZXNuLW5vdGlmaWNhdGlvbi1kcmF3ZXItc2VlLWFsbC1idG5cIlxyXG4gICAgICB0eXBlPVwiYmFzaWNcIlxyXG4gICAgICBjb2xvcj1cInByaW1hcnlcIlxyXG4gICAgICBzaXplPVwic21cIlxyXG4gICAgICAoY2xpY2spPVwiZ29Ub05vdGlmaWNhdGlvblBhZ2UoKVwiXHJcbiAgICAgID5Ub3V0IHZvaXI8L2Vzbi1idXR0b25cclxuICAgID5cclxuICAgIDxkaXZcclxuICAgICAgKm5nSWY9XCIhIXRvdGFsVW5yZWFkXCJcclxuICAgICAgY2xhc3M9XCJlc24tbm90aWZpY2F0aW9uLWRyYXdlci1tYXJrLWFsbC1hcy1yZWFkLWNvbnRhaW5lclwiXHJcbiAgICA+XHJcbiAgICAgIDxlc24tYnV0dG9uXHJcbiAgICAgICAgY2xhc3M9XCJlc24tbm90aWZpY2F0aW9uLWRyYXdlci1tYXJrLWFsbC1hcy1yZWFkLWJ0blwiXHJcbiAgICAgICAgdHlwZT1cImJhc2ljXCJcclxuICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxyXG4gICAgICAgIHNpemU9XCJzbVwiXHJcbiAgICAgICAgKGNsaWNrKT1cIm1hcmtBbGxBc1JlYWQoKVwiXHJcbiAgICAgICAgPlRvdXQgbWFycXVlciBjb21tZSBsdTwvZXNuLWJ1dHRvblxyXG4gICAgICA+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxlc24tdGFiLWdyb3VwIChzZWxlY3RlZFRhYkNoYW5nZSk9XCJ0YWJDaGFuZ2VkKCRldmVudClcIj5cclxuICAgICAgPGVzbi10YWIgbGFiZWw9XCJUb3V0ZXNcIj5cclxuICAgICAgICA8ZXNuLW5vdGlmaWNhdGlvbi1saXN0XHJcbiAgICAgICAgICBbbWFya0FsbEFzUmVhZFN1YmplY3QkXT1cIm1hcmtBbGxBc1JlYWQkXCJcclxuICAgICAgICAgIFtyZWZyZXNoU3ViamVjdCRdPVwicmVmcmVzaEFsbCRcIlxyXG4gICAgICAgICAgW3Njcm9sbEVsZW1lbnRdPVwic2Nyb2xsRWxlbWVudEFsbFwiXHJcbiAgICAgICAgPjwvZXNuLW5vdGlmaWNhdGlvbi1saXN0PlxyXG4gICAgICA8L2Vzbi10YWI+XHJcblxyXG4gICAgICA8ZXNuLXRhYiAqbmdJZj1cIiEhdG90YWxOYk5vdGlmc1wiPlxyXG4gICAgICAgIDxuZy10ZW1wbGF0ZSBlc24tdGFiLWxhYmVsPlxyXG4gICAgICAgICAgPHNwYW4+Tm9uIGx1ZXM8L3NwYW4+Jm5ic3A7PGVzbi1iYWRnZVxyXG4gICAgICAgICAgICAqbmdJZj1cIiEhdG90YWxVbnJlYWRcIlxyXG4gICAgICAgICAgICB0eXBlPVwibGlnaHRcIlxyXG4gICAgICAgICAgICBjb2xvcj1cIm5ldXRyYWxcIlxyXG4gICAgICAgICAgICBbYmljb2xvcl09XCJ0cnVlXCJcclxuICAgICAgICAgICAgPnt7IHRvdGFsVW5yZWFkIH19PC9lc24tYmFkZ2VcclxuICAgICAgICAgID5cclxuICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgICAgIDxlc24tbm90aWZpY2F0aW9uLWxpc3RcclxuICAgICAgICAgIFttYXJrQWxsQXNSZWFkU3ViamVjdCRdPVwibWFya0FsbEFzUmVhZCRcIlxyXG4gICAgICAgICAgW3VucmVhZF09XCJ0cnVlXCJcclxuICAgICAgICAgIFtyZWZyZXNoU3ViamVjdCRdPVwicmVmcmVzaFVucmVhZCRcIlxyXG4gICAgICAgICAgW3Njcm9sbEVsZW1lbnRdPVwic2Nyb2xsRWxlbWVudFVucmVhZFwiXHJcbiAgICAgICAgPjwvZXNuLW5vdGlmaWNhdGlvbi1saXN0PlxyXG4gICAgICA8L2Vzbi10YWI+XHJcbiAgICA8L2Vzbi10YWItZ3JvdXA+XHJcbiAgPC9kaXY+XHJcbjwvZGl2PlxyXG4iXX0=