import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl, NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subscription } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "../../utils/services/country/country.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
import * as i4 from "../select/select/select.component";
import * as i5 from "../select/option/option.component";
import * as i6 from "../esn-flag/esn-flag.component";
import * as i7 from "../autocomplete-select/default/autocomplete-select.component";
import * as i8 from "../icon/icon.component";
export class CountrySelectorComponent {
    constructor(_countryService, cdr) {
        this._countryService = _countryService;
        this.cdr = cdr;
        this.disabled = false;
        this.autocomplete = false;
        this.hint = '';
        this.label = 'Chercher un pays';
        this.placeholder = "Chercher un pays";
        this.size = 'sm';
        this.selectionChange = new EventEmitter();
        this.queryFunc = (txt) => Promise.resolve(this._countryService.searchCountry(txt, this.highlight));
        this.optionTextFn = (country) => `${country}`;
        this.countriesList = [];
        this.onChangeSub = new Subscription();
        this.onChange = () => { };
        this.onTouch = () => { };
        this.countriesList = this._countryService.getCountriesList();
        this.control = new FormControl(null);
    }
    ngOnDestroy() {
        this.onChangeSub.unsubscribe();
    }
    writeValue(value) {
        if (!!value) {
            this.control.setValue(value);
        }
    }
    registerOnChange(fn) {
        this.onChangeSub.add(this.control.valueChanges.subscribe(fn));
    }
    registerOnTouched(onTouched) {
        this.onTouch = onTouched;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        this.updateDisableState();
        this.cdr.detectChanges();
    }
    updateDisableState() {
        this.disabled ? this.control.disable() : this.control.enable();
    }
    getCountryCode(country) {
        return this._countryService.getCountryCode(country);
    }
    _selectionChange(country) {
        this.selectionChange.emit(country);
    }
    ngOnChanges(changes) {
        if (changes['highlight']) {
            const filtredCountriesList = this.countriesList.filter(c => {
                if (c.toLocaleLowerCase().includes(this.highlight.toLocaleLowerCase())) {
                    this.countryToBeHighlighted = c;
                }
                return !c.toLocaleLowerCase().includes(this.highlight.toLocaleLowerCase());
            });
            if (!!this.countryToBeHighlighted) {
                this.countriesList = [this.countryToBeHighlighted, ...filtredCountriesList];
            }
        }
        if (changes['selected'] && !!this.selected) {
            this.control.setValue(this.selected);
        }
        if (changes['disabled']) {
            this.updateDisableState();
        }
    }
}
CountrySelectorComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: CountrySelectorComponent, deps: [{ token: i1.CountryService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
CountrySelectorComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: CountrySelectorComponent, selector: "esn-country-selector", inputs: { highlight: "highlight", selected: "selected", disabled: "disabled", autocomplete: "autocomplete", hint: "hint", idField: "idField", label: "label", placeholder: "placeholder", size: "size" }, outputs: { selectionChange: "selectionChange" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: CountrySelectorComponent,
            multi: true,
        },
    ], usesOnChanges: true, ngImport: i0, template: "<ng-container *ngIf=\"!autocomplete; else autocompleteTemp\">\r\n  <esn-select\r\n    class=\"country__select\"\r\n    [formControl]=\"control\"\r\n    [label]=\"label\"\r\n    [size]=\"size\"\r\n    [hint]=\"hint\"\r\n    (selectionChange)=\"_selectionChange($event)\"\r\n  >\r\n    <esn-option\r\n      *ngFor=\"let country of countriesList; let i = index\"\r\n      [value]=\"country\"\r\n      [ngClass]=\"{ country__highlight: countryToBeHighlighted && i === 0 }\"\r\n    >\r\n      <div class=\"country__container\">\r\n        <esn-flag [country]=\"country\"></esn-flag>\r\n        <span class=\"country__name\">{{ country }}</span>\r\n      </div>\r\n    </esn-option>\r\n  </esn-select>\r\n</ng-container>\r\n\r\n<ng-template #autocompleteTemp>\r\n  <esn-autocomplete-select\r\n    [queryFunc]=\"queryFunc\"\r\n    [optionTextFn]=\"optionTextFn\"\r\n    [optionTemplate]=\"overridenChipTemplate\"\r\n    [singleElemTemplate]=\"singleElemTemplate\"\r\n    [multi]=\"false\"\r\n    [idField]=\"idField\"\r\n    [label]=\"label\"\r\n    [minChars]=\"0\"\r\n    [formControl]=\"control\"\r\n    [placeholder]=\"placeholder\"\r\n    [hint]=\"hint\"\r\n  ></esn-autocomplete-select>\r\n  <ng-template\r\n    #overridenChipTemplate\r\n    let-elem\r\n    let-remove=\"remove\"\r\n    let-disabled=\"disabled\"\r\n  >\r\n    <div\r\n      class=\"country__container\"\r\n      [ngClass]=\"{\r\n        autocomplete__country__highlight:\r\n          countryToBeHighlighted && elem === highlight\r\n      }\"\r\n    >\r\n      <esn-flag [country]=\"elem\"></esn-flag>\r\n      <span class=\"country__name\">{{ elem }}</span>\r\n    </div>\r\n  </ng-template>\r\n  <ng-template\r\n    #singleElemTemplate\r\n    let-elem\r\n    let-remove=\"remove\"\r\n    let-disabled=\"disabled\"\r\n  >\r\n    <div class=\"country__container\" *ngIf=\"elem\">\r\n      <esn-flag class=\"country__icon\" [size]=\"'xs'\" [country]=\"elem\"></esn-flag>\r\n      <span class=\"country__name\">{{ elem }}</span>\r\n      <esn-icon\r\n        *ngIf=\"!disabled\"\r\n        class=\"esn-autocomplete-select-base__close-icon country__close-icon\"\r\n        name=\"close\"\r\n        (click)=\"remove(elem)\"\r\n      ></esn-icon>\r\n    </div>\r\n  </ng-template>\r\n</ng-template>\r\n", styles: [".country__select ::ng-deep .mat-mdc-form-field{width:18rem}.country__container{display:flex}.country__container .fi{width:2rem;height:2rem}.country__container .circular{border-radius:50%}.country__name{margin:auto}.country__icon{margin:auto 0}.country__name{margin-left:.75rem;width:100%}.country__close-icon{cursor:pointer;margin:auto}::ng-deep .cdk-overlay-container::ng-deep .country__highlight{border-bottom:1px solid #CDCDCD}esn-autocomplete-select ::ng-deep ::ng-deep .mdc-evolution-chip-set .mdc-evolution-chip-set__chips{margin-left:0}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: i4.EsnSelect, selector: "esn-select", inputs: ["disabled", "disableRipple", "tabIndex", "appearance", "label", "placeholder", "required", "multiple", "hint", "error", "size", "theme"], outputs: ["focus", "blur", "selectionChange", "openedChange"] }, { kind: "component", type: i5.EsnOption, selector: "esn-option", inputs: ["value", "disabled"] }, { kind: "component", type: i6.EsnFlagComponent, selector: "esn-flag", inputs: ["shape", "size", "country"] }, { kind: "component", type: i7.EsnAutocompleteSelect, selector: "esn-autocomplete-select", inputs: ["optionTextFn", "chipTextFn", "optionTemplate", "chipTemplate", "singleElemTemplate", "minChars", "hint", "noResultsLabel"] }, { kind: "component", type: i8.EsnIcon, selector: "esn-icon", inputs: ["name", "boxed", "size"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: CountrySelectorComponent, decorators: [{
            type: Component,
            args: [{ selector: 'esn-country-selector', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: CountrySelectorComponent,
                            multi: true,
                        },
                    ], template: "<ng-container *ngIf=\"!autocomplete; else autocompleteTemp\">\r\n  <esn-select\r\n    class=\"country__select\"\r\n    [formControl]=\"control\"\r\n    [label]=\"label\"\r\n    [size]=\"size\"\r\n    [hint]=\"hint\"\r\n    (selectionChange)=\"_selectionChange($event)\"\r\n  >\r\n    <esn-option\r\n      *ngFor=\"let country of countriesList; let i = index\"\r\n      [value]=\"country\"\r\n      [ngClass]=\"{ country__highlight: countryToBeHighlighted && i === 0 }\"\r\n    >\r\n      <div class=\"country__container\">\r\n        <esn-flag [country]=\"country\"></esn-flag>\r\n        <span class=\"country__name\">{{ country }}</span>\r\n      </div>\r\n    </esn-option>\r\n  </esn-select>\r\n</ng-container>\r\n\r\n<ng-template #autocompleteTemp>\r\n  <esn-autocomplete-select\r\n    [queryFunc]=\"queryFunc\"\r\n    [optionTextFn]=\"optionTextFn\"\r\n    [optionTemplate]=\"overridenChipTemplate\"\r\n    [singleElemTemplate]=\"singleElemTemplate\"\r\n    [multi]=\"false\"\r\n    [idField]=\"idField\"\r\n    [label]=\"label\"\r\n    [minChars]=\"0\"\r\n    [formControl]=\"control\"\r\n    [placeholder]=\"placeholder\"\r\n    [hint]=\"hint\"\r\n  ></esn-autocomplete-select>\r\n  <ng-template\r\n    #overridenChipTemplate\r\n    let-elem\r\n    let-remove=\"remove\"\r\n    let-disabled=\"disabled\"\r\n  >\r\n    <div\r\n      class=\"country__container\"\r\n      [ngClass]=\"{\r\n        autocomplete__country__highlight:\r\n          countryToBeHighlighted && elem === highlight\r\n      }\"\r\n    >\r\n      <esn-flag [country]=\"elem\"></esn-flag>\r\n      <span class=\"country__name\">{{ elem }}</span>\r\n    </div>\r\n  </ng-template>\r\n  <ng-template\r\n    #singleElemTemplate\r\n    let-elem\r\n    let-remove=\"remove\"\r\n    let-disabled=\"disabled\"\r\n  >\r\n    <div class=\"country__container\" *ngIf=\"elem\">\r\n      <esn-flag class=\"country__icon\" [size]=\"'xs'\" [country]=\"elem\"></esn-flag>\r\n      <span class=\"country__name\">{{ elem }}</span>\r\n      <esn-icon\r\n        *ngIf=\"!disabled\"\r\n        class=\"esn-autocomplete-select-base__close-icon country__close-icon\"\r\n        name=\"close\"\r\n        (click)=\"remove(elem)\"\r\n      ></esn-icon>\r\n    </div>\r\n  </ng-template>\r\n</ng-template>\r\n", styles: [".country__select ::ng-deep .mat-mdc-form-field{width:18rem}.country__container{display:flex}.country__container .fi{width:2rem;height:2rem}.country__container .circular{border-radius:50%}.country__name{margin:auto}.country__icon{margin:auto 0}.country__name{margin-left:.75rem;width:100%}.country__close-icon{cursor:pointer;margin:auto}::ng-deep .cdk-overlay-container::ng-deep .country__highlight{border-bottom:1px solid #CDCDCD}esn-autocomplete-select ::ng-deep ::ng-deep .mdc-evolution-chip-set .mdc-evolution-chip-set__chips{margin-left:0}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.CountryService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { highlight: [{
                type: Input
            }], selected: [{
                type: Input
            }], disabled: [{
                type: Input
            }], autocomplete: [{
                type: Input
            }], hint: [{
                type: Input
            }], idField: [{
                type: Input
            }], label: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], size: [{
                type: Input
            }], selectionChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRyeS1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcm9tLWRvbWFpbi1pcG5uLWM5MC1kZXNpZ24tbGliL3NyYy9saWIvY29tcG9uZW50cy9jb3VudHJ5LXNlbGVjdG9yL2NvdW50cnktc2VsZWN0b3IuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJvbS1kb21haW4taXBubi1jOTAtZGVzaWduLWxpYi9zcmMvbGliL2NvbXBvbmVudHMvY291bnRyeS1zZWxlY3Rvci9jb3VudHJ5LXNlbGVjdG9yLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBcUIsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXdCLE1BQU0sRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFL0gsT0FBTyxFQUF3QixXQUFXLEVBQWEsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7Ozs7Ozs7O0FBYXBDLE1BQU0sT0FBTyx3QkFBd0I7SUF1Qm5DLFlBQW9CLGVBQStCLEVBQVUsR0FBc0I7UUFBL0Qsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFwQjFFLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDckIsU0FBSSxHQUFHLEVBQUUsQ0FBQztRQUVWLFVBQUssR0FBRyxrQkFBa0IsQ0FBQztRQUMzQixnQkFBVyxHQUFHLGtCQUFrQixDQUFDO1FBQ2pDLFNBQUksR0FBZ0IsSUFBSSxDQUFDO1FBRXhCLG9CQUFlLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFFdEUsY0FBUyxHQUFvQyxDQUFDLEdBQVcsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLE9B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SUFBSSxDQUFDLFFBQVEsRUFBRTtZQUN6QyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDdEM7UUFFRCxJQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUN0QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztTQUMzQjtJQUNILENBQUM7O3NIQXBGVSx3QkFBd0I7MEdBQXhCLHdCQUF3QiwwU0FSeEI7UUFDVDtZQUNFLE9BQU8sRUFBRSxpQkFBaUI7WUFDMUIsV0FBVyxFQUFFLHdCQUF3QjtZQUNyQyxLQUFLLEVBQUUsSUFBSTtTQUNaO0tBQ0YsK0NDZEgseXRFQXVFQTs0RkR2RGEsd0JBQXdCO2tCQVpwQyxTQUFTOytCQUNFLHNCQUFzQixhQUdyQjt3QkFDVDs0QkFDRSxPQUFPLEVBQUUsaUJBQWlCOzRCQUMxQixXQUFXLDBCQUEwQjs0QkFDckMsS0FBSyxFQUFFLElBQUk7eUJBQ1o7cUJBQ0Y7cUlBR1EsU0FBUztzQkFBakIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLElBQUk7c0JBQVosS0FBSztnQkFFSSxlQUFlO3NCQUF4QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE91dHB1dCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb3VudHJ5U2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL3NlcnZpY2VzL2NvdW50cnkvY291bnRyeS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdlc24tY291bnRyeS1zZWxlY3RvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NvdW50cnktc2VsZWN0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2NvdW50cnktc2VsZWN0b3IuY29tcG9uZW50LnNjc3MnXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIHtcclxuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgIHVzZUV4aXN0aW5nOiBDb3VudHJ5U2VsZWN0b3JDb21wb25lbnQsXHJcbiAgICAgIG11bHRpOiB0cnVlLFxyXG4gICAgfSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb3VudHJ5U2VsZWN0b3JDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG4gIEBJbnB1dCgpIGhpZ2hsaWdodDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHNlbGVjdGVkOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICBASW5wdXQoKSBhdXRvY29tcGxldGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSBoaW50ID0gJyc7XHJcbiAgQElucHV0KCkgaWRGaWVsZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIGxhYmVsID0gJ0NoZXJjaGVyIHVuIHBheXMnO1xyXG4gIEBJbnB1dCgpIHBsYWNlaG9sZGVyID0gXCJDaGVyY2hlciB1biBwYXlzXCI7XHJcbiAgQElucHV0KCkgc2l6ZTogJ3NtJyB8ICdtZCcgPSAnc20nO1xyXG4gIFxyXG4gIEBPdXRwdXQoKSBzZWxlY3Rpb25DaGFuZ2U6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIHB1YmxpYyBxdWVyeUZ1bmM6ICh0eHQ6IHN0cmluZykgPT4gUHJvbWlzZTxhbnlbXT4gPSAodHh0OiBzdHJpbmcpID0+IFByb21pc2UucmVzb2x2ZSh0aGlzLl9jb3VudHJ5U2VydmljZS5zZWFyY2hDb3VudHJ5KHR4dCwgdGhpcy5oaWdobGlnaHQpKTtcclxuICBwdWJsaWMgb3B0aW9uVGV4dEZuID0gKGNvdW50cnk6IHN0cmluZykgPT4gYCR7Y291bnRyeX1gO1xyXG5cclxuICBjb250cm9sOiBGb3JtQ29udHJvbFxyXG4gIGNvdW50cmllc0xpc3Q6IHN0cmluZ1tdID0gW107XHJcbiAgY291bnRyeVRvQmVIaWdobGlnaHRlZDogc3RyaW5nO1xyXG4gIG9uQ2hhbmdlU3ViOiBTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XHJcbiAgb25DaGFuZ2U6IGFueSA9ICgpID0+IHt9O1xyXG4gIG9uVG91Y2g6IGFueSA9ICgpID0+IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9jb3VudHJ5U2VydmljZTogQ291bnRyeVNlcnZpY2UsIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgdGhpcy5jb3VudHJpZXNMaXN0ID0gdGhpcy5fY291bnRyeVNlcnZpY2UuZ2V0Q291bnRyaWVzTGlzdCgpO1xyXG4gICAgdGhpcy5jb250cm9sID0gbmV3IEZvcm1Db250cm9sKG51bGwpO1xyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMub25DaGFuZ2VTdWIudW5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgaWYgKCEhdmFsdWUpIHtcclxuICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHZhbHVlKTtcclxuICAgIH0gIFxyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlU3ViLmFkZCh0aGlzLmNvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZShmbikpO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQob25Ub3VjaGVkOiBGdW5jdGlvbikge1xyXG4gICAgdGhpcy5vblRvdWNoID0gb25Ub3VjaGVkO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcclxuICAgIHRoaXMudXBkYXRlRGlzYWJsZVN0YXRlKCk7XHJcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7IFxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVEaXNhYmxlU3RhdGUoKXtcclxuICAgIHRoaXMuZGlzYWJsZWQgPyB0aGlzLmNvbnRyb2wuZGlzYWJsZSgpIDogdGhpcy5jb250cm9sLmVuYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q291bnRyeUNvZGUoY291bnRyeTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY291bnRyeVNlcnZpY2UuZ2V0Q291bnRyeUNvZGUoY291bnRyeSk7XHJcbiAgfVxyXG5cclxuICBfc2VsZWN0aW9uQ2hhbmdlKGNvdW50cnk6IHN0cmluZykge1xyXG4gICAgdGhpcy5zZWxlY3Rpb25DaGFuZ2UuZW1pdChjb3VudHJ5KTtcclxuICB9XHJcbiAgXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgaWYoY2hhbmdlc1snaGlnaGxpZ2h0J10pIHtcclxuICAgICAgY29uc3QgZmlsdHJlZENvdW50cmllc0xpc3QgPSB0aGlzLmNvdW50cmllc0xpc3QuZmlsdGVyKGMgPT4ge1xyXG4gICAgICAgIGlmKGMudG9Mb2NhbGVMb3dlckNhc2UoKS5pbmNsdWRlcyh0aGlzLmhpZ2hsaWdodC50b0xvY2FsZUxvd2VyQ2FzZSgpKSl7XHJcbiAgICAgICAgICB0aGlzLmNvdW50cnlUb0JlSGlnaGxpZ2h0ZWQgPSBjO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gIWMudG9Mb2NhbGVMb3dlckNhc2UoKS5pbmNsdWRlcyh0aGlzLmhpZ2hsaWdodC50b0xvY2FsZUxvd2VyQ2FzZSgpKVxyXG4gICAgICB9KTtcclxuICAgICAgICBpZighIXRoaXMuY291bnRyeVRvQmVIaWdobGlnaHRlZCkgXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuY291bnRyaWVzTGlzdCA9IFt0aGlzLmNvdW50cnlUb0JlSGlnaGxpZ2h0ZWQsLi4uZmlsdHJlZENvdW50cmllc0xpc3RdXHJcbiAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoY2hhbmdlc1snc2VsZWN0ZWQnXSAmJiAhIXRoaXMuc2VsZWN0ZWQpIHtcclxuICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHRoaXMuc2VsZWN0ZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKGNoYW5nZXNbJ2Rpc2FibGVkJ10pIHtcclxuICAgICAgdGhpcy51cGRhdGVEaXNhYmxlU3RhdGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCIhYXV0b2NvbXBsZXRlOyBlbHNlIGF1dG9jb21wbGV0ZVRlbXBcIj5cclxuICA8ZXNuLXNlbGVjdFxyXG4gICAgY2xhc3M9XCJjb3VudHJ5X19zZWxlY3RcIlxyXG4gICAgW2Zvcm1Db250cm9sXT1cImNvbnRyb2xcIlxyXG4gICAgW2xhYmVsXT1cImxhYmVsXCJcclxuICAgIFtzaXplXT1cInNpemVcIlxyXG4gICAgW2hpbnRdPVwiaGludFwiXHJcbiAgICAoc2VsZWN0aW9uQ2hhbmdlKT1cIl9zZWxlY3Rpb25DaGFuZ2UoJGV2ZW50KVwiXHJcbiAgPlxyXG4gICAgPGVzbi1vcHRpb25cclxuICAgICAgKm5nRm9yPVwibGV0IGNvdW50cnkgb2YgY291bnRyaWVzTGlzdDsgbGV0IGkgPSBpbmRleFwiXHJcbiAgICAgIFt2YWx1ZV09XCJjb3VudHJ5XCJcclxuICAgICAgW25nQ2xhc3NdPVwieyBjb3VudHJ5X19oaWdobGlnaHQ6IGNvdW50cnlUb0JlSGlnaGxpZ2h0ZWQgJiYgaSA9PT0gMCB9XCJcclxuICAgID5cclxuICAgICAgPGRpdiBjbGFzcz1cImNvdW50cnlfX2NvbnRhaW5lclwiPlxyXG4gICAgICAgIDxlc24tZmxhZyBbY291bnRyeV09XCJjb3VudHJ5XCI+PC9lc24tZmxhZz5cclxuICAgICAgICA8c3BhbiBjbGFzcz1cImNvdW50cnlfX25hbWVcIj57eyBjb3VudHJ5IH19PC9zcGFuPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZXNuLW9wdGlvbj5cclxuICA8L2Vzbi1zZWxlY3Q+XHJcbjwvbmctY29udGFpbmVyPlxyXG5cclxuPG5nLXRlbXBsYXRlICNhdXRvY29tcGxldGVUZW1wPlxyXG4gIDxlc24tYXV0b2NvbXBsZXRlLXNlbGVjdFxyXG4gICAgW3F1ZXJ5RnVuY109XCJxdWVyeUZ1bmNcIlxyXG4gICAgW29wdGlvblRleHRGbl09XCJvcHRpb25UZXh0Rm5cIlxyXG4gICAgW29wdGlvblRlbXBsYXRlXT1cIm92ZXJyaWRlbkNoaXBUZW1wbGF0ZVwiXHJcbiAgICBbc2luZ2xlRWxlbVRlbXBsYXRlXT1cInNpbmdsZUVsZW1UZW1wbGF0ZVwiXHJcbiAgICBbbXVsdGldPVwiZmFsc2VcIlxyXG4gICAgW2lkRmllbGRdPVwiaWRGaWVsZFwiXHJcbiAgICBbbGFiZWxdPVwibGFiZWxcIlxyXG4gICAgW21pbkNoYXJzXT1cIjBcIlxyXG4gICAgW2Zvcm1Db250cm9sXT1cImNvbnRyb2xcIlxyXG4gICAgW3BsYWNlaG9sZGVyXT1cInBsYWNlaG9sZGVyXCJcclxuICAgIFtoaW50XT1cImhpbnRcIlxyXG4gID48L2Vzbi1hdXRvY29tcGxldGUtc2VsZWN0PlxyXG4gIDxuZy10ZW1wbGF0ZVxyXG4gICAgI292ZXJyaWRlbkNoaXBUZW1wbGF0ZVxyXG4gICAgbGV0LWVsZW1cclxuICAgIGxldC1yZW1vdmU9XCJyZW1vdmVcIlxyXG4gICAgbGV0LWRpc2FibGVkPVwiZGlzYWJsZWRcIlxyXG4gID5cclxuICAgIDxkaXZcclxuICAgICAgY2xhc3M9XCJjb3VudHJ5X19jb250YWluZXJcIlxyXG4gICAgICBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgYXV0b2NvbXBsZXRlX19jb3VudHJ5X19oaWdobGlnaHQ6XHJcbiAgICAgICAgICBjb3VudHJ5VG9CZUhpZ2hsaWdodGVkICYmIGVsZW0gPT09IGhpZ2hsaWdodFxyXG4gICAgICB9XCJcclxuICAgID5cclxuICAgICAgPGVzbi1mbGFnIFtjb3VudHJ5XT1cImVsZW1cIj48L2Vzbi1mbGFnPlxyXG4gICAgICA8c3BhbiBjbGFzcz1cImNvdW50cnlfX25hbWVcIj57eyBlbGVtIH19PC9zcGFuPlxyXG4gICAgPC9kaXY+XHJcbiAgPC9uZy10ZW1wbGF0ZT5cclxuICA8bmctdGVtcGxhdGVcclxuICAgICNzaW5nbGVFbGVtVGVtcGxhdGVcclxuICAgIGxldC1lbGVtXHJcbiAgICBsZXQtcmVtb3ZlPVwicmVtb3ZlXCJcclxuICAgIGxldC1kaXNhYmxlZD1cImRpc2FibGVkXCJcclxuICA+XHJcbiAgICA8ZGl2IGNsYXNzPVwiY291bnRyeV9fY29udGFpbmVyXCIgKm5nSWY9XCJlbGVtXCI+XHJcbiAgICAgIDxlc24tZmxhZyBjbGFzcz1cImNvdW50cnlfX2ljb25cIiBbc2l6ZV09XCIneHMnXCIgW2NvdW50cnldPVwiZWxlbVwiPjwvZXNuLWZsYWc+XHJcbiAgICAgIDxzcGFuIGNsYXNzPVwiY291bnRyeV9fbmFtZVwiPnt7IGVsZW0gfX08L3NwYW4+XHJcbiAgICAgIDxlc24taWNvblxyXG4gICAgICAgICpuZ0lmPVwiIWRpc2FibGVkXCJcclxuICAgICAgICBjbGFzcz1cImVzbi1hdXRvY29tcGxldGUtc2VsZWN0LWJhc2VfX2Nsb3NlLWljb24gY291bnRyeV9fY2xvc2UtaWNvblwiXHJcbiAgICAgICAgbmFtZT1cImNsb3NlXCJcclxuICAgICAgICAoY2xpY2spPVwicmVtb3ZlKGVsZW0pXCJcclxuICAgICAgPjwvZXNuLWljb24+XHJcbiAgICA8L2Rpdj5cclxuICA8L25nLXRlbXBsYXRlPlxyXG48L25nLXRlbXBsYXRlPlxyXG4iXX0=