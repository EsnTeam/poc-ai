import { Component, Input, } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { EsnNotificationCriticalityEnum, NOTIFICATION_CRITICALITY_LABELS, } from '../model/notification';
import * as i0 from "@angular/core";
import * as i1 from "../notifications.service";
import * as i2 from "../notification-processing.service";
import * as i3 from "@angular/forms";
import * as i4 from "@angular/common";
import * as i5 from "../../button/button.component";
import * as i6 from "../../input/input";
import * as i7 from "../../select/select/select.component";
import * as i8 from "../../select/option/option.component";
import * as i9 from "../../checkbox/checkbox.component";
import * as i10 from "../notification-list/notification-list.component";
export class EsnNotificationCenter {
    constructor(notificationsService, processingService, elementRef, fb) {
        this.notificationsService = notificationsService;
        this.processingService = processingService;
        this.elementRef = elementRef;
        this.totalUnread = 0;
        this.totalNbNotifs = 0;
        this.refresh$ = new BehaviorSubject(false);
        this.markAllAsRead$ = new BehaviorSubject(false);
        this.criticalities = Object.keys(EsnNotificationCriticalityEnum);
        this.criticalityLabels = NOTIFICATION_CRITICALITY_LABELS;
        this.form = fb.group({
            criticality: [null, null],
            date: [null, null],
            unread: [null, null],
        });
        this.form.valueChanges.subscribe((val) => {
            this.refresh$.next(true);
        });
    }
    ngOnInit() {
        this.refresh$.next(true);
        this.notificationsService
            .getUnread()
            .subscribe((unread) => (this.totalUnread = unread));
        this.notificationsService
            .getTotal()
            .subscribe((total) => (this.totalNbNotifs = total));
    }
    get dateAtEndOfDay() {
        const date = this.form?.value?.date;
        if (!!date) {
            let endOfDayDate = new Date(date);
            endOfDayDate = new Date(endOfDayDate.getTime() + 24 * 3600 * 1000);
            return endOfDayDate;
        }
        return date;
    }
    markAllAsRead() {
        this.notificationsService.markAllAsRead();
        this.markAllAsRead$.next(true);
    }
}
EsnNotificationCenter.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnNotificationCenter, deps: [{ token: i1.EsnNotificationsService }, { token: i2.EsnNotificationProcessingService }, { token: i0.ElementRef }, { token: i3.FormBuilder }], target: i0.ɵɵFactoryTarget.Component });
EsnNotificationCenter.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: EsnNotificationCenter, selector: "esn-notification-center", inputs: { scrollElement: "scrollElement" }, host: { classAttribute: "esn-notification-center" }, ngImport: i0, template: "<div class=\"esn-notification-center-header\">\r\n  <div class=\"esn-notification-center-title\">Notifications</div>\r\n  <div class=\"esn-notification-center-subtitle\">Suivez les nouveaut\u00E9s dans votre centre de notifications</div>\r\n</div>\r\n<div class=\"esn-notification-center-action-bar\">\r\n  <div class=\"esn-notification-action-bar-form\" [formGroup]=\"form\">\r\n    <esn-datepicker formControlName=\"date\" label=\"Date\"></esn-datepicker>\r\n    <esn-select formControlName=\"criticality\" size=\"sm\" label=\"Criticit\u00E9\">\r\n      <esn-option *ngFor=\"let criticality of criticalities\" [value]=\"criticality\">{{criticalityLabels[criticality]}}</esn-option>\r\n    </esn-select>\r\n    <esn-checkbox formControlName=\"unread\" color=\"primary\">Uniquement les non-lus<span *ngIf=\"!!totalUnread\"> ({{totalUnread}})</span></esn-checkbox>\r\n  </div>\r\n  <esn-button\r\n    *ngIf=\"!this.form.value.date && (!this.form.value.criticality || this.form.value.criticality == 'NONE')\"\r\n    class=\"esn-notification-center-mark-all-as-read-btn\"\r\n    type=\"basic\"\r\n    color=\"primary\"\r\n    size=\"sm\"\r\n    (click)=\"markAllAsRead()\"\r\n    >Tout marquer comme lu</esn-button\r\n  >\r\n</div>\r\n<esn-notification-list\r\n  [unread]=\"form.value.unread\"\r\n  [dateBefore]=\"dateAtEndOfDay\"\r\n  [dateAfter]=\"form.value.date\"\r\n  [criticality]=\"form.value.criticality != 'NONE' ? form.value.criticality : null\"\r\n  [refreshSubject$]=\"refresh$\"\r\n  [scrollElement]=\"scrollElement\"\r\n  [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n></esn-notification-list>\r\n", styles: [":host .esn-notification-center-header{margin-bottom:1.5rem}:host .esn-notification-center-header .esn-notification-center-title{margin-bottom:.375rem;font-size:2rem;margin:.67rem 0;font-weight:700}:host .esn-notification-center-action-bar{display:flex;justify-content:space-between}:host .esn-notification-center-action-bar .esn-notification-center-mark-all-as-read-btn{margin-right:1rem}:host .esn-notification-center-action-bar .esn-notification-action-bar-form{display:flex;align-items:center;flex-grow:1}:host .esn-notification-center-action-bar .esn-notification-action-bar-form :not(:last-child){margin-right:1rem}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-input,:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-select{margin-bottom:0}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-input{margin-top:18px}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-select{margin-top:15px}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i3.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i3.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i5.EsnButton, selector: "esn-button", inputs: ["type", "size", "disabled", "round", "iconOnly", "color"], outputs: ["click"] }, { kind: "component", type: i6.EsnDatePicker, selector: "esn-datepicker" }, { kind: "component", type: i7.EsnSelect, selector: "esn-select", inputs: ["disabled", "disableRipple", "tabIndex", "appearance", "label", "placeholder", "required", "multiple", "hint", "error", "size", "theme"], outputs: ["focus", "blur", "selectionChange", "openedChange"] }, { kind: "component", type: i8.EsnOption, selector: "esn-option", inputs: ["value", "disabled"] }, { kind: "component", type: i9.EsnCheckboxComponent, selector: "esn-checkbox", inputs: ["id", "name", "value", "checked", "required", "disabled", "indeterminate", "disableRipple", "labelPosition", "color", "tabIndex"], outputs: ["change", "indeterminateChange"] }, { kind: "component", type: i10.EsnNotificationList, selector: "esn-notification-list", inputs: ["refreshSubject$", "scrollElement", "markAllAsReadSubject$", "unread", "dateBefore", "dateAfter", "criticality"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EsnNotificationCenter, decorators: [{
            type: Component,
            args: [{ selector: 'esn-notification-center', host: {
                        class: 'esn-notification-center',
                    }, template: "<div class=\"esn-notification-center-header\">\r\n  <div class=\"esn-notification-center-title\">Notifications</div>\r\n  <div class=\"esn-notification-center-subtitle\">Suivez les nouveaut\u00E9s dans votre centre de notifications</div>\r\n</div>\r\n<div class=\"esn-notification-center-action-bar\">\r\n  <div class=\"esn-notification-action-bar-form\" [formGroup]=\"form\">\r\n    <esn-datepicker formControlName=\"date\" label=\"Date\"></esn-datepicker>\r\n    <esn-select formControlName=\"criticality\" size=\"sm\" label=\"Criticit\u00E9\">\r\n      <esn-option *ngFor=\"let criticality of criticalities\" [value]=\"criticality\">{{criticalityLabels[criticality]}}</esn-option>\r\n    </esn-select>\r\n    <esn-checkbox formControlName=\"unread\" color=\"primary\">Uniquement les non-lus<span *ngIf=\"!!totalUnread\"> ({{totalUnread}})</span></esn-checkbox>\r\n  </div>\r\n  <esn-button\r\n    *ngIf=\"!this.form.value.date && (!this.form.value.criticality || this.form.value.criticality == 'NONE')\"\r\n    class=\"esn-notification-center-mark-all-as-read-btn\"\r\n    type=\"basic\"\r\n    color=\"primary\"\r\n    size=\"sm\"\r\n    (click)=\"markAllAsRead()\"\r\n    >Tout marquer comme lu</esn-button\r\n  >\r\n</div>\r\n<esn-notification-list\r\n  [unread]=\"form.value.unread\"\r\n  [dateBefore]=\"dateAtEndOfDay\"\r\n  [dateAfter]=\"form.value.date\"\r\n  [criticality]=\"form.value.criticality != 'NONE' ? form.value.criticality : null\"\r\n  [refreshSubject$]=\"refresh$\"\r\n  [scrollElement]=\"scrollElement\"\r\n  [markAllAsReadSubject$]=\"markAllAsRead$\"\r\n></esn-notification-list>\r\n", styles: [":host .esn-notification-center-header{margin-bottom:1.5rem}:host .esn-notification-center-header .esn-notification-center-title{margin-bottom:.375rem;font-size:2rem;margin:.67rem 0;font-weight:700}:host .esn-notification-center-action-bar{display:flex;justify-content:space-between}:host .esn-notification-center-action-bar .esn-notification-center-mark-all-as-read-btn{margin-right:1rem}:host .esn-notification-center-action-bar .esn-notification-action-bar-form{display:flex;align-items:center;flex-grow:1}:host .esn-notification-center-action-bar .esn-notification-action-bar-form :not(:last-child){margin-right:1rem}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-input,:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-select{margin-bottom:0}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-input{margin-top:18px}:host .esn-notification-center-action-bar .esn-notification-action-bar-form .esn-select{margin-top:15px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.EsnNotificationsService }, { type: i2.EsnNotificationProcessingService }, { type: i0.ElementRef }, { type: i3.FormBuilder }]; }, propDecorators: { scrollElement: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWNlbnRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcm9tLWRvbWFpbi1pcG5uLWM5MC1kZXNpZ24tbGliL3NyYy9saWIvY29tcG9uZW50cy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLWNlbnRlci9ub3RpZmljYXRpb24tY2VudGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Fyb20tZG9tYWluLWlwbm4tYzkwLWRlc2lnbi1saWIvc3JjL2xpYi9jb21wb25lbnRzL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24tY2VudGVyL25vdGlmaWNhdGlvbi1jZW50ZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFHVCxLQUFLLEdBQ04sTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV2QyxPQUFPLEVBQ0wsOEJBQThCLEVBQzlCLCtCQUErQixHQUNoQyxNQUFNLHVCQUF1QixDQUFDOzs7Ozs7Ozs7Ozs7QUFXL0IsTUFBTSxPQUFPLHFCQUFxQjtJQWdCaEMsWUFDUyxvQkFBNkMsRUFDN0MsaUJBQW1ELEVBQ25ELFVBQXNCLEVBQzdCLEVBQWU7UUFIUix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXlCO1FBQzdDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBa0M7UUFDbkQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQWhCeEIsZ0JBQVcsR0FBVyxDQUFDLENBQUM7UUFDeEIsa0JBQWEsR0FBVyxDQUFDLENBQUM7UUFDMUIsYUFBUSxHQUE2QixJQUFJLGVBQWUsQ0FDN0QsS0FBSyxDQUNOLENBQUM7UUFDSyxtQkFBYyxHQUE2QixJQUFJLGVBQWUsQ0FDbkUsS0FBSyxDQUNOLENBQUM7UUFDSyxrQkFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQ2hDLDhCQUE4QixDQUNLLENBQUM7UUFDL0Isc0JBQWlCLEdBQUcsK0JBQStCLENBQUM7UUFRekQsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ25CLFdBQVcsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDekIsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztZQUNsQixNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDO1NBQ3JCLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV6QixJQUFJLENBQUMsb0JBQW9CO2FBQ3RCLFNBQVMsRUFBRTthQUNYLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLG9CQUFvQjthQUN0QixRQUFRLEVBQUU7YUFDVixTQUFTLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxJQUFJLGNBQWM7UUFDaEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtZQUNWLElBQUksWUFBWSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ2pDLFlBQVksR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQztZQUNuRSxPQUFPLFlBQVksQ0FBQTtTQUNwQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVNLGFBQWE7UUFDbEIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2hDLENBQUM7O21IQXhEVSxxQkFBcUI7dUdBQXJCLHFCQUFxQixnS0N2QmxDLDBrREErQkE7NEZEUmEscUJBQXFCO2tCQVJqQyxTQUFTOytCQUNFLHlCQUF5QixRQUc3Qjt3QkFDSixLQUFLLEVBQUUseUJBQXlCO3FCQUNqQztnTkFHUSxhQUFhO3NCQUFyQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgT25Jbml0LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgSW5wdXQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEVzbk5vdGlmaWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9ucy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEVzbk5vdGlmaWNhdGlvblByb2Nlc3NpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXByb2Nlc3Npbmcuc2VydmljZSc7XHJcbmltcG9ydCB7XHJcbiAgRXNuTm90aWZpY2F0aW9uQ3JpdGljYWxpdHlFbnVtLFxyXG4gIE5PVElGSUNBVElPTl9DUklUSUNBTElUWV9MQUJFTFMsXHJcbn0gZnJvbSAnLi4vbW9kZWwvbm90aWZpY2F0aW9uJztcclxuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnZXNuLW5vdGlmaWNhdGlvbi1jZW50ZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9ub3RpZmljYXRpb24tY2VudGVyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9ub3RpZmljYXRpb24tY2VudGVyLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgaG9zdDoge1xyXG4gICAgY2xhc3M6ICdlc24tbm90aWZpY2F0aW9uLWNlbnRlcicsXHJcbiAgfSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEVzbk5vdGlmaWNhdGlvbkNlbnRlciBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KCkgc2Nyb2xsRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgcHVibGljIGZvcm06IEZvcm1Hcm91cDtcclxuICBwdWJsaWMgdG90YWxVbnJlYWQ6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIHRvdGFsTmJOb3RpZnM6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIHJlZnJlc2gkOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KFxyXG4gICAgZmFsc2VcclxuICApO1xyXG4gIHB1YmxpYyBtYXJrQWxsQXNSZWFkJDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihcclxuICAgIGZhbHNlXHJcbiAgKTtcclxuICBwdWJsaWMgY3JpdGljYWxpdGllcyA9IE9iamVjdC5rZXlzKFxyXG4gICAgRXNuTm90aWZpY2F0aW9uQ3JpdGljYWxpdHlFbnVtXHJcbiAgKSBhcyBFc25Ob3RpZmljYXRpb25Dcml0aWNhbGl0eUVudW1bXTtcclxuICBwdWJsaWMgY3JpdGljYWxpdHlMYWJlbHMgPSBOT1RJRklDQVRJT05fQ1JJVElDQUxJVFlfTEFCRUxTO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBub3RpZmljYXRpb25zU2VydmljZTogRXNuTm90aWZpY2F0aW9uc1NlcnZpY2UsXHJcbiAgICBwdWJsaWMgcHJvY2Vzc2luZ1NlcnZpY2U6IEVzbk5vdGlmaWNhdGlvblByb2Nlc3NpbmdTZXJ2aWNlLFxyXG4gICAgcHVibGljIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBmYjogRm9ybUJ1aWxkZXJcclxuICApIHtcclxuICAgIHRoaXMuZm9ybSA9IGZiLmdyb3VwKHtcclxuICAgICAgY3JpdGljYWxpdHk6IFtudWxsLCBudWxsXSxcclxuICAgICAgZGF0ZTogW251bGwsIG51bGxdLFxyXG4gICAgICB1bnJlYWQ6IFtudWxsLCBudWxsXSxcclxuICAgIH0pO1xyXG4gICAgdGhpcy5mb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUoKHZhbCkgPT4ge1xyXG4gICAgICB0aGlzLnJlZnJlc2gkLm5leHQodHJ1ZSlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnJlZnJlc2gkLm5leHQodHJ1ZSk7XHJcblxyXG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZVxyXG4gICAgICAuZ2V0VW5yZWFkKClcclxuICAgICAgLnN1YnNjcmliZSgodW5yZWFkKSA9PiAodGhpcy50b3RhbFVucmVhZCA9IHVucmVhZCkpO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZVxyXG4gICAgICAuZ2V0VG90YWwoKVxyXG4gICAgICAuc3Vic2NyaWJlKCh0b3RhbCkgPT4gKHRoaXMudG90YWxOYk5vdGlmcyA9IHRvdGFsKSk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0ZUF0RW5kT2ZEYXkoKSB7XHJcbiAgICBjb25zdCBkYXRlID0gdGhpcy5mb3JtPy52YWx1ZT8uZGF0ZTtcclxuICAgIGlmICghIWRhdGUpIHtcclxuICAgICAgbGV0IGVuZE9mRGF5RGF0ZSA9IG5ldyBEYXRlKGRhdGUpXHJcbiAgICAgIGVuZE9mRGF5RGF0ZSA9IG5ldyBEYXRlKGVuZE9mRGF5RGF0ZS5nZXRUaW1lKCkgKyAyNCAqIDM2MDAgKiAxMDAwKTtcclxuICAgICAgcmV0dXJuIGVuZE9mRGF5RGF0ZVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRhdGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbWFya0FsbEFzUmVhZCgpIHtcclxuICAgIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UubWFya0FsbEFzUmVhZCgpO1xyXG4gICAgdGhpcy5tYXJrQWxsQXNSZWFkJC5uZXh0KHRydWUpXHJcbiAgfVxyXG59XHJcbiIsIjxkaXYgY2xhc3M9XCJlc24tbm90aWZpY2F0aW9uLWNlbnRlci1oZWFkZXJcIj5cclxuICA8ZGl2IGNsYXNzPVwiZXNuLW5vdGlmaWNhdGlvbi1jZW50ZXItdGl0bGVcIj5Ob3RpZmljYXRpb25zPC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cImVzbi1ub3RpZmljYXRpb24tY2VudGVyLXN1YnRpdGxlXCI+U3VpdmV6IGxlcyBub3V2ZWF1dMOpcyBkYW5zIHZvdHJlIGNlbnRyZSBkZSBub3RpZmljYXRpb25zPC9kaXY+XHJcbjwvZGl2PlxyXG48ZGl2IGNsYXNzPVwiZXNuLW5vdGlmaWNhdGlvbi1jZW50ZXItYWN0aW9uLWJhclwiPlxyXG4gIDxkaXYgY2xhc3M9XCJlc24tbm90aWZpY2F0aW9uLWFjdGlvbi1iYXItZm9ybVwiIFtmb3JtR3JvdXBdPVwiZm9ybVwiPlxyXG4gICAgPGVzbi1kYXRlcGlja2VyIGZvcm1Db250cm9sTmFtZT1cImRhdGVcIiBsYWJlbD1cIkRhdGVcIj48L2Vzbi1kYXRlcGlja2VyPlxyXG4gICAgPGVzbi1zZWxlY3QgZm9ybUNvbnRyb2xOYW1lPVwiY3JpdGljYWxpdHlcIiBzaXplPVwic21cIiBsYWJlbD1cIkNyaXRpY2l0w6lcIj5cclxuICAgICAgPGVzbi1vcHRpb24gKm5nRm9yPVwibGV0IGNyaXRpY2FsaXR5IG9mIGNyaXRpY2FsaXRpZXNcIiBbdmFsdWVdPVwiY3JpdGljYWxpdHlcIj57e2NyaXRpY2FsaXR5TGFiZWxzW2NyaXRpY2FsaXR5XX19PC9lc24tb3B0aW9uPlxyXG4gICAgPC9lc24tc2VsZWN0PlxyXG4gICAgPGVzbi1jaGVja2JveCBmb3JtQ29udHJvbE5hbWU9XCJ1bnJlYWRcIiBjb2xvcj1cInByaW1hcnlcIj5VbmlxdWVtZW50IGxlcyBub24tbHVzPHNwYW4gKm5nSWY9XCIhIXRvdGFsVW5yZWFkXCI+ICh7e3RvdGFsVW5yZWFkfX0pPC9zcGFuPjwvZXNuLWNoZWNrYm94PlxyXG4gIDwvZGl2PlxyXG4gIDxlc24tYnV0dG9uXHJcbiAgICAqbmdJZj1cIiF0aGlzLmZvcm0udmFsdWUuZGF0ZSAmJiAoIXRoaXMuZm9ybS52YWx1ZS5jcml0aWNhbGl0eSB8fCB0aGlzLmZvcm0udmFsdWUuY3JpdGljYWxpdHkgPT0gJ05PTkUnKVwiXHJcbiAgICBjbGFzcz1cImVzbi1ub3RpZmljYXRpb24tY2VudGVyLW1hcmstYWxsLWFzLXJlYWQtYnRuXCJcclxuICAgIHR5cGU9XCJiYXNpY1wiXHJcbiAgICBjb2xvcj1cInByaW1hcnlcIlxyXG4gICAgc2l6ZT1cInNtXCJcclxuICAgIChjbGljayk9XCJtYXJrQWxsQXNSZWFkKClcIlxyXG4gICAgPlRvdXQgbWFycXVlciBjb21tZSBsdTwvZXNuLWJ1dHRvblxyXG4gID5cclxuPC9kaXY+XHJcbjxlc24tbm90aWZpY2F0aW9uLWxpc3RcclxuICBbdW5yZWFkXT1cImZvcm0udmFsdWUudW5yZWFkXCJcclxuICBbZGF0ZUJlZm9yZV09XCJkYXRlQXRFbmRPZkRheVwiXHJcbiAgW2RhdGVBZnRlcl09XCJmb3JtLnZhbHVlLmRhdGVcIlxyXG4gIFtjcml0aWNhbGl0eV09XCJmb3JtLnZhbHVlLmNyaXRpY2FsaXR5ICE9ICdOT05FJyA/IGZvcm0udmFsdWUuY3JpdGljYWxpdHkgOiBudWxsXCJcclxuICBbcmVmcmVzaFN1YmplY3QkXT1cInJlZnJlc2gkXCJcclxuICBbc2Nyb2xsRWxlbWVudF09XCJzY3JvbGxFbGVtZW50XCJcclxuICBbbWFya0FsbEFzUmVhZFN1YmplY3QkXT1cIm1hcmtBbGxBc1JlYWQkXCJcclxuPjwvZXNuLW5vdGlmaWNhdGlvbi1saXN0PlxyXG4iXX0=