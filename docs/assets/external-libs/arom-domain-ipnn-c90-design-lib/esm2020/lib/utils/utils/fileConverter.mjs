import { saveAs } from 'file-saver';
export class EsnFileConverter {
    static async cutBlobIntoChunks(item, fileChunkMaxSize) {
        const chunks = [];
        const blob = await EsnFileConverter.base64ToBlob(item.blobString);
        for (let start = 0, index = 0; start < blob.size; start += fileChunkMaxSize, index++) {
            const chunk = blob.slice(start, start + fileChunkMaxSize);
            chunks.push(chunk);
        }
        if (!chunks.length) {
            chunks.push(blob);
        }
        return chunks;
    }
    // To compute the checksum
    static getFileBuffer(file) {
        return new Promise((resolve, reject) => {
            const fr = new FileReader();
            fr.onload = () => {
                resolve(fr.result);
            };
            fr.onerror = (error) => {
                reject(error);
            };
            fr.readAsArrayBuffer(file);
        });
    }
    // To display the image
    static getFileBase64(file) {
        return new Promise((resolve, reject) => {
            const fr = new FileReader();
            fr.onload = () => {
                resolve(fr.result);
            };
            fr.onerror = (error) => {
                reject(error);
            };
            fr.readAsDataURL(file);
        });
    }
    // To display a thumbnail
    static getImgFromBlob(file, maxWidth = 100, maxHeight = 100) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = document.createElement('img');
                img.src = e.target?.result;
                img.onload = function (e2) {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    ctx?.drawImage(img, 0, 0);
                    canvas.width = img.width;
                    canvas.height = img.height;
                    // calculate the new width / height respecting the original ratio
                    if (img.width > img.height) {
                        if (img.width > maxWidth) {
                            canvas.height *= maxWidth / img.width;
                            canvas.width = maxWidth;
                        }
                    }
                    else {
                        if (img.height > maxHeight) {
                            canvas.width *= maxHeight / img.height;
                            canvas.height = maxHeight;
                        }
                    }
                    // resize
                    const ctx2 = canvas.getContext('2d');
                    ctx2?.drawImage(img, 0, 0, canvas.width, canvas.height);
                    // TODO : convert to webp
                    // canvas.toBlob( blob => {
                    //   resolve(URL.createObjectURL(blob))
                    // }, 'image/webp')
                    const dataUrl = canvas.toDataURL(file.type);
                    resolve({ dataUrl, width: canvas.width, height: canvas.height });
                };
                img.onerror = (error) => {
                    reject(error);
                };
            };
            reader.onerror = (error) => {
                reject(error);
            };
            reader.readAsDataURL(file);
        });
    }
    static getImgDimensions(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = document.createElement('img');
                img.src = e.target?.result;
                img.onload = function (e2) {
                    resolve({
                        width: img.width,
                        height: img.height,
                    });
                };
                img.onerror = (error) => {
                    reject(error);
                };
            };
            reader.onerror = (error) => {
                reject(error);
            };
            reader.readAsDataURL(file);
        });
    }
    static roundValue(value) {
        return value ? Math.ceil(value) : 0;
    }
    /*******************/
    /* DATA CONVERSION
    /*******************/
    static bufferToBase64(buffer) {
        const data = buffer.reduce((acc, i) => (acc += String.fromCharCode.apply(null, [i])), '');
        return btoa(data);
    }
    static base64ToBuffer(b64) {
        return Uint8Array.from(atob(b64), (c) => c.charCodeAt(null));
    }
    static blobToBase64(blob) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onerror = reject;
            reader.onload = () => {
                resolve(reader.result);
            };
            reader.readAsDataURL(blob);
        });
    }
    static async base64ToBlob(b64) {
        console.log({ b64 });
        if (b64 === 'data:') {
            return new Blob([]);
        }
        return this.buildBlob(b64);
    }
    static async buildBlob(dataURL) {
        const BASE64_MARKER = ';base64,';
        const parts = dataURL.split(BASE64_MARKER);
        const contentType = parts[0].split(':')[1];
        const raw = window.atob(parts[1]);
        const rawLength = raw.length;
        const uInt8Array = new Uint8Array(rawLength);
        for (let i = 0; i < rawLength; ++i) {
            uInt8Array[i] = raw.charCodeAt(i);
        }
        return new Blob([uInt8Array], { type: contentType });
    }
    static async getImageFromBlobItem(item, maxWidth = 320, maxHeight = 256) {
        const blob = await EsnFileConverter.base64ToBlob(item.blobString);
        const file = EsnFileConverter.blobToFile(blob, item.filename);
        const image = await EsnFileConverter.getImgFromBlob(file, maxWidth, maxHeight);
        return image;
    }
    static async getThumbnailUrlFromBlob(item) {
        return (await EsnFileConverter.getImageFromBlobItem(item)).dataUrl;
    }
    static async customMetadataDtoToBlobItem(customMetadata) {
        const blobString = await EsnFileConverter.blobToBase64(customMetadata.blob);
        return {
            filename: customMetadata.filename,
            uuid: customMetadata.externalUuid,
            size: customMetadata.size,
            contentType: document.contentType,
            blobString: blobString,
        };
    }
    static async customMetadataDtosToBlobItems(customMetadata) {
        const promises = [];
        customMetadata.forEach((doc) => promises.push(EsnFileConverter.customMetadataDtoToBlobItem(doc)));
        return Promise.all(promises);
    }
    static saveFile(blob, fileName, fileType) {
        const file = new Blob([blob], { type: fileType });
        saveAs(file, fileName); // TODO pour plus tard: Ã  changer par https://blog.excalidraw.com/browser-fs-access/
    }
    static convertFileMetaDataToDocument(file, loading = false, actions = {
        delete: false,
        download: true,
        view: false,
        upload: false,
    }) {
        return {
            metadata: file,
            loading,
            actions,
        };
    }
}
EsnFileConverter.blobToFile = (theBlob, fileName) => {
    var b = theBlob;
    b.lastModifiedDate = new Date();
    b.name = fileName;
    return theBlob;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZUNvbnZlcnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Fyb20tZG9tYWluLWlwbm4tYzkwLWRlc2lnbi1saWIvc3JjL2xpYi91dGlscy91dGlscy9maWxlQ29udmVydGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFJcEMsTUFBTSxPQUFPLGdCQUFnQjtJQUMzQixNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQWMsRUFBRSxnQkFBd0I7UUFDckUsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLE1BQU0sSUFBSSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVsRSxLQUNFLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUN4QixLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksRUFDakIsS0FBSyxJQUFJLGdCQUFnQixFQUFFLEtBQUssRUFBRSxFQUNsQztZQUNBLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDcEI7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ25CO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELDBCQUEwQjtJQUMxQixNQUFNLENBQUMsYUFBYSxDQUFDLElBQVM7UUFDNUIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNyQyxNQUFNLEVBQUUsR0FBRyxJQUFJLFVB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QyxHQUFRLE9BQU8sQ0FBQztJQUNyQixDQUFDLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUNoQyxDQUFDLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUNsQixPQUFhLE9BQU8sQ0FBQztBQUN2QixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzYXZlQXMgfSBmcm9tICdmaWxlLXNhdmVyJztcclxuaW1wb3J0IHsgQmxvYkl0ZW0sIEN1c3RvbUZpbGVNZXRhZGF0YUR0bywgRG9jdW1lbnRJdGVtLCBGaWxlTWV0YWRhdGFEdG8sIEltYWdlIH0gZnJvbSAnLi4vcHVibGljLWFwaSc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEVzbkZpbGVDb252ZXJ0ZXIge1xyXG4gIHN0YXRpYyBhc3luYyBjdXRCbG9iSW50b0NodW5rcyhpdGVtOiBCbG9iSXRlbSwgZmlsZUNodW5rTWF4U2l6ZTogbnVtYmVyKTogUHJvbWlzZTxCbG9iW10+IHtcclxuICAgIGNvbnN0IGNodW5rcyA9IFtdO1xyXG4gICAgY29uc3QgYmxvYiA9IGF3YWl0IEVzbkZpbGVDb252ZXJ0ZXIuYmFzZTY0VG9CbG9iKGl0ZW0uYmxvYlN0cmluZyk7XHJcblxyXG4gICAgZm9yIChcclxuICAgICAgbGV0IHN0YXJ0ID0gMCwgaW5kZXggPSAwO1xyXG4gICAgICBzdGFydCA8IGJsb2Iuc2l6ZTtcclxuICAgICAgc3RhcnQgKz0gZmlsZUNodW5rTWF4U2l6ZSwgaW5kZXgrK1xyXG4gICAgKSB7XHJcbiAgICAgIGNvbnN0IGNodW5rID0gYmxvYi5zbGljZShzdGFydCwgc3RhcnQgKyBmaWxlQ2h1bmtNYXhTaXplKTtcclxuICAgICAgY2h1bmtzLnB1c2goY2h1bmspO1xyXG4gICAgfVxyXG4gICAgaWYgKCFjaHVua3MubGVuZ3RoKSB7XHJcbiAgICAgIGNodW5rcy5wdXNoKGJsb2IpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNodW5rcztcclxuICB9XHJcblxyXG4gIC8vIFRvIGNvbXB1dGUgdGhlIGNoZWNrc3VtXHJcbiAgc3RhdGljIGdldEZpbGVCdWZmZXIoZmlsZTogYW55KTogUHJvbWlzZTxBcnJheUJ1ZmZlcj4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgZnIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICBmci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShmci5yZXN1bHQgYXMgQXJyYXlCdWZmZXIpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgZnIub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICAgIGZyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBUbyBkaXNwbGF5IHRoZSBpbWFnZVxyXG4gIHN0YXRpYyBnZXRGaWxlQmFzZTY0KGZpbGU6IEZpbGUpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgZnIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICBmci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShmci5yZXN1bHQgYXMgc3RyaW5nKTtcclxuICAgICAgfTtcclxuICAgICAgZnIub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICAgIGZyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFRvIGRpc3BsYXkgYSB0aHVtYm5haWxcclxuICBzdGF0aWMgZ2V0SW1nRnJvbUJsb2IoXHJcbiAgICBmaWxlOiBGaWxlLFxyXG4gICAgbWF4V2lkdGg6IG51bWJlciA9IDEwMCxcclxuICAgIG1heEhlaWdodDogbnVtYmVyID0gMTAwXHJcbiAgKTogUHJvbWlzZTxJbWFnZT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHJcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICAgIGltZy5zcmMgPSBlLnRhcmdldD8ucmVzdWx0IGFzIHN0cmluZztcclxuICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKGUyKSB7XHJcbiAgICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgICAgY3R4Py5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuXHJcbiAgICAgICAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XHJcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodDtcclxuXHJcbiAgICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG5ldyB3aWR0aCAvIGhlaWdodCByZXNwZWN0aW5nIHRoZSBvcmlnaW5hbCByYXRpb1xyXG4gICAgICAgICAgaWYgKGltZy53aWR0aCA+IGltZy5oZWlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKGltZy53aWR0aCA+IG1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCAqPSBtYXhXaWR0aCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBtYXhXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGltZy5oZWlnaHQgPiBtYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgICBjYW52YXMud2lkdGggKj0gbWF4SGVpZ2h0IC8gaW1nLmhlaWdodDtcclxuICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gbWF4SGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gcmVzaXplXHJcbiAgICAgICAgICBjb25zdCBjdHgyID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICBjdHgyPy5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICAgICAgICAgIC8vIFRPRE8gOiBjb252ZXJ0IHRvIHdlYnBcclxuICAgICAgICAgIC8vIGNhbnZhcy50b0Jsb2IoIGJsb2IgPT4ge1xyXG4gICAgICAgICAgLy8gICByZXNvbHZlKFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikpXHJcbiAgICAgICAgICAvLyB9LCAnaW1hZ2Uvd2VicCcpXHJcblxyXG4gICAgICAgICAgY29uc3QgZGF0YVVybCA9IGNhbnZhcy50b0RhdGFVUkwoZmlsZS50eXBlKTtcclxuICAgICAgICAgIHJlc29sdmUoeyBkYXRhVXJsLCB3aWR0aDogY2FudmFzLndpZHRoLCBoZWlnaHQ6IGNhbnZhcy5oZWlnaHQgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW1nLm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgfTtcclxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICB9O1xyXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldEltZ0RpbWVuc2lvbnMoXHJcbiAgICBmaWxlOiBGaWxlXHJcbiAgKTogUHJvbWlzZTx7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH0+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblxyXG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICBpbWcuc3JjID0gZS50YXJnZXQ/LnJlc3VsdCBhcyBzdHJpbmc7XHJcbiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uIChlMikge1xyXG4gICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgIHdpZHRoOiBpbWcud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogaW1nLmhlaWdodCxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGltZy5vbmVycm9yID0gKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH07XHJcbiAgICAgIHJlYWRlci5vbmVycm9yID0gKGVycm9yKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgfTtcclxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyByb3VuZFZhbHVlKHZhbHVlOiBudW1iZXIgfCBudWxsIHwgdW5kZWZpbmVkKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB2YWx1ZSA/IE1hdGguY2VpbCh2YWx1ZSkgOiAwO1xyXG4gIH1cclxuXHJcbiAgLyoqKioqKioqKioqKioqKioqKiovXHJcblxyXG4gIC8qIERBVEEgQ09OVkVSU0lPTlxyXG4gIC8qKioqKioqKioqKioqKioqKioqL1xyXG4gIHN0YXRpYyBidWZmZXJUb0Jhc2U2NChidWZmZXI6IFVpbnQ4QXJyYXkpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgZGF0YSA9IGJ1ZmZlci5yZWR1Y2UoXHJcbiAgICAgIChhY2MsIGkpID0+IChhY2MgKz0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBbaV0pKSxcclxuICAgICAgJydcclxuICAgICk7XHJcbiAgICByZXR1cm4gYnRvYShkYXRhKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBiYXNlNjRUb0J1ZmZlcihiNjQ6IHN0cmluZyk6IFVpbnQ4QXJyYXkge1xyXG4gICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbShhdG9iKGI2NCksIChjKSA9PiBjLmNoYXJDb2RlQXQoPGFueT5udWxsKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgYmxvYlRvQmFzZTY0KGJsb2I6IEJsb2IpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7XHJcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZSg8c3RyaW5nPnJlYWRlci5yZXN1bHQpO1xyXG4gICAgICB9O1xyXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGFzeW5jIGJhc2U2NFRvQmxvYihiNjQ6IHN0cmluZyk6IFByb21pc2U8QmxvYj4ge1xyXG4gICAgY29uc29sZS5sb2coeyBiNjQgfSk7XHJcbiAgICBpZiAoYjY0ID09PSAnZGF0YTonKSB7XHJcbiAgICAgIHJldHVybiBuZXcgQmxvYihbXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5idWlsZEJsb2IoYjY0KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhc3luYyBidWlsZEJsb2IoZGF0YVVSTDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBCQVNFNjRfTUFSS0VSID0gJztiYXNlNjQsJztcclxuICAgIGNvbnN0IHBhcnRzID0gZGF0YVVSTC5zcGxpdChCQVNFNjRfTUFSS0VSKTtcclxuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcGFydHNbMF0uc3BsaXQoJzonKVsxXTtcclxuICAgIGNvbnN0IHJhdyA9IHdpbmRvdy5hdG9iKHBhcnRzWzFdKTtcclxuICAgIGNvbnN0IHJhd0xlbmd0aCA9IHJhdy5sZW5ndGg7XHJcbiAgICBjb25zdCB1SW50OEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmF3TGVuZ3RoKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhd0xlbmd0aDsgKytpKSB7XHJcbiAgICAgIHVJbnQ4QXJyYXlbaV0gPSByYXcuY2hhckNvZGVBdChpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IEJsb2IoW3VJbnQ4QXJyYXldLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGJsb2JUb0ZpbGUgPSAodGhlQmxvYjogQmxvYiwgZmlsZU5hbWU6IHN0cmluZyk6IEZpbGUgPT4ge1xyXG4gICAgdmFyIGI6IGFueSA9IHRoZUJsb2I7XHJcbiAgICBiLmxhc3RNb2RpZmllZERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgYi5uYW1lID0gZmlsZU5hbWU7XHJcbiAgICByZXR1cm4gPEZpbGU+dGhlQmxvYjtcclxuICB9O1xyXG5cclxuICBzdGF0aWMgYXN5bmMgZ2V0SW1hZ2VGcm9tQmxvYkl0ZW0oXHJcbiAgICBpdGVtOiBCbG9iSXRlbSxcclxuICAgIG1heFdpZHRoOiBudW1iZXIgPSAzMjAsXHJcbiAgICBtYXhIZWlnaHQ6IG51bWJlciA9IDI1NlxyXG4gICkge1xyXG4gICAgY29uc3QgYmxvYiA9IGF3YWl0IEVzbkZpbGVDb252ZXJ0ZXIuYmFzZTY0VG9CbG9iKGl0ZW0uYmxvYlN0cmluZyk7XHJcbiAgICBjb25zdCBmaWxlID0gRXNuRmlsZUNvbnZlcnRlci5ibG9iVG9GaWxlKGJsb2IsIGl0ZW0uZmlsZW5hbWUpO1xyXG4gICAgY29uc3QgaW1hZ2UgPSBhd2FpdCBFc25GaWxlQ29udmVydGVyLmdldEltZ0Zyb21CbG9iKGZpbGUsIG1heFdpZHRoLCBtYXhIZWlnaHQpO1xyXG4gICAgcmV0dXJuIGltYWdlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGFzeW5jIGdldFRodW1ibmFpbFVybEZyb21CbG9iKGl0ZW06IEJsb2JJdGVtKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiAoYXdhaXQgRXNuRmlsZUNvbnZlcnRlci5nZXRJbWFnZUZyb21CbG9iSXRlbShpdGVtKSkuZGF0YVVybDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhc3luYyBjdXN0b21NZXRhZGF0YUR0b1RvQmxvYkl0ZW0oXHJcbiAgICBjdXN0b21NZXRhZGF0YTogQ3VzdG9tRmlsZU1ldGFkYXRhRHRvXHJcbiAgKTogUHJvbWlzZTxCbG9iSXRlbT4ge1xyXG4gICAgY29uc3QgYmxvYlN0cmluZyA9IGF3YWl0IEVzbkZpbGVDb252ZXJ0ZXIuYmxvYlRvQmFzZTY0KGN1c3RvbU1ldGFkYXRhLmJsb2IhKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGZpbGVuYW1lOiBjdXN0b21NZXRhZGF0YS5maWxlbmFtZSxcclxuICAgICAgdXVpZDogY3VzdG9tTWV0YWRhdGEuZXh0ZXJuYWxVdWlkLFxyXG4gICAgICBzaXplOiBjdXN0b21NZXRhZGF0YS5zaXplLFxyXG4gICAgICBjb250ZW50VHlwZTogZG9jdW1lbnQuY29udGVudFR5cGUsXHJcbiAgICAgIGJsb2JTdHJpbmc6IGJsb2JTdHJpbmcsXHJcbiAgICB9IGFzIEJsb2JJdGVtO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGFzeW5jIGN1c3RvbU1ldGFkYXRhRHRvc1RvQmxvYkl0ZW1zKFxyXG4gICAgY3VzdG9tTWV0YWRhdGE6IEN1c3RvbUZpbGVNZXRhZGF0YUR0b1tdXHJcbiAgKSB7XHJcbiAgICBjb25zdCBwcm9taXNlczogUHJvbWlzZTxCbG9iSXRlbT5bXSA9IFtdO1xyXG4gICAgY3VzdG9tTWV0YWRhdGEuZm9yRWFjaCgoZG9jKSA9PlxyXG4gICAgICBwcm9taXNlcy5wdXNoKEVzbkZpbGVDb252ZXJ0ZXIuY3VzdG9tTWV0YWRhdGFEdG9Ub0Jsb2JJdGVtKGRvYykpXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzYXZlRmlsZShibG9iOiBCbG9iLCBmaWxlTmFtZTogc3RyaW5nLCBmaWxlVHlwZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoW2Jsb2JdLCB7IHR5cGU6IGZpbGVUeXBlIH0pO1xyXG4gICAgc2F2ZUFzKGZpbGUsIGZpbGVOYW1lKTsgLy8gVE9ETyBwb3VyIHBsdXMgdGFyZDogw6AgY2hhbmdlciBwYXIgaHR0cHM6Ly9ibG9nLmV4Y2FsaWRyYXcuY29tL2Jyb3dzZXItZnMtYWNjZXNzL1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNvbnZlcnRGaWxlTWV0YURhdGFUb0RvY3VtZW50KFxyXG4gICAgZmlsZTogRmlsZU1ldGFkYXRhRHRvIHwgQ3VzdG9tRmlsZU1ldGFkYXRhRHRvLFxyXG4gICAgbG9hZGluZzogYm9vbGVhbiA9IGZhbHNlLFxyXG4gICAgYWN0aW9uczogYW55ID0ge1xyXG4gICAgICBkZWxldGU6IGZhbHNlLFxyXG4gICAgICBkb3dubG9hZDogdHJ1ZSxcclxuICAgICAgdmlldzogZmFsc2UsXHJcbiAgICAgIHVwbG9hZDogZmFsc2UsXHJcbiAgICB9XHJcbiAgKTogRG9jdW1lbnRJdGVtIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1ldGFkYXRhOiBmaWxlLFxyXG4gICAgICBsb2FkaW5nLFxyXG4gICAgICBhY3Rpb25zLFxyXG4gICAgfSBhcyB1bmtub3duIGFzIERvY3VtZW50SXRlbTtcclxuICB9XHJcbn1cclxuIl19