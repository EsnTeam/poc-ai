"use strict";(self.webpackChunkpoc_gpt=self.webpackChunkpoc_gpt||[]).push([[636],{6636:(Ys,In,S)=>{S.r(In),S.d(In,{ChatModule:()=>Vs});var Ot={};S.r(Ot),S.d(Ot,{APIConnectionError:()=>Ee,APIConnectionTimeoutError:()=>qe,APIError:()=>R,APIUserAbortError:()=>D,AuthenticationError:()=>Yt,BadRequestError:()=>Vt,ConflictError:()=>zt,ContentFilterFinishReasonError:()=>rn,InternalServerError:()=>tn,LengthFinishReasonError:()=>nn,NotFoundError:()=>Qt,OpenAIError:()=>v,PermissionDeniedError:()=>Gt,RateLimitError:()=>en,UnprocessableEntityError:()=>Kt});var H=S(6895),K=S(3456),u=S(5861);const Mn_min_v1="file-XuzmoEqTKF567mQZspfp4UBZ",kn_main="vs_s4mIGjUIeHYWx6tER8fzx7KM",ue="esn-opeanai-threads",Ft="esn-ai-user-config",On={"gpt-4o":{input:5,output:15},"gpt-4o-mini":{input:.15,output:.6}};var a=S(4650);function $(r){var e,t,n,s=2;for(typeof Symbol<"u"&&(t=Symbol.asyncIterator,n=Symbol.iterator);s--;){if(t&&null!=(e=r[t]))return e.call(r);if(n&&null!=(e=r[n]))return new Ue(e.call(r));t="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Ue(r){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(s){return{value:s,done:n}})}return(Ue=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return void 0===s?Promise.resolve({value:n,done:!0}):e(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return void 0===s?Promise.reject(n):e(s.apply(this.s,arguments))}},new Ue(r)}function Fn(r,e){this.v=r,this.k=e}function k(r){return new Fn(r,0)}function Ae(r){var e,t;function n(i,o){try{var l=r[i](o),c=l.value,d=c instanceof Fn;Promise.resolve(d?c.v:c).then(function(f){if(d){var h="return"===i?"return":"next";if(!c.k||f.done)return n(h,f);f=r[h](f).value}s(l.done?"return":"normal",f)},function(f){n("throw",f)})}catch(f){s("throw",f)}}function s(i,o){switch(i){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?n(e.key,e.arg):t=null}this._invoke=function(i,o){return new Promise(function(l,c){var d={key:i,arg:o,resolve:l,reject:c,next:null};t?t=t.next=d:(e=t=d,n(i,o))})},"function"!=typeof r.return&&(this.return=void 0)}function se(r){return function(){return new Ae(r.apply(this,arguments))}}Ae.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ae.prototype.next=function(r){return this._invoke("next",r)},Ae.prototype.throw=function(r){return this._invoke("throw",r)},Ae.prototype.return=function(r){return this._invoke("return",r)};const de="4.55.4";let Se,$n,Nn,Zt,Un,jn,Bn,$t,Dn,Zn=!1,Pr=null,Rr=null,Ir=null,Mr=null;class Or{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}Se||function kr(r,e={auto:!1}){if(Zn)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Se)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Se}'\``);Zn=e.auto,Se=r.kind,$n=r.fetch,Pr=r.Request,Rr=r.Response,Ir=r.Headers,Nn=r.FormData,Mr=r.Blob,Zt=r.File,Un=r.ReadableStream,jn=r.getMultipartRequestOptions,Bn=r.getDefaultAgent,$t=r.fileFromPath,Dn=r.isFsReadStream}(function Fr({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:(o=(0,u.Z)(function*(l,c){return{...c,body:new Or(l)}}),function(c,d){return o.apply(this,arguments)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1};var o}(),{auto:!0});class Q{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;function i(){return i=se(function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{var d,l=!1,c=!1;try{for(var h,f=$(function Zr(r,e){return Nt.apply(this,arguments)}(e,t));l=!(h=yield k(f.next())).done;l=!1){const p=h.value;if(!o)if(p.data.startsWith("[DONE]"))o=!0;else if(null===p.event){let m;try{m=JSON.parse(p.data)}catch(g){throw console.error("Could not parse message into JSON:",p.data),console.error("From chunk:",p.raw),g}if(m&&m.error)throw new R(void 0,m.error,void 0,void 0);yield m}else{let m;try{m=JSON.parse(p.data)}catch(g){throw console.error("Could not parse message into JSON:",p.data),console.error("From chunk:",p.raw),g}if("error"==p.event)throw new R(void 0,m.error,m.message,void 0);yield{event:p.event,data:m}}}}catch(p){c=!0,d=p}finally{try{l&&null!=f.return&&(yield k(f.return()))}finally{if(c)throw d}}o=!0}catch(p){if(p instanceof Error&&"AbortError"===p.name)return;throw p}finally{o||t.abort()}}),i.apply(this,arguments)}return new Q(function s(){return i.apply(this,arguments)},t)}static fromReadableStream(e,t){let n=!1;function i(){return(i=se(function*(){const c=new ie,d=qn(e);var p,f=!1,h=!1;try{for(var g,m=$(d);f=!(g=yield k(m.next())).done;f=!1){const y=g.value;for(const C of c.decode(y))yield C}}catch(y){h=!0,p=y}finally{try{f&&null!=m.return&&(yield k(m.return()))}finally{if(h)throw p}}for(const y of c.flush())yield y})).apply(this,arguments)}function l(){return l=se(function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let c=!1;try{var h,d=!1,f=!1;try{for(var m,p=$(function s(){return i.apply(this,arguments)}());d=!(m=yield k(p.next())).done;d=!1){const g=m.value;c||g&&(yield JSON.parse(g))}}catch(g){f=!0,h=g}finally{try{d&&null!=p.return&&(yield k(p.return()))}finally{if(f)throw h}}c=!0}catch(g){if(g instanceof Error&&"AbortError"===g.name)return;throw g}finally{c||t.abort()}}),l.apply(this,arguments)}return new Q(function o(){return l.apply(this,arguments)},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(0===i.length){const o=n.next();e.push(o),t.push(o)}return i.shift()}});return[new Q(()=>s(e),this.controller),new Q(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Un({start:()=>(0,u.Z)(function*(){t=e[Symbol.asyncIterator]()})(),pull:s=>(0,u.Z)(function*(){try{const{value:i,done:o}=yield t.next();if(o)return s.close();const l=n.encode(JSON.stringify(i)+"\n");s.enqueue(l)}catch(i){s.error(i)}})(),cancel:()=>(0,u.Z)(function*(){yield t.return?.()})()})}}function Nt(){return Nt=se(function*(r,e){if(!r.body)throw e.abort(),new v("Attempted to iterate over a response with no body");const t=new Ur,n=new ie,s=qn(r.body);var l,i=!1,o=!1;try{for(var d,c=$(function $r(r){return Ut.apply(this,arguments)}(s));i=!(d=yield k(c.next())).done;i=!1){const f=d.value;for(const h of n.decode(f)){const p=t.decode(h);p&&(yield p)}}}catch(f){o=!0,l=f}finally{try{i&&null!=c.return&&(yield k(c.return()))}finally{if(o)throw l}}for(const f of n.flush()){const h=t.decode(f);h&&(yield h)}}),Nt.apply(this,arguments)}function Ut(){return(Ut=se(function*(r){let e=new Uint8Array;var s,t=!1,n=!1;try{for(var o,i=$(r);t=!(o=yield k(i.next())).done;t=!1){const l=o.value;{if(null==l)continue;const c=l instanceof ArrayBuffer?new Uint8Array(l):"string"==typeof l?(new TextEncoder).encode(l):l;let f,d=new Uint8Array(e.length+c.length);for(d.set(e),d.set(c,e.length),e=d;-1!==(f=Nr(e));)yield e.slice(0,f),e=e.slice(f)}}}catch(l){n=!0,s=l}finally{try{t&&null!=i.return&&(yield k(i.return()))}finally{if(n)throw s}}e.length>0&&(yield e)})).apply(this,arguments)}function Nr(r){for(let n=0;n<r.length-2;n++){if(10===r[n]&&10===r[n+1]||13===r[n]&&13===r[n+1])return n+2;if(13===r[n]&&10===r[n+1]&&n+3<r.length&&13===r[n+2]&&10===r[n+3])return n+4}return-1}class Ur{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=function jr(r,e){const t=r.indexOf(e);return-1!==t?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}(e,":");return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}class ie{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=ie.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ie.NEWLINE_REGEXP);return n&&s.pop(),1!==s.length||n?(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s):(this.buffer.push(s[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new v(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new v(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new v("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function qn(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{next:()=>(0,u.Z)(function*(){try{const t=yield e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}})(),return:()=>(0,u.Z)(function*(){const t=e.cancel();return e.releaseLock(),yield t,{done:!0,value:void 0}})(),[Symbol.asyncIterator](){return this}}}ie.NEWLINE_CHARS=new Set(["\n","\r"]),ie.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const Jn=r=>null!=r&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob,Ln=r=>null!=r&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&jt(r),jt=r=>null!=r&&"object"==typeof r&&"number"==typeof r.size&&"string"==typeof r.type&&"function"==typeof r.text&&"function"==typeof r.slice&&"function"==typeof r.arrayBuffer;function Bt(r,e,t){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,u.Z)(function*(r,e,t){if(r=yield r,t??(t=Ln(r)?{lastModified:r.lastModified,type:r.type}:{}),Jn(r)){const s=yield r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new Zt([s],e,t)}const n=yield function Br(r){return qt.apply(this,arguments)}(r);if(e||(e=function qr(r){return Jt(r.name)||Jt(r.filename)||Jt(r.path)?.split(/[\\/]/).pop()}(r)??"unknown_file"),!t.type){const s=n[0]?.type;"string"==typeof s&&(t={...t,type:s})}return new Zt(n,e,t)}),Dt.apply(this,arguments)}function qt(){return(qt=(0,u.Z)(function*(r){let e=[];if("string"==typeof r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(jt(r))e.push(yield r.arrayBuffer());else{if(!Jr(r))throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${function Dr(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}(r)}`);var s,t=!1,n=!1;try{for(var o,i=$(r);t=!(o=yield i.next()).done;t=!1)e.push(o.value)}catch(l){n=!0,s=l}finally{try{t&&null!=i.return&&(yield i.return())}finally{if(n)throw s}}}return e})).apply(this,arguments)}const Jt=r=>"string"==typeof r?r:typeof Buffer<"u"&&r instanceof Buffer?String(r):void 0,Jr=r=>null!=r&&"object"==typeof r&&"function"==typeof r[Symbol.asyncIterator],Wn=r=>r&&"object"==typeof r&&r.body&&"MultipartBody"===r[Symbol.toStringTag],fe=function(){var r=(0,u.Z)(function*(e){const t=yield Lr(e.body);return jn(t,e)});return function(t){return r.apply(this,arguments)}}(),Lr=function(){var r=(0,u.Z)(function*(e){const t=new Nn;return yield Promise.all(Object.entries(e||{}).map(([n,s])=>Lt(t,n,s))),t});return function(t){return r.apply(this,arguments)}}(),Lt=function(){var r=(0,u.Z)(function*(e,t,n){if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((r=>Ln(r)||Jn(r)||Dn(r))(n)){const s=yield Bt(n);e.append(t,s)}else if(Array.isArray(n))yield Promise.all(n.map(s=>Lt(e,t+"[]",s)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);yield Promise.all(Object.entries(n).map(([s,i])=>Lt(e,`${t}[${s}]`,i)))}}});return function(t,n,s){return r.apply(this,arguments)}}();var je;function Vn(r){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,u.Z)(function*(r){const{response:e}=r;if(r.options.stream)return he("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Q.fromSSEResponse(e,r.controller);if(204===e.status)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){const i=yield e.json();return he("response",e.status,e.url,e.headers,i),i}const s=yield e.text();return he("response",e.status,e.url,e.headers,s),s})).apply(this,arguments)}class Be extends Promise{constructor(e,t=Vn){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){var t=this;return new Be(this.responsePromise,function(){var n=(0,u.Z)(function*(s){return e(yield t.parseResponse(s))});return function(s){return n.apply(this,arguments)}}())}asResponse(){return this.responsePromise.then(e=>e.response)}withResponse(){var e=this;return(0,u.Z)(function*(){const[t,n]=yield Promise.all([e.parse(),e.asResponse()]);return{data:t,response:n}})()}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Xr{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Wt("maxRetries",t),this.timeout=Wt("timeout",n),this.httpAgent=s,this.fetch=i??$n}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Kr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${as()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(function(){var s=(0,u.Z)(function*(i){const o=i&&jt(i?.body)?new DataView(yield i.body.arrayBuffer()):i?.body instanceof DataView?i.body:i?.body instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i?.body)?new DataView(i.body.buffer):i?.body;return{method:e,path:t,...i,body:o}});return function(i){return s.apply(this,arguments)}}()))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){const{method:t,path:n,query:s,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:Wn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(n,s);"timeout"in e&&Wt("timeout",e.timeout);const d=e.timeout??this.timeout,f=e.httpAgent??this.httpAgent??Bn(c),h=d+1e3;return"number"==typeof f?.options?.timeout&&h>(f.options.timeout??0)&&(f.options.timeout=h),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...o&&{body:o},headers:this.buildHeaders({options:e,headers:i,contentLength:l}),...f&&{agent:f},signal:e.signal??null},url:c,timeout:d}}buildHeaders({options:e,headers:t,contentLength:n}){const s={};return n&&(s["content-length"]=n),tr(s,this.defaultHeaders(e)),tr(s,t),Wn(e.body)&&"node"!==Se&&delete s["content-type"],this.validateHeaders(s,t),s}prepareOptions(e){return(0,u.Z)(function*(){})()}prepareRequest(e,{}){return(0,u.Z)(function*(){})()}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return R.generate(e,t,n,s)}request(e,t=null){return new Be(this.makeRequest(e,t))}makeRequest(e,t){var n=this;return(0,u.Z)(function*(){const s=yield e;null==t&&(t=s.maxRetries??n.maxRetries),yield n.prepareOptions(s);const{req:i,url:o,timeout:l}=n.buildRequest(s);if(yield n.prepareRequest(i,{url:o,options:s}),he("request",o,s,i.headers),s.signal?.aborted)throw new D;const c=new AbortController,d=yield n.fetchWithTimeout(o,i,l,c).catch(Xt);if(d instanceof Error){if(s.signal?.aborted)throw new D;if(t)return n.retryRequest(s,t);throw"AbortError"===d.name?new qe:new Ee({cause:d})}const f=Yr(d.headers);if(!d.ok){if(t&&n.shouldRetry(d))return he(`response (error; retrying, ${t} attempts remaining)`,d.status,o,f),n.retryRequest(s,t,f);const h=yield d.text().catch(C=>Xt(C).message),p=es(h),m=p?void 0:h;throw he(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,d.status,o,f,m),n.makeStatusError(d.status,p,m,f)}return{response:d,options:s,controller:c}})()}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Vr(this,n,e)}buildURL(e,t){const n=ns(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Kn(s)||(t={...s,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(null===n)return`${encodeURIComponent(t)}=`;throw new v(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}fetchWithTimeout(e,t,n,s){var i=this;return(0,u.Z)(function*(){const{signal:o,...l}=t||{};o&&o.addEventListener("abort",()=>s.abort());const c=setTimeout(()=>s.abort(),n);return i.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...l}).finally(()=>{clearTimeout(c)})})()}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}retryRequest(e,t,n){var s=this;return(0,u.Z)(function*(){let i;const o=n?.["retry-after-ms"];if(o){const c=parseFloat(o);Number.isNaN(c)||(i=c)}const l=n?.["retry-after"];if(l&&!i){const c=parseFloat(l);i=Number.isNaN(c)?Date.parse(l)-Date.now():1e3*c}return i&&0<=i&&i<6e4||(i=s.calculateDefaultRetryTimeoutMillis(t,e.maxRetries??s.maxRetries)),yield xe(i),s.makeRequest(e,t-1)})()}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${de}`}}class Yn{constructor(e,t,n,s){je.set(this,void 0),function(r,e,t,n,s){if("function"==typeof e||!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");e.set(r,t)}(this,je,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}getNextPage(){var e=this;return(0,u.Z)(function*(){const t=e.nextPageInfo();if(!t)throw new v("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...e.options};if("params"in t&&"object"==typeof n.query)n.query={...n.query,...t.params};else if("url"in t){const s=[...Object.entries(n.query||{}),...t.url.searchParams.entries()];for(const[i,o]of s)t.url.searchParams.set(i,o);n.query=void 0,n.path=t.url.toString()}return yield function(r,e,t,n){if("function"==typeof e||!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}(e,je).requestAPIList(e.constructor,n)})()}iterPages(){var e=this;return se(function*(){let t=e;for(yield t;t.hasNextPage();)t=yield k(t.getNextPage()),yield t})()}[(je=new WeakMap,Symbol.asyncIterator)](){var e=this;return se(function*(){var s,t=!1,n=!1;try{for(var o,i=$(e.iterPages());t=!(o=yield k(i.next())).done;t=!1){const l=o.value;for(const c of l.getPaginatedItems())yield c}}catch(l){n=!0,s=l}finally{try{t&&null!=i.return&&(yield k(i.return()))}finally{if(n)throw s}}})()}}class Vr extends Be{constructor(e,t,n){super(t,function(){var s=(0,u.Z)(function*(i){return new n(e,i.response,yield Vn(i),i.options)});return function(i){return s.apply(this,arguments)}}())}[Symbol.asyncIterator](){var e=this;return se(function*(){const t=yield k(e);var i,n=!1,s=!1;try{for(var l,o=$(t);n=!(l=yield k(o.next())).done;n=!1)yield l.value}catch(c){s=!0,i=c}finally{try{n&&null!=o.return&&(yield k(o.return()))}finally{if(s)throw i}}})()}}const Yr=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Gr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},U=r=>"object"==typeof r&&null!==r&&!Kn(r)&&Object.keys(r).every(e=>er(Gr,e)),Gn=r=>"x32"===r?"x32":"x86_64"===r||"x64"===r?"x64":"arm"===r?"arm":"aarch64"===r||"arm64"===r?"arm64":r?`other:${r}`:"unknown",Qn=r=>(r=r.toLowerCase()).includes("ios")?"iOS":"android"===r?"Android":"darwin"===r?"MacOS":"win32"===r?"Windows":"freebsd"===r?"FreeBSD":"openbsd"===r?"OpenBSD":"linux"===r?"Linux":r?`Other:${r}`:"Unknown";let zn;const Kr=()=>zn??(zn=(()=>{if(typeof Deno<"u"&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":de,"X-Stainless-OS":Qn(Deno.build.os),"X-Stainless-Arch":Gn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":de,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":de,"X-Stainless-OS":Qn(process.platform),"X-Stainless-Arch":Gn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=function zr(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n)return{browser:e,version:`${n[1]||0}.${n[2]||0}.${n[3]||0}`}}return null}();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":de,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":de,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),es=r=>{try{return JSON.parse(r)}catch{return}},ts=new RegExp("^(?:[a-z]+:)?//","i"),ns=r=>ts.test(r),xe=r=>new Promise(e=>setTimeout(e,r)),Wt=(r,e)=>{if("number"!=typeof e||!Number.isInteger(e))throw new v(`${r} must be an integer`);if(e<0)throw new v(`${r} must be a positive integer`);return e},Xt=r=>r instanceof Error?r:new Error(r),De=r=>typeof process<"u"?process.env?.[r]?.trim()??void 0:typeof Deno<"u"?Deno.env?.get?.(r)?.trim():void 0;function Kn(r){if(!r)return!0;for(const e in r)return!1;return!0}function er(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function tr(r,e){for(const t in e){if(!er(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];null===s?delete r[n]:void 0!==s&&(r[n]=s)}}function he(r,...e){typeof process<"u"&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${r}`,...e)}const as=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=16*Math.random()|0;return("x"===r?e:3&e|8).toString(16)});function nr(r){return null!=r&&"object"==typeof r&&!Array.isArray(r)}class v extends Error{}class R extends v{constructor(e,t,n,s){super(`${R.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"];const i=t;this.error=i,this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){const s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new Ee({cause:Xt(t)});const i=t?.error;return 400===e?new Vt(e,i,n,s):401===e?new Yt(e,i,n,s):403===e?new Gt(e,i,n,s):404===e?new Qt(e,i,n,s):409===e?new zt(e,i,n,s):422===e?new Kt(e,i,n,s):429===e?new en(e,i,n,s):e>=500?new tn(e,i,n,s):new R(e,i,n,s)}}class D extends R{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Ee extends R{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class qe extends Ee{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Vt extends R{constructor(){super(...arguments),this.status=400}}class Yt extends R{constructor(){super(...arguments),this.status=401}}class Gt extends R{constructor(){super(...arguments),this.status=403}}class Qt extends R{constructor(){super(...arguments),this.status=404}}class zt extends R{constructor(){super(...arguments),this.status=409}}class Kt extends R{constructor(){super(...arguments),this.status=422}}class en extends R{constructor(){super(...arguments),this.status=429}}class tn extends R{}class nn extends v{constructor(){super("Could not parse response content as the length limit was reached")}}class rn extends v{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class sn extends Yn{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class W extends Yn{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class w{constructor(e){this._client=e}}class Je extends w{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Je||(Je={});class Le extends w{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}Le||(Le={});class He extends w{constructor(){super(...arguments),this.completions=new Le(this._client)}}(He||(He={})).Completions=Le;class We extends w{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}We||(We={});class Xe extends w{create(e,t){return this._client.post("/files",fe({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/files",an,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){var s=this;return(0,u.Z)(function*(){const i=new Set(["processed","error","deleted"]),o=Date.now();let l=yield s.retrieve(e);for(;!l.status||!i.has(l.status);)if(yield xe(t),l=yield s.retrieve(e),Date.now()-o>n)throw new qe({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return l})()}}class an extends sn{}(Xe||(Xe={})).FileObjectsPage=an;class Ve extends w{createVariation(e,t){return this._client.post("/images/variations",fe({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",fe({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Ve||(Ve={});class Ye extends w{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Ye||(Ye={});class Ge extends w{create(e,t){return this._client.post("/audio/transcriptions",fe({body:e,...t}))}}Ge||(Ge={});class Qe extends w{create(e,t){return this._client.post("/audio/translations",fe({body:e,...t}))}}Qe||(Qe={});class ze extends w{constructor(){super(...arguments),this.transcriptions=new Ge(this._client),this.translations=new Qe(this._client),this.speech=new Ye(this._client)}}!function(r){r.Transcriptions=Ge,r.Translations=Qe,r.Speech=Ye}(ze||(ze={}));class Ke extends w{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Ke||(Ke={});class et extends w{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",on,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class on extends sn{}!function(r){r.ModelsPage=on}(et||(et={}));class tt extends w{list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ln,{query:t,...n})}}class ln extends W{}!function(r){r.FineTuningJobCheckpointsPage=ln}(tt||(tt={}));class nt extends w{constructor(){super(...arguments),this.checkpoints=new tt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",cn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return U(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,un,{query:t,...n})}}class cn extends W{}class un extends W{}!function(r){r.FineTuningJobsPage=cn,r.FineTuningJobEventsPage=un,r.Checkpoints=tt,r.FineTuningJobCheckpointsPage=ln}(nt||(nt={}));class rt extends w{constructor(){super(...arguments),this.jobs=new nt(this._client)}}!function(r){r.Jobs=nt,r.FineTuningJobsPage=cn,r.FineTuningJobEventsPage=un}(rt||(rt={}));class st extends w{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/assistants",dn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class dn extends W{}function rr(r){return"function"==typeof r.parse}!function(r){r.AssistantsPage=dn}(st||(st={}));const pe=r=>"assistant"===r?.role,sr=r=>"function"===r?.role,ir=r=>"tool"===r?.role;var fn,it,at,Te,Pe,ot,Re,ee,Ie,lt,ct,me,ar,X=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t},A=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)};class or{constructor(){fn.add(this),this.controller=new AbortController,it.set(this,void 0),at.set(this,()=>{}),Te.set(this,()=>{}),Pe.set(this,void 0),ot.set(this,()=>{}),Re.set(this,()=>{}),ee.set(this,{}),Ie.set(this,!1),lt.set(this,!1),ct.set(this,!1),me.set(this,!1),X(this,it,new Promise((e,t)=>{X(this,at,e,"f"),X(this,Te,t,"f")}),"f"),X(this,Pe,new Promise((e,t)=>{X(this,ot,e,"f"),X(this,Re,t,"f")}),"f"),A(this,it,"f").catch(()=>{}),A(this,Pe,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},A(this,fn,"m",ar).bind(this))},0)}_connected(){this.ended||(A(this,at,"f").call(this),this._emit("connect"))}get ended(){return A(this,Ie,"f")}get errored(){return A(this,lt,"f")}get aborted(){return A(this,ct,"f")}abort(){this.controller.abort()}on(e,t){return(A(this,ee,"f")[e]||(A(this,ee,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=A(this,ee,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(A(this,ee,"f")[e]||(A(this,ee,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{X(this,me,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}done(){var e=this;return(0,u.Z)(function*(){X(e,me,!0,"f"),yield A(e,Pe,"f")})()}_emit(e,...t){if(A(this,Ie,"f"))return;"end"===e&&(X(this,Ie,!0,"f"),A(this,ot,"f").call(this));const n=A(this,ee,"f")[e];if(n&&(A(this,ee,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),"abort"===e){const s=t[0];return!A(this,me,"f")&&!n?.length&&Promise.reject(s),A(this,Te,"f").call(this,s),A(this,Re,"f").call(this,s),void this._emit("end")}if("error"===e){const s=t[0];!A(this,me,"f")&&!n?.length&&Promise.reject(s),A(this,Te,"f").call(this,s),A(this,Re,"f").call(this,s),this._emit("end")}}_emitFinal(){}}function lr(r){return"auto-parseable-response-format"===r?.$brand}function Me(r){return"auto-parseable-tool"===r?.$brand}function hn(r,e){const t=r.choices.map(n=>{if("length"===n.finish_reason)throw new nn;if("content_filter"===n.finish_reason)throw new rn;return{...n,message:{...n.message,tool_calls:n.message.tool_calls?.map(s=>function ds(r,e){const t=r.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Me(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}(e,s))??[],parsed:n.message.content&&!n.message.refusal?us(e,n.message.content):null}}});return{...r,choices:t}}function us(r,e){return"json_schema"!==r.response_format?.type?null:"json_schema"===r.response_format?.type?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function fs(r,e){if(!r)return!1;const t=r.tools?.find(n=>n.function?.name===e.function.name);return Me(t)||t?.function.strict||!1}function cr(r){return!!lr(r.response_format)||(r.tools?.some(e=>Me(e)||"function"===e.type&&!0===e.function.strict)??!1)}it=new WeakMap,at=new WeakMap,Te=new WeakMap,Pe=new WeakMap,ot=new WeakMap,Re=new WeakMap,ee=new WeakMap,Ie=new WeakMap,lt=new WeakMap,ct=new WeakMap,me=new WeakMap,fn=new WeakSet,ar=function(e){if(X(this,lt,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new D),e instanceof D)return X(this,ct,!0,"f"),this._emit("abort",e);if(e instanceof v)return this._emit("error",e);if(e instanceof Error){const t=new v(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new v(String(e)))};var O,pn,ut,mn,gn,_n,ur,yn,N=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)};const dr=10;class fr extends or{constructor(){super(...arguments),O.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(sr(e)||ir(e))&&e.content)this._emit("functionCallResult",e.content);else if(pe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(pe(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionCall",n.function)}finalChatCompletion(){var e=this;return(0,u.Z)(function*(){yield e.done();const t=e._chatCompletions[e._chatCompletions.length-1];if(!t)throw new v("stream ended without producing a ChatCompletion");return t})()}finalContent(){var e=this;return(0,u.Z)(function*(){return yield e.done(),N(e,O,"m",pn).call(e)})()}finalMessage(){var e=this;return(0,u.Z)(function*(){return yield e.done(),N(e,O,"m",ut).call(e)})()}finalFunctionCall(){var e=this;return(0,u.Z)(function*(){return yield e.done(),N(e,O,"m",mn).call(e)})()}finalFunctionCallResult(){var e=this;return(0,u.Z)(function*(){return yield e.done(),N(e,O,"m",gn).call(e)})()}totalUsage(){var e=this;return(0,u.Z)(function*(){return yield e.done(),N(e,O,"m",_n).call(e)})()}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=N(this,O,"m",ut).call(this);t&&this._emit("finalMessage",t);const n=N(this,O,"m",pn).call(this);n&&this._emit("finalContent",n);const s=N(this,O,"m",mn).call(this);s&&this._emit("finalFunctionCall",s);const i=N(this,O,"m",gn).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",N(this,O,"m",_n).call(this))}_createChatCompletion(e,t,n){var s=this;return(0,u.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort())),N(s,O,"m",ur).call(s,t);const o=yield e.chat.completions.create({...t,stream:!1},{...n,signal:s.controller.signal});return s._connected(),s._addChatCompletion(hn(o,t))})()}_runChatCompletion(e,t,n){var s=this;return(0,u.Z)(function*(){for(const i of t.messages)s._addMessage(i,!1);return yield s._createChatCompletion(e,t,n)})()}_runFunctions(e,t,n){var s=this;return(0,u.Z)(function*(){const i="function",{function_call:o="auto",stream:l,...c}=t,d="string"!=typeof o&&o?.name,{maxChatCompletions:f=dr}=n||{},h={};for(const m of t.functions)h[m.name||m.function.name]=m;const p=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)s._addMessage(m,!1);for(let m=0;m<f;++m){const y=(yield s._createChatCompletion(e,{...c,function_call:o,functions:p,messages:[...s.messages]},n)).choices[0]?.message;if(!y)throw new v("missing message in ChatCompletion response");if(!y.function_call)return;const{name:C,arguments:q}=y.function_call,E=h[C];if(!E){const P=`Invalid function_call: ${JSON.stringify(C)}. Available options are: ${p.map(J=>JSON.stringify(J.name)).join(", ")}. Please try again`;s._addMessage({role:i,name:C,content:P});continue}if(d&&d!==C){const P=`Invalid function_call: ${JSON.stringify(C)}. ${JSON.stringify(d)} requested. Please try again`;s._addMessage({role:i,name:C,content:P});continue}let F;try{F=rr(E)?yield E.parse(q):q}catch(P){s._addMessage({role:i,name:C,content:P instanceof Error?P.message:String(P)});continue}const Z=yield E.function(F,s),G=N(s,O,"m",yn).call(s,Z);if(s._addMessage({role:i,name:C,content:G}),d)return}})()}_runTools(e,t,n){var s=this;return(0,u.Z)(function*(){const i="tool",{tool_choice:o="auto",stream:l,...c}=t,d="string"!=typeof o&&o?.function?.name,{maxChatCompletions:f=dr}=n||{},h=t.tools.map(g=>{if(Me(g)){if(!g.$callback)throw new v("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),p={};for(const g of h)"function"===g.type&&(p[g.function.name||g.function.function.name]=g.function);const m="tools"in t?h.map(g=>"function"===g.type?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)s._addMessage(g,!1);for(let g=0;g<f;++g){const C=(yield s._createChatCompletion(e,{...c,tool_choice:o,tools:m,messages:[...s.messages]},n)).choices[0]?.message;if(!C)throw new v("missing message in ChatCompletion response");if(!C.tool_calls?.length)return;for(const q of C.tool_calls){if("function"!==q.type)continue;const E=q.id,{name:F,arguments:Z}=q.function,G=p[F];if(!G){const M=`Invalid tool_call: ${JSON.stringify(F)}. Available options are: ${Object.keys(p).map(oe=>JSON.stringify(oe)).join(", ")}. Please try again`;s._addMessage({role:i,tool_call_id:E,content:M});continue}if(d&&d!==F){const M=`Invalid tool_call: ${JSON.stringify(F)}. ${JSON.stringify(d)} requested. Please try again`;s._addMessage({role:i,tool_call_id:E,content:M});continue}let P;try{P=rr(G)?yield G.parse(Z):Z}catch(M){const oe=M instanceof Error?M.message:String(M);s._addMessage({role:i,tool_call_id:E,content:oe});continue}const J=yield G.function(P,s),re=N(s,O,"m",yn).call(s,J);if(s._addMessage({role:i,tool_call_id:E,content:re}),d)return}}})()}}O=new WeakSet,pn=function(){return N(this,O,"m",ut).call(this).content??null},ut=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(pe(t)){const{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new v("stream ended without producing a ChatCompletionMessage with role=assistant")},mn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(pe(t)&&t?.function_call)return t.function_call;if(pe(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},gn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(sr(t)&&null!=t.content||ir(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(n=>"assistant"===n.role&&n.tool_calls?.some(s=>"function"===s.type&&s.id===t.tool_call_id)))return t.content}},_n=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ur=function(e){if(null!=e.n&&e.n>1)throw new v("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},yn=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class ke extends fr{static runFunctions(e,t,n){const s=new ke,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new ke,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),pe(e)&&e.content&&this._emit("content",e.content)}}const ge=r=>{if(0===r.length)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),ge(r);case"number":let t=e.value[e.value.length-1];if("."===t||"-"===t)return r=r.slice(0,r.length-1),ge(r);case"string":let n=r[r.length-2];if("delimiter"===n?.type)return r=r.slice(0,r.length-1),ge(r);if("brace"===n?.type&&"{"===n.value)return r=r.slice(0,r.length-1),ge(r);break;case"delimiter":return r=r.slice(0,r.length-1),ge(r)}return r},hr=r=>JSON.parse((r=>{let e="";return r.map(t=>{e+="string"===t.type?'"'+t.value+'"':t.value}),e})((r=>{let e=[];return r.map(t=>{"brace"===t.type&&("{"===t.value?e.push("}"):e.splice(e.lastIndexOf("}"),1)),"paren"===t.type&&("["===t.value?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{"}"===t?r.push({type:"brace",value:"}"}):"]"===t&&r.push({type:"paren",value:"]"})}),r})(ge((r=>{let e=0,t=[];for(;e<r.length;){let n=r[e];if("\\"===n){e++;continue}if("{"===n){t.push({type:"brace",value:"{"}),e++;continue}if("}"===n){t.push({type:"brace",value:"}"}),e++;continue}if("["===n){t.push({type:"paren",value:"["}),e++;continue}if("]"===n){t.push({type:"paren",value:"]"}),e++;continue}if(":"===n){t.push({type:"separator",value:":"}),e++;continue}if(","===n){t.push({type:"delimiter",value:","}),e++;continue}if('"'===n){let l="",c=!1;for(n=r[++e];'"'!==n;){if(e===r.length){c=!0;break}if("\\"===n){if(e++,e===r.length){c=!0;break}l+=n+r[e],n=r[++e]}else l+=n,n=r[++e]}n=r[++e],c||t.push({type:"string",value:l});continue}if(n&&/\s/.test(n)){e++;continue}let i=/[0-9]/;if(n&&i.test(n)||"-"===n||"."===n){let l="";for("-"===n&&(l+=n,n=r[++e]);n&&i.test(n)||"."===n;)l+=n,n=r[++e];t.push({type:"number",value:l});continue}let o=/[a-z]/i;if(n&&o.test(n)){let l="";for(;n&&o.test(n)&&e!==r.length;)l+=n,n=r[++e];if("true"!=l&&"false"!=l&&"null"!==l){e++;continue}t.push({type:"name",value:l})}else e++}return t})(r)))));var T,te,ye,ae,vn,dt,wn,bn,Cn,ft,An,pr,_e=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t},b=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)};class Oe extends fr{constructor(e){super(),T.add(this),te.set(this,void 0),ye.set(this,void 0),ae.set(this,void 0),_e(this,te,e,"f"),_e(this,ye,[],"f")}get currentChatCompletionSnapshot(){return b(this,ae,"f")}static fromReadableStream(e){const t=new Oe(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Oe(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}_createChatCompletion(e,t,n){var s=()=>super._createChatCompletion,i=this;return(0,u.Z)(function*(){s();const o=n?.signal;o&&(o.aborted&&i.controller.abort(),o.addEventListener("abort",()=>i.controller.abort())),b(i,T,"m",vn).call(i);const l=yield e.chat.completions.create({...t,stream:!0},{...n,signal:i.controller.signal});i._connected();var f,c=!1,d=!1;try{for(var p,h=$(l);c=!(p=yield h.next()).done;c=!1){const m=p.value;b(i,T,"m",wn).call(i,m)}}catch(m){d=!0,f=m}finally{try{c&&null!=h.return&&(yield h.return())}finally{if(d)throw f}}if(l.controller.signal?.aborted)throw new D;return i._addChatCompletion(b(i,T,"m",ft).call(i))})()}_fromReadableStream(e,t){var n=this;return(0,u.Z)(function*(){const s=t?.signal;s&&(s.aborted&&n.controller.abort(),s.addEventListener("abort",()=>n.controller.abort())),b(n,T,"m",vn).call(n),n._connected();const i=Q.fromReadableStream(e,n.controller);let o;var d,l=!1,c=!1;try{for(var h,f=$(i);l=!(h=yield f.next()).done;l=!1){const p=h.value;o&&o!==p.id&&n._addChatCompletion(b(n,T,"m",ft).call(n)),b(n,T,"m",wn).call(n,p),o=p.id}}catch(p){c=!0,d=p}finally{try{l&&null!=f.return&&(yield f.return())}finally{if(c)throw d}}if(i.controller.signal?.aborted)throw new D;return n._addChatCompletion(b(n,T,"m",ft).call(n))})()}[(te=new WeakMap,ye=new WeakMap,ae=new WeakMap,T=new WeakSet,vn=function(){this.ended||_e(this,ae,void 0,"f")},dt=function(t){let n=b(this,ye,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},b(this,ye,"f")[t.index]=n,n)},wn=function(t){if(this.ended)return;const n=b(this,T,"m",pr).call(this,t);this._emit("chunk",t,n);for(const s of t.choices){const i=n.choices[s.index];null!=s.delta.content&&"assistant"===i.message?.role&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),null!=s.delta.refusal&&"assistant"===i.message?.role&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),null!=s.logprobs?.content&&"assistant"===i.message?.role&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),null!=s.logprobs?.refusal&&"assistant"===i.message?.role&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});const o=b(this,T,"m",dt).call(this,i);i.finish_reason&&(b(this,T,"m",Cn).call(this,i),null!=o.current_tool_call_index&&b(this,T,"m",bn).call(this,i,o.current_tool_call_index));for(const l of s.delta.tool_calls??[])o.current_tool_call_index!==l.index&&(b(this,T,"m",Cn).call(this,i),null!=o.current_tool_call_index&&b(this,T,"m",bn).call(this,i,o.current_tool_call_index)),o.current_tool_call_index=l.index;for(const l of s.delta.tool_calls??[]){const c=i.message.tool_calls?.[l.index];c?.type&&"function"===c?.type&&this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:l.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:l.function?.arguments??""})}}},bn=function(t,n){if(b(this,T,"m",dt).call(this,t).done_tool_calls.has(n))return;const i=t.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if("function"===i.type){const o=b(this,te,"f")?.tools?.find(l=>"function"===l.type&&l.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:Me(o)?o.$parseRaw(i.function.arguments):o?.function.strict?JSON.parse(i.function.arguments):null})}},Cn=function(t){const n=b(this,T,"m",dt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const s=b(this,T,"m",An).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ft=function(){if(this.ended)throw new v("stream has ended, this shouldn't happen");const t=b(this,ae,"f");if(!t)throw new v("request ended without sending any chunks");return _e(this,ae,void 0,"f"),_e(this,ye,[],"f"),function _s(r,e){const{id:t,choices:n,created:s,model:i,system_fingerprint:o,...l}=r;return function cs(r,e){return e&&cr(e)?hn(r,e):{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}}({...l,id:t,choices:n.map(({message:d,finish_reason:f,index:h,logprobs:p,...m})=>{if(!f)throw new v(`missing finish_reason for choice ${h}`);const{content:g=null,function_call:y,tool_calls:C,...q}=d,E=d.role;if(!E)throw new v(`missing role for choice ${h}`);if(y){const{arguments:F,name:Z}=y;if(null==F)throw new v(`missing function_call.arguments for choice ${h}`);if(!Z)throw new v(`missing function_call.name for choice ${h}`);return{...m,message:{content:g,function_call:{arguments:F,name:Z},role:E,refusal:d.refusal??null},finish_reason:f,index:h,logprobs:p}}return C?{...m,index:h,finish_reason:f,logprobs:p,message:{...q,role:E,content:g,refusal:d.refusal??null,tool_calls:C.map((F,Z)=>{const{function:G,type:P,id:J,...re}=F,{arguments:M,name:oe,...L}=G||{};if(null==J)throw new v(`missing choices[${h}].tool_calls[${Z}].id\n${ht(r)}`);if(null==P)throw new v(`missing choices[${h}].tool_calls[${Z}].type\n${ht(r)}`);if(null==oe)throw new v(`missing choices[${h}].tool_calls[${Z}].function.name\n${ht(r)}`);if(null==M)throw new v(`missing choices[${h}].tool_calls[${Z}].function.arguments\n${ht(r)}`);return{...re,id:J,type:P,function:{...L,name:oe,arguments:M}}})}}:{...m,message:{...q,content:g,role:E,refusal:d.refusal??null},finish_reason:f,index:h,logprobs:p}}),created:s,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},e)}(t,b(this,te,"f"))},An=function(){const t=b(this,te,"f")?.response_format;return lr(t)?t:null},pr=function(t){var n,s,i,o;let l=b(this,ae,"f");const{choices:c,...d}=t;l?Object.assign(l,d):l=_e(this,ae,{...d,choices:[]},"f");for(const{delta:f,finish_reason:h,index:p,logprobs:m=null,...g}of t.choices){let y=l.choices[p];if(y||(y=l.choices[p]={finish_reason:h,index:p,message:{},logprobs:m,...g}),m)if(y.logprobs){const{content:P,refusal:J,...re}=m;Object.assign(y.logprobs,re),P&&((n=y.logprobs).content??(n.content=[]),y.logprobs.content.push(...P)),J&&((s=y.logprobs).refusal??(s.refusal=[]),y.logprobs.refusal.push(...J))}else y.logprobs=Object.assign({},m);if(h&&(y.finish_reason=h,b(this,te,"f")&&cr(b(this,te,"f")))){if("length"===h)throw new nn;if("content_filter"===h)throw new rn}if(Object.assign(y,g),!f)continue;const{content:C,refusal:q,function_call:E,role:F,tool_calls:Z,...G}=f;if(Object.assign(y.message,G),q&&(y.message.refusal=(y.message.refusal||"")+q),F&&(y.message.role=F),E&&(y.message.function_call?(E.name&&(y.message.function_call.name=E.name),E.arguments&&((i=y.message.function_call).arguments??(i.arguments=""),y.message.function_call.arguments+=E.arguments)):y.message.function_call=E),C&&(y.message.content=(y.message.content||"")+C,!y.message.refusal&&b(this,T,"m",An).call(this)&&(y.message.parsed=hr(y.message.content))),Z){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:P,id:J,type:re,function:M,...oe}of Z){const L=(o=y.message.tool_calls)[P]??(o[P]={});Object.assign(L,oe),J&&(L.id=J),re&&(L.type=re),M&&(L.function??(L.function={name:M.name??"",arguments:""})),M?.name&&(L.function.name=M.name),M?.arguments&&(L.function.arguments+=M.arguments,fs(b(this,te,"f"),L)&&(L.function.parsed_arguments=hr(L.function.arguments)))}}}return l},Symbol.asyncIterator)](){var e=this;const t=[],n=[];let s=!1;return this.on("chunk",i=>{const o=n.shift();o?o.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:(i=(0,u.Z)(function*(){return t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((l,c)=>n.push({resolve:l,reject:c})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0})}),function(){return i.apply(this,arguments)}),return:function(){var i=(0,u.Z)(function*(){return e.abort(),{value:void 0,done:!0}});return function(){return i.apply(this,arguments)}}()};var i}toReadableStream(){return new Q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function ht(r){return JSON.stringify(r)}class ve extends Oe{static fromReadableStream(e){const t=new ve(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ve(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new ve(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}class mr extends w{parse(e,t){var n=this;return(0,u.Z)(function*(){return function hs(r){for(const e of r??[]){if("function"!==e.type)throw new v(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(!0!==e.function.strict)throw new v(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),hn(yield n._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}}),e)})()}runFunctions(e,t){return e.stream?ve.runFunctions(this._client,e,t):ke.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ve.runTools(this._client,e,t):ke.runTools(this._client,e,t)}stream(e,t){return Oe.createChatCompletion(this._client,e,t)}}class pt extends w{constructor(){super(...arguments),this.completions=new mr(this._client)}}!function(r){r.Completions=mr}(pt||(pt={}));var I,Sn,z,mt,V,le,we,ce,gt,B,_t,yt,Fe,Ze,$e,gr,_r,yr,vr,wr,br,Cr,_=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)},j=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t};class Y extends or{constructor(){super(...arguments),I.add(this),Sn.set(this,[]),z.set(this,{}),mt.set(this,{}),V.set(this,void 0),le.set(this,void 0),we.set(this,void 0),ce.set(this,void 0),gt.set(this,void 0),B.set(this,void 0),_t.set(this,void 0),yt.set(this,void 0),Fe.set(this,void 0)}[(Sn=new WeakMap,z=new WeakMap,mt=new WeakMap,V=new WeakMap,le=new WeakMap,we=new WeakMap,ce=new WeakMap,gt=new WeakMap,B=new WeakMap,_t=new WeakMap,yt=new WeakMap,Fe=new WeakMap,I=new WeakSet,Symbol.asyncIterator)](){var e=this;const t=[],n=[];let s=!1;return this.on("event",i=>{const o=n.shift();o?o.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:(i=(0,u.Z)(function*(){return t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((l,c)=>n.push({resolve:l,reject:c})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0})}),function(){return i.apply(this,arguments)}),return:function(){var i=(0,u.Z)(function*(){return e.abort(),{value:void 0,done:!0}});return function(){return i.apply(this,arguments)}}()};var i}static fromReadableStream(e){const t=new Y;return t._run(()=>t._fromReadableStream(e)),t}_fromReadableStream(e,t){var n=this;return(0,u.Z)(function*(){const s=t?.signal;s&&(s.aborted&&n.controller.abort(),s.addEventListener("abort",()=>n.controller.abort())),n._connected();const i=Q.fromReadableStream(e,n.controller);var c,o=!1,l=!1;try{for(var f,d=$(i);o=!(f=yield d.next()).done;o=!1){const h=f.value;_(n,I,"m",Ze).call(n,h)}}catch(h){l=!0,c=h}finally{try{o&&null!=d.return&&(yield d.return())}finally{if(l)throw c}}if(i.controller.signal?.aborted)throw new D;return n._addRun(_(n,I,"m",$e).call(n))})()}toReadableStream(){return new Q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){const o=new Y;return o._run(()=>o._runToolAssistantStream(e,t,n,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}_createToolAssistantStream(e,t,n,s,i){var o=this;return(0,u.Z)(function*(){const l=i?.signal;l&&(l.aborted&&o.controller.abort(),l.addEventListener("abort",()=>o.controller.abort()));const c={...s,stream:!0},d=yield e.submitToolOutputs(t,n,c,{...i,signal:o.controller.signal});o._connected();var p,f=!1,h=!1;try{for(var g,m=$(d);f=!(g=yield m.next()).done;f=!1){const y=g.value;_(o,I,"m",Ze).call(o,y)}}catch(y){h=!0,p=y}finally{try{f&&null!=m.return&&(yield m.return())}finally{if(h)throw p}}if(d.controller.signal?.aborted)throw new D;return o._addRun(_(o,I,"m",$e).call(o))})()}static createThreadAssistantStream(e,t,n){const s=new Y;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const i=new Y;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return _(this,_t,"f")}currentRun(){return _(this,yt,"f")}currentMessageSnapshot(){return _(this,V,"f")}currentRunStepSnapshot(){return _(this,Fe,"f")}finalRunSteps(){var e=this;return(0,u.Z)(function*(){return yield e.done(),Object.values(_(e,z,"f"))})()}finalMessages(){var e=this;return(0,u.Z)(function*(){return yield e.done(),Object.values(_(e,mt,"f"))})()}finalRun(){var e=this;return(0,u.Z)(function*(){if(yield e.done(),!_(e,le,"f"))throw Error("Final run was not received.");return _(e,le,"f")})()}_createThreadAssistantStream(e,t,n){var s=this;return(0,u.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort()));const o={...t,stream:!0},l=yield e.createAndRun(o,{...n,signal:s.controller.signal});s._connected();var f,c=!1,d=!1;try{for(var p,h=$(l);c=!(p=yield h.next()).done;c=!1){const m=p.value;_(s,I,"m",Ze).call(s,m)}}catch(m){d=!0,f=m}finally{try{c&&null!=h.return&&(yield h.return())}finally{if(d)throw f}}if(l.controller.signal?.aborted)throw new D;return s._addRun(_(s,I,"m",$e).call(s))})()}_createAssistantStream(e,t,n,s){var i=this;return(0,u.Z)(function*(){const o=s?.signal;o&&(o.aborted&&i.controller.abort(),o.addEventListener("abort",()=>i.controller.abort()));const l={...n,stream:!0},c=yield e.create(t,l,{...s,signal:i.controller.signal});i._connected();var h,d=!1,f=!1;try{for(var m,p=$(c);d=!(m=yield p.next()).done;d=!1){const g=m.value;_(i,I,"m",Ze).call(i,g)}}catch(g){f=!0,h=g}finally{try{d&&null!=p.return&&(yield p.return())}finally{if(f)throw h}}if(c.controller.signal?.aborted)throw new D;return i._addRun(_(i,I,"m",$e).call(i))})()}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(null!=i)if("index"!==n&&"type"!==n){if("string"==typeof i&&"string"==typeof s)i+=s;else if("number"==typeof i&&"number"==typeof s)i+=s;else if(nr(i)&&nr(s))i=this.accumulateDelta(i,s);else{if(!Array.isArray(i)||!Array.isArray(s))throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);if(i.every(o=>"string"==typeof o||"number"==typeof o)){i.push(...s);continue}}e[n]=i}else e[n]=s;else e[n]=s}return e}_addRun(e){return e}_threadAssistantStream(e,t,n){var s=this;return(0,u.Z)(function*(){return yield s._createThreadAssistantStream(t,e,n)})()}_runAssistantStream(e,t,n,s){var i=this;return(0,u.Z)(function*(){return yield i._createAssistantStream(t,e,n,s)})()}_runToolAssistantStream(e,t,n,s,i){var o=this;return(0,u.Z)(function*(){return yield o._createToolAssistantStream(n,e,t,s,i)})()}}Ze=function(e){if(!this.ended)switch(j(this,_t,e,"f"),_(this,I,"m",yr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":_(this,I,"m",Cr).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":_(this,I,"m",_r).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":_(this,I,"m",gr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},$e=function(){if(this.ended)throw new v("stream has ended, this shouldn't happen");if(!_(this,le,"f"))throw Error("Final run has not been received");return _(this,le,"f")},gr=function(e){const[t,n]=_(this,I,"m",wr).call(this,e,_(this,V,"f"));j(this,V,t,"f"),_(this,mt,"f")[t.id]=t;for(const s of n){const i=t.content[s.index];"text"==i?.type&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let i=s.text,o=t.content[s.index];if(!o||"text"!=o.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",i,o.text)}if(s.index!=_(this,we,"f")){if(_(this,ce,"f"))switch(_(this,ce,"f").type){case"text":this._emit("textDone",_(this,ce,"f").text,_(this,V,"f"));break;case"image_file":this._emit("imageFileDone",_(this,ce,"f").image_file,_(this,V,"f"))}j(this,we,s.index,"f")}j(this,ce,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==_(this,we,"f")){const s=e.data.content[_(this,we,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,_(this,V,"f"));break;case"text":this._emit("textDone",s.text,_(this,V,"f"))}}_(this,V,"f")&&this._emit("messageDone",e.data),j(this,V,void 0,"f")}},_r=function(e){const t=_(this,I,"m",vr).call(this,e);switch(j(this,Fe,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const i of n.step_details.tool_calls)i.index==_(this,gt,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(_(this,B,"f")&&this._emit("toolCallDone",_(this,B,"f")),j(this,gt,i.index,"f"),j(this,B,t.step_details.tool_calls[i.index],"f"),_(this,B,"f")&&this._emit("toolCallCreated",_(this,B,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,Fe,void 0,"f"),"tool_calls"==e.data.step_details.type&&_(this,B,"f")&&(this._emit("toolCallDone",_(this,B,"f")),j(this,B,void 0,"f")),this._emit("runStepDone",e.data,t)}},yr=function(e){_(this,Sn,"f").push(e),this._emit("event",e)},vr=function(e){switch(e.event){case"thread.run.step.created":return _(this,z,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=_(this,z,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Y.accumulateDelta(t,n.delta);_(this,z,"f")[e.data.id]=s}return _(this,z,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":_(this,z,"f")[e.data.id]=e.data}if(_(this,z,"f")[e.data.id])return _(this,z,"f")[e.data.id];throw new Error("No snapshot available")},wr=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let o=t.content[i.index];t.content[i.index]=_(this,I,"m",br).call(this,i,o)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},br=function(e,t){return Y.accumulateDelta(t,e)},Cr=function(e){switch(j(this,yt,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":j(this,le,e.data,"f"),_(this,B,"f")&&(this._emit("toolCallDone",_(this,B,"f")),j(this,B,void 0,"f"))}};class vt extends w{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,xn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class xn extends W{}!function(r){r.MessagesPage=xn}(vt||(vt={}));class wt extends w{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,n={},s){return U(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,En,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class En extends W{}!function(r){r.RunStepsPage=En}(wt||(wt={}));class bt extends w{constructor(){super(...arguments),this.steps=new wt(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Tn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,u.Z)(function*(){const i=yield s.create(e,t,n);return yield s.poll(e,i.id,n)})()}createAndStream(e,t,n){return Y.createAssistantStream(e,this._client.beta.threads.runs,t,n)}poll(e,t,n){var s=this;return(0,u.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:l}=yield s.retrieve(e,t,{...n,headers:{...n?.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const d=l.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(c=f)}}yield xe(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}})()}stream(e,t,n){return Y.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}submitToolOutputsAndPoll(e,t,n,s){var i=this;return(0,u.Z)(function*(){const o=yield i.submitToolOutputs(e,t,n,s);return yield i.poll(e,o.id,s)})()}submitToolOutputsStream(e,t,n,s){return Y.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Tn extends W{}!function(r){r.RunsPage=Tn,r.Steps=wt,r.RunStepsPage=En}(bt||(bt={}));class Ct extends w{constructor(){super(...arguments),this.runs=new bt(this._client),this.messages=new vt(this._client)}create(e={},t){return U(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}createAndRunPoll(e,t){var n=this;return(0,u.Z)(function*(){const s=yield n.createAndRun(e,t);return yield n.runs.poll(s.thread_id,s.id,t)})()}createAndRunStream(e,t){return Y.createThreadAssistantStream(e,this._client.beta.threads,t)}}!function(r){r.Runs=bt,r.RunsPage=Tn,r.Messages=vt,r.MessagesPage=xn}(Ct||(Ct={}));const ys=function(){var r=(0,u.Z)(function*(e){const t=yield Promise.allSettled(e),n=t.filter(i=>"rejected"===i.status);if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of t)"fulfilled"===i.status&&s.push(i.value);return s});return function(t){return r.apply(this,arguments)}}();class At extends w{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,St,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,u.Z)(function*(){const i=yield s.create(e,t,n);return yield s.poll(e,i.id,n)})()}poll(e,t,n){var s=this;return(0,u.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const o=yield s.retrieve(e,t,{...n,headers:i}).withResponse(),l=o.data;switch(l.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const d=o.response.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(c=f)}}yield xe(c);break;case"failed":case"completed":return l}}})()}upload(e,t,n){var s=this;return(0,u.Z)(function*(){const i=yield s._client.files.create({file:t,purpose:"assistants"},n);return s.create(e,{file_id:i.id},n)})()}uploadAndPoll(e,t,n){var s=this;return(0,u.Z)(function*(){const i=yield s.upload(e,t,n);return yield s.poll(e,i.id,n)})()}}class St extends W{}!function(r){r.VectorStoreFilesPage=St}(At||(At={}));class xt extends w{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,u.Z)(function*(){const i=yield s.create(e,t);return yield s.poll(e,i.id,n)})()}listFiles(e,t,n={},s){return U(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,St,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}poll(e,t,n){var s=this;return(0,u.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:l}=yield s.retrieve(e,t,{...n,headers:i}).withResponse();switch(o.status){case"in_progress":let c=5e3;if(n?.pollIntervalMs)c=n.pollIntervalMs;else{const d=l.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(c=f)}}yield xe(c);break;case"failed":case"cancelled":case"completed":return o}}})()}uploadAndPoll(e,{files:t,fileIds:n=[]},s){var i=this;return(0,u.Z)(function*(){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const l=Math.min(s?.maxConcurrency??5,t.length),c=i._client,d=t.values(),f=[...n];function p(){return(p=(0,u.Z)(function*(g){for(let y of g){const C=yield c.files.create({file:y,purpose:"assistants"},s);f.push(C.id)}})).apply(this,arguments)}const m=Array(l).fill(d).map(function h(g){return p.apply(this,arguments)});return yield ys(m),yield i.createAndPoll(e,{file_ids:f})})()}}xt||(xt={});class Et extends w{constructor(){super(...arguments),this.files=new At(this._client),this.fileBatches=new xt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/vector_stores",Pn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Pn extends W{}!function(r){r.VectorStoresPage=Pn,r.Files=At,r.VectorStoreFilesPage=St,r.FileBatches=xt}(Et||(Et={}));class Tt extends w{constructor(){super(...arguments),this.vectorStores=new Et(this._client),this.chat=new pt(this._client),this.assistants=new st(this._client),this.threads=new Ct(this._client)}}!function(r){r.VectorStores=Et,r.VectorStoresPage=Pn,r.Chat=pt,r.Assistants=st,r.AssistantsPage=dn,r.Threads=Ct}(Tt||(Tt={}));class Pt extends w{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/batches",Rn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Rn extends W{}!function(r){r.BatchesPage=Rn}(Pt||(Pt={}));class Rt extends w{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,fe({body:t,...n}))}}Rt||(Rt={});class It extends w{constructor(){super(...arguments),this.parts=new Rt(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}!function(r){r.Parts=Rt}(It||(It={}));class x extends Xr{constructor({baseURL:e=De("OPENAI_BASE_URL"),apiKey:t=De("OPENAI_API_KEY"),organization:n=De("OPENAI_ORG_ID")??null,project:s=De("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new v("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u")throw new v("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Je(this),this.chat=new He(this),this.embeddings=new We(this),this.files=new Xe(this),this.images=new Ve(this),this.audio=new ze(this),this.moderations=new Ke(this),this.models=new et(this),this.fineTuning=new rt(this),this.beta=new Tt(this),this.batches=new Pt(this),this.uploads=new It(this),this._options=o,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}x.OpenAI=x,x.DEFAULT_TIMEOUT=6e5,x.OpenAIError=v,x.APIError=R,x.APIConnectionError=Ee,x.APIConnectionTimeoutError=qe,x.APIUserAbortError=D,x.NotFoundError=Qt,x.ConflictError=zt,x.RateLimitError=en,x.BadRequestError=Vt,x.AuthenticationError=Yt,x.InternalServerError=tn,x.PermissionDeniedError=Gt,x.UnprocessableEntityError=Kt,x.toFile=Bt,x.fileFromPath=$t,function(r){r.Page=sn,r.CursorPage=W,r.Completions=Je,r.Chat=He,r.Embeddings=We,r.Files=Xe,r.FileObjectsPage=an,r.Images=Ve,r.Audio=ze,r.Moderations=Ke,r.Models=et,r.ModelsPage=on,r.FineTuning=rt,r.Beta=Tt,r.Batches=Pt,r.BatchesPage=Rn,r.Uploads=It}(x||(x={}));const ws=x;var bs=S(95),xr=S(5657);let Cs=(()=>{class r{constructor(t){this.cookieService=t}saveThread(t){const n=JSON.parse(this.cookieService.get(ue)||"[]");n.includes(t)||n.push(t),console.log({saving:n}),this.cookieService.set(ue,JSON.stringify(n),void 0,"/")}deleteThread(t){this.cookieService.set(ue,JSON.stringify(JSON.parse(this.cookieService.get(ue)||"[]").filter(n=>n!=t)),void 0,"/")}getThreadIds(){return console.log(this.cookieService.get(ue)),JSON.parse(this.cookieService.get(ue)||"[]")}static#e=this.\u0275fac=function(n){return new(n||r)(a.LFG(xr.N))};static#t=this.\u0275prov=a.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),be=(()=>{class r{constructor(t,n){this.keyService=t,this.threadMgmtService=n,this.keyService.keyInit$.subscribe(s=>{s&&(this.openai=new ws({apiKey:s,dangerouslyAllowBrowser:!0}))})}listAssistants(){return this.openai.beta.assistants.list().then(t=>t.data)}listThreads(){const t=this.threadMgmtService.getThreadIds(),n=[];return console.log({ids:t}),t.forEach(s=>{n.push(this.openai.beta.threads.retrieve(s).then(i=>i))}),console.log("asdfqsdlkf"),Promise.all(n)}createAssistant(t){var n=this;return(0,u.Z)(function*(){yield n.openai.beta.assistants.create(t).then(i=>i)})()}createThread(){var t=this;return(0,u.Z)(function*(){const n=yield t.openai.beta.threads.create().then(s=>s);t.threadMgmtService.saveThread(n.id)})()}createMessage(t,n){return this.openai.beta.threads.messages.create(n,{role:"user",content:t}).then(s=>s)}createMessageWithFile(t,n,s){return this.openai.beta.threads.messages.create(n,{role:"user",content:t,attachments:[{file_id:s,tools:[{type:"file_search"}]}]}).then(i=>i)}listMessages(t){return this.openai.beta.threads.messages.list(t).then(n=>n)}deleteMessage(t,n){return this.openai.beta.threads.messages.del(n,t).then(s=>s)}runThread(t,n){return this.openai.beta.threads.runs.create(n,{assistant_id:t}).then(s=>s)}retreiveRun(t,n){return this.openai.beta.threads.runs.retrieve(t,n).then(s=>s)}listFiles(){return this.openai.files.list().then(t=>t.data)}createFile(t){var n=this;return(0,u.Z)(function*(){try{const s=new FormData;s.append("file",t,t.name);const i=yield n.openai.files.create({file:s.get("file"),purpose:"assistants"}).then(o=>o);console.log(i)}catch(s){console.error("Error uploading file:",s)}})()}static#e=this.\u0275fac=function(n){return new(n||r)(a.LFG(bs.B),a.LFG(Cs))};static#t=this.\u0275prov=a.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var As=S(7185);let Ss=(()=>{class r{constructor(t){this.cookieService=t}saveConfig(t){const n=JSON.parse(this.cookieService.get(Ft)||"{}");Object.assign(n,t),this.cookieService.set(Ft,JSON.stringify(n),void 0,"/")}getConfig(){return JSON.parse(this.cookieService.get(Ft)||"{}")}static#e=this.\u0275fac=function(n){return new(n||r)(a.LFG(xr.N))};static#t=this.\u0275prov=a.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),xs=(()=>{class r{constructor(t,n){this.oaiService=t,this.datePipe=n}downloadSnapshot(t){var n=this;return(0,u.Z)(function*(){const s=new Date,i=yield n.getSnapshot(t),l=document.createElement("a");l.setAttribute("target","_blank"),l.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(JSON.stringify(i,null,4))}`),l.setAttribute("download",`conv-snapshot_${n.datePipe.transform(s,"dd-MM-yyyy_HH'h'mm")}.json`),document.body.appendChild(l),l.click(),l.remove()})()}getSnapshot(t){var n=this;return(0,u.Z)(function*(){const s=yield n.oaiService.listAssistants(),i=(yield n.oaiService.listMessages(t)).data,o=i.map(c=>c.run_id).filter(c=>!!c).map(c=>n.oaiService.retreiveRun(t,c)),l=yield Promise.all(o);return{threadId:t,messages:i,runs:l,assistants:s}})()}static#e=this.\u0275fac=function(n){return new(n||r)(a.LFG(be),a.LFG(H.uU))};static#t=this.\u0275prov=a.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Er=S(4144),Mt=S(9549),ne=S(4006),Ne=S(4859),kt=S(266),Es=S(5113),Ts=S(3238),Ps=S(1572),Rs=S(7392);function Is(r,e){if(1&r&&(a.TgZ(0,"div",6),a._UZ(1,"mat-icon",7),a.qZA()),2&r){const t=a.oxw();a.xp6(1),a.Q6J("matTooltip",t.getFileText((null==t.message.attachments||null==t.message.attachments[0]?null:t.message.attachments[0].file_id)||""))}}let Ms=(()=>{class r{constructor(){this.delete=new a.vpe}get text(){return this.message.content[0].text.value}getFileText(t){return this.files?.find(n=>n.id==t)?.filename||`${t} (fichier inconnu)`}onDeleteClick(){this.delete.emit()}static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-message"]],hostVars:2,hostBindings:function(n,s){2&n&&a.ekj("bot","assistant"==s.message.role)},inputs:{message:"message",files:"files"},outputs:{delete:"delete"},decls:9,vars:3,consts:[[1,"message-inner",3,"ngClass"],[1,"avatar"],[1,"text"],["class","file",4,"ngIf"],[1,"delete-container",3,"click"],["matTooltip","Delete message",1,"delete-icon"],[1,"file"],["fontIcon","description",3,"matTooltip"]],template:function(n,s){1&n&&(a.TgZ(0,"div",0),a._UZ(1,"div",1),a.TgZ(2,"div")(3,"div",2),a._uU(4),a.qZA(),a.YNc(5,Is,2,1,"div",3),a.qZA(),a.TgZ(6,"div",4),a.NdJ("click",function(){return s.onDeleteClick()}),a.TgZ(7,"div",5),a._uU(8,"x"),a.qZA()()()),2&n&&(a.Q6J("ngClass","assistant"==s.message.role?"bot":"user"),a.xp6(4),a.Oqu(s.text),a.xp6(1),a.Q6J("ngIf",null==s.message.attachments?null:s.message.attachments.length))},dependencies:[H.mk,H.O5,Rs.Hw,kt.gM],styles:["[_nghost-%COMP%]{display:flex}[_nghost-%COMP%]:not(.bot){justify-content:flex-end}[_nghost-%COMP%]:not(.bot)   .message-inner[_ngcontent-%COMP%]{background-color:#dcf8c7}[_nghost-%COMP%]:not(.bot)   .message-inner[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-image:url(149071.2c79519aa8a73779.png);background-position:top 0px right 0}[_nghost-%COMP%]   .file[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;color:gray}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]{position:relative;white-space:pre-wrap;background-color:#f5f5f5;box-shadow:1px 2px 2px #00000075;align-items:center;display:flex;padding:.5rem 1.5rem .5rem 1rem;margin:.5rem;max-width:85%;border-radius:8px}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-left:1rem}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-image:url(intelligence-artificielle.177fca32fe4b928c.jpg);background-size:auto 100%;min-width:40px;height:40px;border-radius:50%;background-repeat:no-repeat;background-position:top 0px right -8px}[_nghost-%COMP%]   .delete-container[_ngcontent-%COMP%]{position:absolute;top:4px;right:8px;cursor:pointer;color:#000}"]})}return r})();function ks(r,e){if(1&r&&(a.TgZ(0,"mat-option",23),a._uU(1),a.qZA()),2&r){const t=e.$implicit;a.Q6J("value",t.id),a.xp6(1),a.AsE("",t.name," (",t.model,")")}}function Os(r,e){if(1&r){const t=a.EpF();a.TgZ(0,"mat-form-field")(1,"mat-label"),a._uU(2,"Run with"),a.qZA(),a.TgZ(3,"mat-select",21),a.NdJ("ngModelChange",function(s){a.CHM(t);const i=a.oxw();return a.KtG(i.assistantId=s)})("ngModelChange",function(){a.CHM(t);const s=a.oxw();return a.KtG(s.updateConfig())}),a.YNc(4,ks,2,3,"mat-option",22),a.qZA()()}if(2&r){const t=a.oxw();a.xp6(3),a.Q6J("ngModel",t.assistantId),a.xp6(1),a.Q6J("ngForOf",t.assistants)}}function Fs(r,e){if(1&r){const t=a.EpF();a.TgZ(0,"app-message",24),a.NdJ("delete",function(){const i=a.CHM(t).$implicit,o=a.oxw();return a.KtG(o.onDeleteMessage(i))}),a.qZA()}if(2&r){const t=e.$implicit,n=a.oxw();a.Q6J("message",t)("files",n.files)}}function Zs(r,e){1&r&&(a.TgZ(0,"div",25),a._UZ(1,"mat-spinner",26),a.TgZ(2,"span"),a._uU(3,"\xa0Processing..."),a.qZA()())}function $s(r,e){if(1&r&&(a.TgZ(0,"option",27),a._uU(1),a.qZA()),2&r){const t=e.$implicit;a.Q6J("value",t.id),a.xp6(1),a.hij(" ",t.filename," ")}}let Ns=(()=>{class r{constructor(t,n,s,i,o,l,c){this.oaiService=t,this.activatedRoute=n,this.router=s,this.locationStrategy=i,this.toastr=o,this.userConfigService=l,this.snapshotService=c,this.selectedFile=null,this.messages=[],this.withFiles=!1,this.processing=!1,this.assistants=[],this.autoRunThread=!0,this.showUsage=!0}ngOnInit(){var t=this;return(0,u.Z)(function*(){t.activatedRoute.params.subscribe(function(){var n=(0,u.Z)(function*(s){t.threadId=s.threadId,t.refreshMessages()});return function(s){return n.apply(this,arguments)}}()),t.assistants=yield t.oaiService.listAssistants(),t.useConfig(),t.files=yield t.oaiService.listFiles()})()}useConfig(){const t=this.userConfigService.getConfig();!1===t.autoRunThread&&(this.autoRunThread=!1),!1===t.showUsage&&(this.showUsage=!1),this.assistantId=t.assistantId||this.assistants[0].id}onAssistantChange(t){console.log(t.target.value)}onInput(t){"Enter"==t.key&&(this.addMessageRunAndRefresh(this.value),this.value="",t.preventDefault(),t.stopPropagation())}callTest(){return(0,u.Z)(function*(){})()}updateConfig(){this.userConfigService.saveConfig({assistantId:this.assistantId,showUsage:this.showUsage,autoRunThread:this.autoRunThread})}createThread(){var t=this;return(0,u.Z)(function*(){const n=yield t.openai.beta.threads.create({tool_resources:{file_search:{vector_store_ids:[kn_main]}}});console.log(n)})()}createVectorStore(){var t=this;return(0,u.Z)(function*(){yield t.openai.beta.vectorStores.create({name:"UML file test"})})()}addFileToVectorStore(){var t=this;return(0,u.Z)(function*(){yield t.openai.beta.vectorStores.files.create(kn_main,{file_id:Mn_min_v1})})()}onSelectedFileChange(t){this.fileId=t.target.value}handleWithFileClick(t){console.log({val:t.target.checked}),this.withFiles=t.target.checked}refreshMessages(){var t=this;return(0,u.Z)(function*(){return t.oaiService.listMessages(t.threadId).then(n=>(t.messages=n.data,n))})()}downloadSnapshot(){this.snapshotService.downloadSnapshot(this.threadId)}clearThread(){var t=this;return(0,u.Z)(function*(){const n=yield t.refreshMessages();console.log({data:n.data.map(i=>i.id)});const s=[];n.data.map(i=>i.id).forEach((i,o)=>{s.push(t.oaiService.deleteMessage(i,t.threadId))}),yield Promise.all(s),yield t.refreshMessages()})()}retreiveFile(){var t=this;return(0,u.Z)(function*(){yield t.openai.files.retrieve(Mn_min_v1)})()}runThread(){var t=this;return(0,u.Z)(function*(){const n=yield t.oaiService.runThread(t.assistantId,t.threadId);console.log({run:n});const s=n.id;yield t.waitForSuccess(s),yield t.refreshMessages()})()}addMessageRunAndRefresh(t){var n=this;return(0,u.Z)(function*(){yield n.withFiles?n.oaiService.createMessageWithFile(t,n.threadId,n.fileId):n.oaiService.createMessage(t,n.threadId),yield n.refreshMessages(),n.autoRunThread&&(yield n.runThread(),yield n.refreshMessages())})()}waitForSuccess(t){var n=this;return(0,u.Z)(function*(){n.processing=!0;let i,s="queued";for(;"queued"==s||"in_progress"==s;)yield n.sleep(1e3),i=yield n.oaiService.retreiveRun(n.threadId,t),s=i.status,console.log({runVal:i});if(n.showUsage){const o=i?.usage?.prompt_tokens||0,l=i?.usage?.completion_tokens||0;let c=o/1e6*n.getPricePerMInputTokens()+l/1e6*n.getPricePerMOutputTokens();c=c<1e-5?"< 0.0001":Math.trunc(1e4*c)/1e4,n.toastr.success(`Input: ${o} tokens\nOutput: ${l} tokens\nCost: ${c}$`,"Usage",{disableTimeOut:!0})}n.processing=!1})()}getPricePerMInputTokens(){return On[this.assistants.find(n=>n.id==this.assistantId)?.model].input}getPricePerMOutputTokens(){return On[this.assistants.find(n=>n.id==this.assistantId)?.model].output}listFiles(){this.openai.files.list()}sleep(t){return(0,u.Z)(function*(){return new Promise(n=>setTimeout(n,t))})()}updateAssistant(){this.openai.beta.assistants.update("asst_cJnqTodNOv0T24dsRwoYa9H8",{model:"gpt-4o-mini"})}back(){this.router.navigate(["/poc-ai/threads"])}onManageFilesClick(){const t=`${this.locationStrategy.getBaseHref()}poc-ai/files`;window.open(t,"_blank")}onManageAssistantsClick(){const t=`${this.locationStrategy.getBaseHref()}poc-ai/assistants`;window.open(t,"_blank")}onDeleteMessage(t){var n=this;return(0,u.Z)(function*(){yield n.oaiService.deleteMessage(t.id,n.threadId),n.refreshMessages()})()}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(be),a.Y36(K.gz),a.Y36(K.F0),a.Y36(H.S$),a.Y36(As._W),a.Y36(Ss),a.Y36(xs))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-chat"]],decls:41,vars:8,consts:[[1,"header"],[1,"header__leading"],["mat-raised-button","","color","primary",3,"click"],["matTooltip","After each message, automatically run the thread, poll for completion and refresh messages",1,"checkbox-container"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"chose-file-label"],[1,"checkbox-container"],[1,"header__trailing"],[4,"ngIf"],[1,"view","container"],[1,"message-list"],[3,"message","files","delete",4,"ngFor","ngForOf"],["class","processing-indicator",4,"ngIf"],[1,"footer"],[1,"file-select-container"],["type","checkbox",3,"change"],["name","file",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"chat-input-field"],["matInput","","type","text","placeholder","Entrez votre message...",3,"ngModel","ngModelChange","keydown"],[3,"ngModel","ngModelChange"],["ng-size","8",3,"value",4,"ngFor","ngForOf"],["ng-size","8",3,"value"],[3,"message","files","delete"],[1,"processing-indicator"],["diameter","20"],[3,"value"]],template:function(n,s){1&n&&(a.TgZ(0,"div",0)(1,"div",1)(2,"button",2),a.NdJ("click",function(){return s.back()}),a._uU(3),a.qZA(),a.TgZ(4,"button",2),a.NdJ("click",function(){return s.clearThread()}),a._uU(5," Clear thread "),a.qZA(),a.TgZ(6,"button",2),a.NdJ("click",function(){return s.runThread()}),a._uU(7," Manual run "),a.qZA(),a.TgZ(8,"button",2),a.NdJ("click",function(){return s.refreshMessages()}),a._uU(9," Refresh messages "),a.qZA(),a.TgZ(10,"span",3)(11,"input",4),a.NdJ("ngModelChange",function(o){return s.autoRunThread=o})("ngModelChange",function(){return s.updateConfig()}),a.qZA(),a.TgZ(12,"span",5),a._uU(13,"Auto run thread"),a.qZA()(),a.TgZ(14,"span",6)(15,"input",4),a.NdJ("ngModelChange",function(o){return s.showUsage=o})("ngModelChange",function(){return s.updateConfig()}),a.qZA(),a.TgZ(16,"span",5),a._uU(17,"Show usage"),a.qZA()()(),a.TgZ(18,"div",7),a.YNc(19,Os,5,2,"mat-form-field",8),a.TgZ(20,"button",2),a.NdJ("click",function(){return s.onManageAssistantsClick()}),a._uU(21," Manage Assistants "),a.qZA(),a.TgZ(22,"button",2),a.NdJ("click",function(){return s.downloadSnapshot()}),a._uU(23," Download snapshot "),a.qZA()()(),a.TgZ(24,"div",9)(25,"div",10),a.YNc(26,Fs,1,2,"app-message",11),a.qZA(),a.YNc(27,Zs,4,0,"div",12),a.TgZ(28,"div",13)(29,"div",14)(30,"input",15),a.NdJ("change",function(o){return s.handleWithFileClick(o)}),a.qZA(),a.TgZ(31,"span",5),a._uU(32,"Attach file to message"),a.qZA(),a.TgZ(33,"select",16),a.NdJ("change",function(o){return s.onSelectedFileChange(o)}),a.TgZ(34,"option",17),a._uU(35,"--Choose a file--"),a.qZA(),a.YNc(36,$s,2,2,"option",18),a.qZA(),a.TgZ(37,"button",2),a.NdJ("click",function(){return s.onManageFilesClick()}),a._uU(38," Manage files "),a.qZA()(),a.TgZ(39,"mat-form-field",19)(40,"textarea",20),a.NdJ("ngModelChange",function(o){return s.value=o})("keydown",function(o){return s.onInput(o)}),a.qZA()()()()),2&n&&(a.xp6(3),a.hij(" ","< Back"," "),a.xp6(8),a.Q6J("ngModel",s.autoRunThread),a.xp6(4),a.Q6J("ngModel",s.showUsage),a.xp6(4),a.Q6J("ngIf",s.assistants.length),a.xp6(7),a.Q6J("ngForOf",s.messages.reverse()),a.xp6(1),a.Q6J("ngIf",s.processing),a.xp6(9),a.Q6J("ngForOf",s.files),a.xp6(4),a.Q6J("ngModel",s.value))},dependencies:[H.sg,H.O5,Er.Nt,Mt.KE,Mt.hX,ne.YN,ne.Kr,ne.Fj,ne.Wl,ne.JJ,ne.On,Ne.lW,kt.gM,Es.gD,Ts.ey,Ps.Ou,Ms],styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(background.0e2e4ccb6f8f5a46.png);min-width:100vw;min-height:100vh;background-repeat:repeat}[_nghost-%COMP%]   .processing-indicator[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .checkbox-container[_ngcontent-%COMP%]{display:inline-flex;flex-wrap:nowrap}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:1rem;position:fixed;z-index:2}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:400px}[_nghost-%COMP%]   .header__trailing[_ngcontent-%COMP%]{text-align:end}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:not(:first-child){margin-left:1rem}.footer[_ngcontent-%COMP%]{width:calc(100vw - 4rem);flex-grow:1;position:absolute;bottom:1rem;margin-left:2rem;position:fixed}.chose-file-label[_ngcontent-%COMP%]{margin:0 1rem 0 .5rem}.chat-input-field[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.message-list[_ngcontent-%COMP%]{padding:140px 2rem 200px}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{background:rgb(245,245,245)}"]})}return r})();var Ce=S(5412);function Us(r,e){1&r&&(a.TgZ(0,"div",9),a._uU(1," Invalid JSON ! "),a.TgZ(2,"span")(3,"a",10),a._uU(4,"Paste it here to see what's wrong"),a.qZA()()())}let js=(()=>{class r{constructor(t,n){this.dialogRef=t,this.oaiService=n,this.updated=new a.vpe,this.confString='{\n    "name": "XXXXXXXX[EDIT THIS]",\n    "instructions": "You are a helpful assistant.",\n    "tools": [\n      {"type": "file_search"}\n    ],\n    "model": "gpt-4o"\n  }',this.parseError=!1}createAssistant(){var t=this;return(0,u.Z)(function*(){let n;console.log(t.confString);try{n=JSON.parse(t.confString)}catch(s){console.error(s),t.parseError=!0}n&&(t.parseError=!1,yield t.oaiService.createAssistant(n),t.updated.emit(),t.dialogRef.close())})()}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(Ce.so),a.Y36(be))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-assistant-edition-dialog"]],outputs:{updated:"updated"},decls:20,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["href","https://platform.openai.com/docs/api-reference/assistants/createAssistant","target","_blank"],["class","error-message",4,"ngIf"],[1,"example-full-width"],["matInput","","rows","15",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],[1,"error-message"],["href","https://jsonlint.com/","target","_blank"]],template:function(n,s){1&n&&(a.TgZ(0,"h1",0),a._uU(1,"Create assistant"),a.qZA(),a.TgZ(2,"div",1)(3,"div"),a._uU(4," Edit the config below "),a.TgZ(5,"span")(6,"a",2),a._uU(7,"Checkout the documentation"),a.qZA()()(),a.YNc(8,Us,5,0,"div",3),a._UZ(9,"br"),a.TgZ(10,"div")(11,"mat-form-field",4)(12,"mat-label"),a._uU(13,"Config"),a.qZA(),a.TgZ(14,"textarea",5),a.NdJ("ngModelChange",function(o){return s.confString=o}),a.qZA()()()(),a.TgZ(15,"div",6)(16,"button",7),a._uU(17,"Cancel"),a.qZA(),a.TgZ(18,"button",8),a.NdJ("click",function(){return s.createAssistant()}),a._uU(19,"Create"),a.qZA()()),2&n&&(a.xp6(8),a.Q6J("ngIf",s.parseError),a.xp6(6),a.Q6J("ngModel",s.confString))},dependencies:[H.O5,Er.Nt,Mt.KE,Mt.hX,ne.Fj,ne.JJ,ne.On,Ne.lW,Ce.ZT,Ce.uh,Ce.xY,Ce.H8],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .error-message[_ngcontent-%COMP%]{color:red}"]})}return r})();function Bs(r,e){if(1&r){const t=a.EpF();a.TgZ(0,"div",3),a.NdJ("click",function(){const i=a.CHM(t).$implicit,o=a.oxw();return a.KtG(o.goToDetailView(i))}),a.TgZ(1,"div",4),a._uU(2),a.qZA(),a.TgZ(3,"div",5),a._uU(4),a.qZA()()}if(2&r){const t=e.$implicit,n=a.oxw();a.Q6J("matTooltip",n.stringify(t)),a.xp6(2),a.Oqu(t.name),a.xp6(2),a.Oqu(t.model)}}let Ds=(()=>{class r{constructor(t,n,s){this.oaiService=t,this.router=n,this.dialog=s}ngOnInit(){var t=this;return(0,u.Z)(function*(){t.refresh()})()}goToDetailView(t){}refresh(){var t=this;return(0,u.Z)(function*(){t.assistants=yield t.oaiService.listAssistants()})()}back(){this.router.navigate(["/poc-ai/home"])}stringify(t){return JSON.stringify(t,null,4)}openAssistantCreationModal(){this.dialog.open(js,{width:"70vw",height:"80vh"}).componentInstance.updated.subscribe(()=>{console.log("UPDATED"),this.refresh()})}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(be),a.Y36(K.F0),a.Y36(Ce.uw))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-assistants"]],decls:6,vars:2,consts:[["mat-raised-button","","color","primary",3,"click"],[1,"config-elm-list"],["class","assistant config-elm-list__element",3,"matTooltip","click",4,"ngFor","ngForOf"],[1,"assistant","config-elm-list__element",3,"matTooltip","click"],[1,"config-elm-list__element__label"],[1,"config-elm-list__element__info"]],template:function(n,s){1&n&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return s.back()}),a._uU(1),a.qZA(),a.TgZ(2,"div",1),a.YNc(3,Bs,5,3,"div",2),a.qZA(),a.TgZ(4,"button",0),a.NdJ("click",function(){return s.openAssistantCreationModal()}),a._uU(5," + Create assistant\n"),a.qZA()),2&n&&(a.xp6(1),a.hij(" ","< Back","\n"),a.xp6(2),a.Q6J("ngForOf",s.assistants))},dependencies:[H.sg,Ne.lW,kt.gM],styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(B83HT.3edd4132e122d427.jpg);min-width:100vw;min-height:100vh;background-repeat:repeat;padding:1rem}"]})}return r})();function qs(r,e){if(1&r){const t=a.EpF();a.TgZ(0,"div",3),a.NdJ("click",function(){const i=a.CHM(t).$implicit,o=a.oxw();return a.KtG(o.goToChatView(i))}),a.TgZ(1,"div",4),a._uU(2),a.qZA(),a._UZ(3,"div",5),a.qZA()}if(2&r){const t=e.$implicit;a.xp6(2),a.Oqu(t.id)}}let Js=(()=>{class r{constructor(t,n,s){this.oaiService=t,this.activatedRoute=n,this.router=s,this.threads=[]}ngOnInit(){this.refresh()}refresh(){var t=this;return(0,u.Z)(function*(){t.threads=yield t.oaiService.listThreads()})()}goToChatView(t){this.router.navigate([`/poc-ai/threads/${t.id}/chat`])}back(){this.router.navigate(["/poc-ai/home"])}createThread(){var t=this;return(0,u.Z)(function*(){yield t.oaiService.createThread(),t.refresh()})()}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(be),a.Y36(K.gz),a.Y36(K.F0))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-threads"]],decls:6,vars:2,consts:[["mat-raised-button","","color","primary",3,"click"],[1,"config-elm-list"],["class","thread config-elm-list__element clickable",3,"click",4,"ngFor","ngForOf"],[1,"thread","config-elm-list__element","clickable",3,"click"],[1,"config-elm-list__element__label"],[1,"config-elm-list__element__info"]],template:function(n,s){1&n&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return s.back()}),a._uU(1),a.qZA(),a.TgZ(2,"div",1),a.YNc(3,qs,4,1,"div",2),a.qZA(),a.TgZ(4,"button",0),a.NdJ("click",function(){return s.createThread()}),a._uU(5," + Nouveau thread\n"),a.qZA()),2&n&&(a.xp6(1),a.hij(" ","< Back","\n"),a.xp6(2),a.Q6J("ngForOf",s.threads))},dependencies:[H.sg,Ne.lW],styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(B83HT.3edd4132e122d427.jpg);min-width:100vw;min-height:100vh;background-repeat:repeat;padding:1rem}"]})}return r})();function Ls(r,e){if(1&r&&(a.TgZ(0,"div",5)(1,"div",6),a._uU(2),a.qZA(),a.TgZ(3,"div",7),a._uU(4),a.qZA()()),2&r){const t=e.$implicit,n=a.oxw();a.Q6J("matTooltip",n.stringify(t)),a.xp6(2),a.Oqu(t.filename),a.xp6(2),a.Oqu(t.id)}}const Hs=[{path:"home",component:(()=>{class r{constructor(t){this.router=t}goToThreads(){this.router.navigate(["/poc-ai/threads"])}goToAssistants(){this.router.navigate(["/poc-ai/assistants"])}goToFiles(){this.router.navigate(["/poc-ai/files"])}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(K.F0))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-home"]],decls:16,vars:0,consts:[[1,"config-elm-list"],[1,"assistant","config-elm-list__element","clickable",3,"click"],[1,"config-elm-list__element__label"],[1,"config-elm-list__element__info"]],template:function(n,s){1&n&&(a.TgZ(0,"div",0)(1,"div",1),a.NdJ("click",function(){return s.goToThreads()}),a.TgZ(2,"div",2),a._uU(3,"Threads"),a.qZA(),a.TgZ(4,"div",3),a._uU(5," See your threads and send messages "),a.qZA()(),a.TgZ(6,"div",1),a.NdJ("click",function(){return s.goToAssistants()}),a.TgZ(7,"div",2),a._uU(8,"Assistants"),a.qZA(),a.TgZ(9,"div",3),a._uU(10,"Manage assistants"),a.qZA()(),a.TgZ(11,"div",1),a.NdJ("click",function(){return s.goToFiles()}),a.TgZ(12,"div",2),a._uU(13,"Files"),a.qZA(),a.TgZ(14,"div",3),a._uU(15,"Manage files"),a.qZA()()())},styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(B83HT.3edd4132e122d427.jpg);min-width:100vw;min-height:100vh;background-repeat:repeat;padding:1rem}"]})}return r})(),children:[]},{path:"assistants",component:Ds,children:[]},{path:"threads",component:Js,children:[]},{path:"threads/:threadId/chat",component:Ns,children:[]},{path:"files",component:(()=>{class r{constructor(t,n){this.oaiService=t,this.router=n,this.selectedFile=null}ngOnInit(){var t=this;return(0,u.Z)(function*(){t.refresh()})()}refresh(){var t=this;return(0,u.Z)(function*(){t.files=yield t.oaiService.listFiles()})()}back(){this.router.navigate(["/poc-ai/home"])}onFileSelected(t){console.log({event:t});const n=t.target;n.files&&n.files.length>0&&(this.selectedFile=n.files[0],this.uploadFile())}uploadFile(){var t=this;return(0,u.Z)(function*(){if(!t.selectedFile)return console.log({fileSel:t.selectedFile}),void console.error("No file selected!");t.oaiService.createFile(t.selectedFile)})()}stringify(t){return JSON.stringify(t,null,4)}static#e=this.\u0275fac=function(n){return new(n||r)(a.Y36(be),a.Y36(K.F0))};static#t=this.\u0275cmp=a.Xpm({type:r,selectors:[["app-files"]],decls:8,vars:2,consts:[["mat-raised-button","","color","primary",3,"click"],[1,"config-elm-list"],["class","file config-elm-list__element",3,"matTooltip",4,"ngFor","ngForOf"],["type","file",2,"visibility","hidden",3,"change"],["fileInput",""],[1,"file","config-elm-list__element",3,"matTooltip"],[1,"config-elm-list__element__label"],[1,"config-elm-list__element__info"]],template:function(n,s){if(1&n){const i=a.EpF();a.TgZ(0,"button",0),a.NdJ("click",function(){return s.back()}),a._uU(1),a.qZA(),a.TgZ(2,"div",1),a.YNc(3,Ls,5,3,"div",2),a.qZA(),a.TgZ(4,"button",0),a.NdJ("click",function(){a.CHM(i);const l=a.MAs(7);return a.KtG(l.click())}),a._uU(5," + Import new file\n"),a.qZA(),a.TgZ(6,"input",3,4),a.NdJ("change",function(l){return s.onFileSelected(l)}),a.qZA()}2&n&&(a.xp6(1),a.hij(" ","< Back","\n"),a.xp6(2),a.Q6J("ngForOf",s.files))},dependencies:[H.sg,Ne.lW,kt.gM],styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(B83HT.3edd4132e122d427.jpg);min-width:100vw;min-height:100vh;background-repeat:repeat;padding:1rem}"]})}return r})(),children:[]},{path:"**",redirectTo:"home"}];let Ws=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=a.oAB({type:r});static#n=this.\u0275inj=a.cJS({imports:[K.Bz.forChild(Hs),K.Bz]})}return r})();var Xs=S(2271);let Vs=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=a.oAB({type:r});static#n=this.\u0275inj=a.cJS({imports:[H.ez,Ws,Xs.m]})}return r})()}}]);